/*

  All code by @99TheDark unless noted. (See CREDITS.md)
  
  Minified with Toptal.

*/

"use strict";window.Dark&&(Dark=void 0);var Dark=function(e=!1){if(!(this instanceof Dark))throw"Dark can only be called with the new operator";this.darkObject=!0;let t=this,a=t.constants=Dark.constants,r=t.objects=Dark.objects,n=t.imageCache=Dark.cache.images,i=t.fontCache=Dark.cache.fonts,s=t.precomputed=Dark.precomputed,o=t.settings={},l=performance.now(),c=performance.now(),h=-1,u=null,d=!1,m=null,p=null;Dark.instances.push(t);let f={};t.keys=new Proxy(f,{get:(e,t)=>e[t]??!1,set:Dark.noop}),[t.width,t.height]=[innerWidth,innerHeight],[t.dt,t.frameCount,t.fps]=[0,0,60],t.mouseX=t.mouseY=t.pmouseX=t.pmouseY=0,t.key=t.keyCode=t.mouseButton=void 0,t.mouseIsPressed=t.mouseIsInside=t.keyIsPressed=!1,t.mouse=r.DVector.zero2D(),t.pmouse=r.DVector.zero2D(),t.imageData=new ImageData(innerWidth,innerHeight),t.info={id:new r.DIdentification().id,initializationTime:performance.now(),version:Dark.version},t.transforms=[],t.saves=[],t.styles=[],t.vertices=[],t.vertexCache=[],t.editable={},t.loaded=!1,t.began=!1,t.clone=Dark.clone,t.format=Dark.format,t.noop=Dark.noop,t.randomGenerator=r.DRandom.create(),t.dummy=e,t.isMain=!1,t.canvas=new OffscreenCanvas(innerWidth,innerHeight),t.ctx=t.canvas.getContext("2d"),Dark.empties.forEach(e=>{t.editable[e]=function(){},Object.defineProperty(t,e,{get:()=>t.editable[e],set(a){"function"==typeof a&&(t.editable[e]=a)},configurable:!0})});var g=function(e){return t.snap(o.angleMode==a.DEGREES?e*a.PI/180:e,0,a.TAU)},$=function(e){t.vertices.push(e),e.points.forEach(e=>t.vertexCache.push(r.DVector.create(e.x,e.y)))},k=function(){return n.successes==Object.keys(n.items).length&&i.successes==Object.keys(i.items).length},v=function(e){if(0==e)return 1;let t=e;for(;--e>1;)t*=e;return t},D=function(){t.frameRate(60),t.smooth(),t.loop(),t.antialiasing(!0),t.disableContextMenu(),t.ellipseMode(a.CENTER),t.rectMode(a.CORNER),t.imageMode(a.CORNER),t.resizeMode(a.WIDTH),t.angleMode(a.DEGREES),t.strokeCap(a.ROUND),t.strokeJoin(a.MITER),t.textAlign(a.LEFT,a.BASELINE),t.curveTightness(2),t.fill(255),t.stroke(0),t.strokeWeight(1),t.textFont("12px Arial"),t.textLeading(0),t.preventDefault(a.KEY),t.allowDefault(a.CLICK),t.preventDefault(a.SCROLL)},_=function(e){for(let a in t.ctx){let r=e.ctx[a];if("canvas"!=a&&"function"!=typeof r)try{t.ctx[a]=r}catch{}}for(let n in o)o[n]=e.settings[n]},w=function(){t.canvas.addEventListener("click",function(e){o.clickEvents&&e.preventDefault(),Dark.globallyUpdateVariables(t),t.mouseClicked()}),t.canvas.addEventListener("mousedown",function(e){o.clickEvents&&e.preventDefault(),t.mouseIsPressed=!0,t.mouseButton=Dark.mouseMap[e.button],Dark.globallyUpdateVariables(t),t.mousePressed()}),t.canvas.addEventListener("mouseup",function(e){o.clickEvents&&e.preventDefault(),t.mouseButton=void 0,t.mouseIsPressed=!1,Dark.globallyUpdateVariables(t),t.mouseReleased()}),t.canvas.addEventListener("mouseenter",function(){t.mouseIsInside=!0,Dark.globallyUpdateVariables(t),t.mouseIn()}),t.canvas.addEventListener("mouseleave",function(){t.mouseIsInside=!1,Dark.globallyUpdateVariables(t),t.mouseOut()}),t.canvas.addEventListener("mousemove",function(e){let a=e.target.getBoundingClientRect();t.pmouseX=t.pmouse.x=t.mouseX,t.pmouseY=t.pmouse.y=t.mouseY,t.mouseX=t.mouse.x=t.constrain(t.round(e.pageX-a.x),0,t.width),t.mouseY=t.mouse.y=t.constrain(t.round(e.pageY-a.y),0,t.height),Dark.globallyUpdateVariables(t),t.mouseMoved(),t.mouseIsPressed&&t.mouseDragged()}),t.canvas.addEventListener("wheel",function(e){o.scrollEvents&&e.preventDefault(),u=performance.now(),t.mouseScroll=r.DVector.create(e.deltaX,e.deltaY,e.deltaZ),Dark.globallyUpdateVariables(t),t.mouseScrolled()}),t.canvas.addEventListener("dblclick",function(e){o.clickEvents&&e.preventDefault(),Dark.globallyUpdateVariables(t),t.mouseDoubleClicked()})},b=function(){t.loaded=!0,Dark.globallyUpdateVariables(t),Dark.khan&&Dark.externals.khanImagePreload&&Dark.imageLocationsKA.forEach(e=>t.getImage(e)),t.preload(),!t.began&&k()&&t.begin()},T=function(e){return`rgba(${t.red(e)}, ${t.green(e)}, ${t.blue(e)}, ${t.alpha(e)*s.BYTE})`};!function(e){for(let a in e)Object.defineProperty(t,a,{value:e[a],writable:!1,configurable:!1,enumerable:!0})}({size(e=innerWidth,a=innerHeight){if("number"==typeof e&&"number"==typeof a&&e>0&&a>0){let n=t.clone(t.ctx);for(let i in[t.width,t.height]=[t.canvas.width,t.canvas.height]=[e,a],p=new r.DImage(t.width,t.height,t),t.ctx){let s=n[i];if("function"!=typeof s&&!Dark.styleIgnore.includes(i))try{t.ctx[i]=s}catch{}}Dark.globallyUpdateVariables(t)}},setCanvas(e){if(e instanceof HTMLCanvasElement){t.canvas=e,t.width=e.width,t.height=e.height;let a=t.clone(t.ctx);t.ctx=e.getContext("2d"),_({ctx:a,settings:{...o}}),t.canvas.style.cursor=o.cursor,t.canvas.tabIndex="1",w()}},getCanvas:()=>t.canvas,getContext:()=>t.ctx,exit(){t.isMain&&Dark.setMain(Dark.default),cancelAnimationFrame(m),Dark.instances.splice(Dark.instances.indexOf(t),1)},setTitle(e){document.title=e},disableKhanImagePreload(){Dark.externals.khanImagePreload=!1},createGraphics(e,t,a=!1){let r=new Dark(a);return r.size(e,t),r},dist(...e){let a,r;return e.length=6,a=e[2]-e[0],r=e[3]-e[1],t.sqrt(a*a+r*r+0)},intersect(e,t,a,r,n,i,s,o){if(e==n&&t==i||a==s&&r==o)return!0;let l=(r-t)/(a-e),c=(o-i)/(s-n);if(l==c)return!1;let[h,u]=e<a?[e,a]:[a,e],[d,m]=n<s?[n,s]:[s,n],p=(i-c*n-(t-l*e))/(l-c);return!!(h<p)&&!!(p<u)&&!!(p<d)&&!!(p<m)},gamma:e=>t.sqrt(a.TAU/e)*((e+1/(12*e+1/(10*e)))/a.E)**e,factorial:e=>Number.isInteger(e)?v(e):gamma(e+1),choose:(e,t)=>v(e)/(v(e-t)*v(t)),repeat(e,t){for(let a=0;a<e;a++)t(a)},minimum(...e){1==e.length&&t.isArray(e[0])&&(e=e[0]);let a=e[0];return e.forEach(e=>e<a&&(a=e)),a},maximum(...e){1==e.length&&t.isArray(e[0])&&(e=e[0]);let a=e[0];return e.forEach(e=>e>a&&(a=e)),a},random(...e){switch(e.length){default:return t.randomGenerator.next()*(e[1]-e[0])+e[0];case 0:return t.randomGenerator.next();case 1:return t.randomGenerator.next()*e[0]}},randomSeed(e){e!=t.randomGenerator.seed&&(t.randomGenerator=r.DRandom.create(e))},cursor(e="default"){o.cursor=e,t.canvas.style.cursor=e},noCursor(){o.cursor="none",t.canvas.style.cursor="none"},loop(){o.looping=!0},noLoop(){o.looping=!1},frameRate(e){o.frameStep=1e3/e},enableContextMenu(){o.contextMenu=!0,t.canvas.oncontextmenu=!0},disableContextMenu(){o.contextMenu=!1,t.canvas.oncontextmenu=!1},fullscreen(){t.canvas.requestFullscreen()},color(e,r,n,i){if(t.isArray(e))return color.apply(null,[...e]);let s=arguments.length;if(0==s)return -1;if(1==s||2==s){if(!(e<=255)||!(e>=0))return 2==s?e&a.ALPHA_MASK|r<<24:e;1==s?n=r=e:(i=r,r=e,n=e)}return i??=255,e=t.constrain(e,0,255),r=t.constrain(r,0,255),n=t.constrain(n,0,255),((i=t.constrain(i,0,255))<<24)+(e<<16)+(r<<8)+n},randomColor:()=>color(255*t.randomGenerator.next(),255*t.randomGenerator.next(),255*t.randomGenerator.next()),red:e=>e>>16&255,green:e=>e>>8&255,blue:e=>255&e,alpha:e=>e>>24&255,lerpColor:(e,a,r)=>color(t.lerp(t.red(e),t.red(a),r),t.lerp(t.green(e),t.green(a),r),t.lerp(t.blue(e),t.blue(a),r),t.lerp(t.alpha(e),t.alpha(a),r)),fill(...e){let a=o.fill=t.color.apply(null,e);t.ctx.fillStyle=T(a)},noFill(){o.fill=0,t.ctx.fillStyle="rgba(0, 0, 0, 0)"},stroke(...e){let a=o.stroke=t.color.apply(null,e);t.ctx.strokeStyle=T(a)},noStroke(){o.stroke=0,t.ctx.strokeStyle="rgba(0, 0, 0, 0)"},background(...e){t.ctx.save(),t.ctx.resetTransform();let a=t.color.apply(null,e);t.ctx.fillStyle=T(a),t.ctx.clearRect(0,0,t.width,t.height),t.ctx.fillRect(0,0,t.width,t.height),t.ctx.restore()},clear(){t.ctx.save(),t.ctx.resetTransform(),t.ctx.clearRect(0,0,t.width,t.height),t.ctx.restore()},strokeCap(e){switch(e){default:Dark.error("Invalid strokeCap type");break;case a.FLAT:t.ctx.lineCap="butt",o.strokeCap=a.FLAT;break;case a.ROUND:t.ctx.lineCap="round",o.strokeCap=a.ROUND;break;case a.SQUARE:t.ctx.lineCap="square",o.strokeCap=a.SQUARE}},strokeJoin(e=a.MITER){switch(e){default:Dark.error("Invalid strokeJoin type");break;case a.MITER:t.ctx.lineJoin="miter",o.strokeJoin=a.MITER;break;case a.BEVEL:t.ctx.lineJoin="bevel",o.strokeJoin=a.BEVEL;break;case a.ROUND:t.ctx.lineJoin="round",o.strokeJoin=a.ROUND}},strokeWeight(e){o.smoothing||(e=t.round(e)),o.strokeWeight=e,t.ctx.lineWidth=e},smooth(){o.smoothing=!0,t.ctx.imageSmoothingQuality="high"},noSmooth(){o.smoothing=!0,t.ctx.imageSmoothingEnabled=!1,t.ctx.imageSmoothingQuality="low"},antialiasing(e){"boolean"==typeof e?(t.ctx.mozImageSmoothingEnabled=e,t.ctx.webkitImageSmoothingEnabled=e,t.ctx.msImageSmoothingEnabled=e,t.ctx.imageSmoothingEnabled=e):Dark.error("Antialiasing mode must be of boolean value")},preventDefault(e){switch(0==arguments.length&&Dark.error("No listener type given"),e){default:Dark.error("Invalid listener given");break;case a.KEY:o.keyEvents=!0;break;case a.CLICK:o.clickEvents=!0;break;case a.SCROLL:o.scrollEvents=!0}},allowDefault(e){switch(0==arguments.length&&Dark.error("No listener type given"),e){default:Dark.error("Invalid listener given");break;case a.KEY:o.keyEvents=!1;break;case a.CLICK:o.clickEvents=!1;break;case a.SCROLL:o.scrollEvents=!1}},angleMode(e){switch(e){default:Dark.error("Invalid angleMode");break;case a.DEGREES:o.angleMode=a.DEGREES;break;case a.RADIANS:o.angleMode=a.RADIANS}},ellipseMode(e=a.CENTER){switch(e){default:Dark.error("Invalid ellipseMode");break;case a.CENTER:o.ellipseMode=a.CENTER;break;case a.CORNER:o.ellipseMode=a.CORNER;break;case a.RADIUS:o.ellipseMode=a.RADIUS}},rectMode(e=a.CORNER){switch(e){default:Dark.error("Invalid rectMode");break;case a.CORNER:o.rectMode=a.CORNER;break;case a.CENTER:o.rectMode=a.CENTER}},imageMode(e=a.CORNER){switch(e){default:Dark.error("Invalid imageMode");break;case a.CORNER:o.imageMode=a.CORNER;break;case a.CENTER:o.imageMode=a.CENTER}},resizeMode(e=a.WIDTH){switch(e){default:Dark.error("Invalid resizeMode");break;case a.WIDTH:o.resizeMode=a.WIDTH;break;case a.HEIGHT:o.resizeMode=a.HEIGHT}},curveTightness(e=0){o.curveTightness=e,o.curveMatrixTightness=(e-1)*s.SIXTH},pushMatrix(){t.transforms.length>t.maxStackSize?Dark.error(`Maximum matrix stack size reached, pushMatrix() called ${t.maxStackSize} times.`):t.transforms.push(t.ctx.getTransform())},popMatrix(){let e=t.transforms.pop();e?t.ctx.setTransform(e):Dark.error("No more transforms to restore in popMatrix()")},resetMatrix(){t.transforms.length=0,t.ctx.resetTransform()},getDOMMatrix:()=>t.ctx.getTransform(),getMatrix:()=>r.DMatrix.fromDOMMatrix(t.ctx.getTransform()),setMatrix(e){t.ctx.setTransform(new r.DMatrix(e.toDOMMatrix()))},printMatrix(){console.log(t.getMatrix().toString())},pushStyle(){t.styles.length>t.maxStackSize?Dark.error(`Maximum style stack size reached, pushStyle() called ${t.maxStackSize} times.`):t.styles.push({ctx:t.clone(t.ctx),settings:t.clone(o)})},popStyle(){let e=t.styles.pop();e?_(e):Dark.error("No more styles to restore in popStyle()")},resetStyle(){t.styles.length=0,D()},push(){t.transforms.length>t.maxStackSize?Dark.error(`Maximum stack size reached, push() called ${t.maxStackSize} times.`):(t.ctx.save(),t.saves.push(Object.assign({},o)))},pop(){let e=t.saves.pop();e?(t.ctx.restore(),Object.assign(o,e)):Dark.error("No more saves to restore in pop()")},reset(){t.saves.length=0,o={...t.defaultSettings},t.setCanvas(t.canvas)},translate(e,a){t.ctx.translate(e,a)},rotate(e){t.ctx.rotate(g(e))},scale(e,a=e){t.ctx.scale(e,a)},skew(e,a=0){let r=t.ctx.getTransform();r.skewYSelf(.01*e),r.skewXSelf(.01*a),t.ctx.setTransform(r)},rect(e,r,n,i,s,l,c,h){switch(o.smoothing||([e,r,n,i]=[t.round(e),t.round(r),t.round(n),t.round(i)]),[n,i]=[t.abs(n),t.abs(i)],t.ctx.beginPath(),t.ctx.save(),o.rectMode==a.CENTER&&t.ctx.translate(-n/2,-i/2),arguments.length){default:Dark.error("rect takes in 4, 5 or 8 parameters, not "+arguments.length);break;case 4:t.ctx.rect(e,r,n,i);break;case 5:t.ctx.roundRect(e,r,n,i,s);break;case 8:t.ctx.roundRect(e,r,n,i,[s,l,c,h])}t.ctx.fill(),t.ctx.stroke(),t.ctx.restore()},ellipse(e,r,n,i){o.ellipseMode==a.RADIUS&&(n/=2,i/=2),o.smoothing||([e,r,n,i]=[t.round(e),t.round(r),t.round(n),t.round(i)]),[n,i]=[t.abs(n),t.abs(i)],t.ctx.beginPath(),t.ctx.save(),o.ellipseMode==a.CORNER&&t.ctx.translate(n/2,i/2),t.ctx.beginPath(),t.ctx.ellipse(e,r,n/2,i/2,0,0,a.TAU,!1),t.ctx.fill(),t.ctx.stroke(),t.ctx.restore()},arc(e,r,n,i,s,l){o.ellipseMode==a.RADIUS&&(n/=2,i/=2),o.smoothing||([e,r,n,i]=[t.round(e),t.round(r),t.round(n),t.round(i)]),t.ctx.save(),o.ellipseMode==a.CORNER&&t.ctx.translate(n/2,i/2),t.ctx.beginPath(),t.ctx.moveTo(e,r),t.ctx.ellipse(e,r,n/2,i/2,0,g(s),g(l),!1),t.ctx.fill(),t.ctx.beginPath(),t.ctx.ellipse(e,r,n/2,i/2,0,g(s),g(l),!1),t.ctx.stroke(),t.ctx.restore()},line(e,a,r,n){o.smoothing||([e,a,r,n]=[t.round(e),t.round(a),t.round(r),t.round(n)]),t.ctx.beginPath(),t.ctx.moveTo(e,a),t.ctx.lineTo(r,n),t.ctx.stroke()},point(e,r){o.smoothing||(e=t.round(e),r=t.round(r)),t.ctx.save(),o.strokeWeight<=1?t.set(e,r,o.stroke):(t.ctx.beginPath(),t.ctx.fillStyle=T(o.stroke),t.ctx.arc(e,r,o.strokeWeight/2,0,a.TAU),t.ctx.fill()),t.ctx.restore()},circle(e,r,n){o.smoothing||([e,r,n]=[t.round(e),t.round(r),t.round(n)]),n=t.round(n),t.ctx.save(),o.ellipseMode==a.CORNER&&t.ctx.translate(n,n),t.ctx.beginPath(),t.ctx.arc(e,r,n,0,a.TAU),t.ctx.fill(),t.ctx.stroke(),t.ctx.restore()},square(...e){e.splice(3,0,e[2]),rect.apply(null,e)},triangle(e,a,r,n,i,s){o.smoothing||([e,a,r,n,i,s]=[t.round(e),t.round(a),t.round(r),t.round(n),t.round(i),t.round(s)]),t.ctx.beginPath(),t.ctx.moveTo(e,a),t.ctx.lineTo(r,n),t.ctx.lineTo(i,s),t.ctx.closePath(),t.ctx.fill(),t.ctx.stroke()},quad(e,a,r,n,i,s,l,c){o.smoothing||([e,a,r,n,i,s,l,c]=[t.round(e),t.round(a),t.round(r),t.round(n),t.round(i),t.round(s),t.round(l),t.round(c)]),t.ctx.beginPath(),t.ctx.moveTo(e,a),t.ctx.lineTo(r,n),t.ctx.lineTo(i,s),t.ctx.lineTo(l,c),t.ctx.closePath(),t.ctx.fill(),t.ctx.stroke()},beginShape(){d?Dark.error("Cannot begin a new shape before the previous shape has ended"):(t.vertices.length=0,t.vertexCache.length=0,d=!0)},endShape(e=a.OPEN){t.vertices.length<2||t.vertices[0].type==a.BEZIER||(t.ctx.beginPath(),t.vertices.forEach(function(e,r){if(0==r)t.ctx.moveTo(e.points[0].x,e.points[0].y);else switch(e.type){case a.VERTEX:let n=e.points[0];t.ctx.lineTo(n.x,n.y);break;case a.CURVE:let i=o.curveMatrixTightness,s=t.vertexCache[r-3],l=t.vertexCache[r-2],c=t.vertexCache[r-1],h=t.vertexCache[r];if(2==r)break;0==r?t.ctx.moveTo(h.x,h.y):r<3?t.ctx.lineTo(h.x,h.y):(3==r&&t.ctx.lineTo(l.x,l.y),t.ctx.bezierCurveTo(c.x*i+l.x-s.x*i,c.y*i+l.y-s.y*i,-(h.x*i)+c.x+l.x*i,-(h.y*i)+c.y+l.y*i,c.x,c.y));break;case a.BEZIER:let u=e.points;t.ctx.bezierCurveTo(u[0].x,u[0].y,u[1].x,u[1].y,u[2].x,u[2].y)}}),e==a.CLOSE&&t.ctx.closePath(),t.ctx.fill(),t.ctx.stroke(),d=!1)},vertex(e,r){o.smoothing||([e,r]=[t.round(e),t.round(r)]);$({type:a.VERTEX,points:[{x:e,y:r}]})},curveVertex(e,r){o.smoothing||([x,y]=[t.round(e),t.round(r)]);$({type:a.CURVE,points:[{x:e,y:r}]})},bezierVertex(e,r,n,i,s,l){o.smoothing||([e,r,n,i,s,l]=[t.round(e),t.round(r),t.round(n),t.round(i),t.round(s),t.round(l)]);$({type:a.BEZIER,points:[{x:e,y:r},{x:n,y:i},{x:s,y:l}]})},bezier(e,t,a,r,n,i,s,o){beginShape(),vertex(e,t),bezierVertex(a,r,n,i,s,o),endShape()},curve(e,t,a,r,n,i,s,o){beginShape(),vertex(e,t),vertex(a,r),vertex(n,i),curveVertex(s,o),endShape()},bezierPoint(e,t,a,r,n){let i=1-n;return i*i*i*e+3*i*i*n*t+3*i*n*n*a+n*n*n*r},curvePoint:(e,t,a,r,n)=>.5*(2*t+(a-e)*n+(2*e-5*t+4*a-r)*n*n+(3*t-3*a+r-e)*n*n*n),curveTangent:(e,t,a,r,n)=>.5*(a-e+2*(2*e-5*t+4*a-r)*n+3*(3*t-3*a+r-e)*n*n),bezierTangent(e,t,a,r,n){let i=1-n;return 3*i*i*(t-e)+6*i*n*(a-t)+3*n*n*(r-a)},reloadFont(){t.ctx.font=o.font.toString(),o.genericTextMeasure=t.ctx.measureText("0"),o.textHeight=o.genericTextMeasure.fontBoundingBoxAscent+o.genericTextMeasure.fontBoundingBoxDescent},textSize(e){o.smoothing||(e=t.round(e)),o.textSize=e,o.font.size=e,t.reloadFont()},textAlign(e,r){let n=arguments.length;switch(0==n&&(e=a.LEFT,r=a.BASELINE),1==n&&e==a.CENTER&&(r=a.CENTER),e){default:Dark.error("Invalid x alignment type");break;case a.LEFT:t.ctx.textAlign="left",o.alignX=a.LEFT;break;case a.RIGHT:t.ctx.textAlign="right",o.alignX=a.RIGHT;break;case a.CENTER:t.ctx.textAlign="center",o.alignX=a.CENTER}switch(r){default:Dark.error("Invalid y alignment type");break;case a.BASELINE:t.ctx.textBaseline="alphabetic",o.alignY=a.BASELINE;break;case a.TOP:t.ctx.textBaseline="top",o.alignY=a.TOP;break;case a.BOTTOM:t.ctx.textBaseline="bottom",o.alignY=a.BOTTOM;break;case a.CENTER:t.ctx.textBaseline="middle",o.alignY=a.CENTER;break;case a.HANGING:t.ctx.textBaseline="hanging",o.alignY=a.HANGING}},textFont(e){"string"==typeof e&&(e=new r.DFont(e)),e instanceof r.DFont?(o.font=e,o.textSize=e.size,t.reloadFont()):Dark.error(`${e} is not a DFont.`)},createFont:e=>r.DFont.parse(e),textStyle(e){switch(e){default:o.font.weight="normal",o.font.style="normal";break;case a.BOLD:o.font.weight="bold";break;case a.ITALIC:o.font.style="italic"}t.reloadFont()},textWidth:e=>t.ctx.measureText(e).width,textAscent:()=>o.genericTextMeasure.fontBoundingBoxAscent,textDescent:()=>o.genericTextMeasure.fontBoundingBoxDescent,textLeading(e){o.lineGap=e},text(e,r,n,i=1/0,s=1/0){o.smoothing||([r,n]=[t.round(r),t.round(n)]);let l=[],c=e.replaceAll("\n"," \n ").split(" "),h=0,u="",d=t.ctx.measureText(" ").width;c.every(e=>{if("\n"==e)return l.push(u),h=0,u="",!0;let a=t.ctx.measureText(e).width;if(a>i){let r=e.split(""),n=h,s=[0];r.forEach((e,a)=>{let r=t.ctx.measureText(e).width;(n+=r)>i&&(s.push(a),n=r)}),s.push(e.length);let o=[];for(let c=1;c<s.length;c++)o.push(e.substring(s[c-1],s[c]));return u=o.pop()+" ",h=t.ctx.measureText(u).width,o.forEach(e=>l.push(e)),!0}return(h+=a)>i&&(l.push(u.slice(0,-1)),u="",h=a),u+=e+" ",h+=d,!0}),l.push(u),0==l[0].length&&l.shift();let m=0;switch(o.alignY){case a.CENTER:m=(o.textHeight+o.lineGap)/2*(l.length-1);break;case a.BOTTOM:m=(o.textHeight+o.lineGap)*(l.length-1)}let p=0;l.every(e=>{if(p+o.textHeight>s)return!1;let a=p-m;return t.ctx.fillText(e,r,n+a),t.ctx.strokeText(e,r,n+a),p+=o.textHeight+o.lineGap,!0})},loadFont(e){if(Object.keys(i.items).includes(e)&&t.began)return i.items[e];if(Dark.khan)return new r.DFont(e);i.items[e]=null;let a=new r.DFont;return a.family=e,fetch(`https://fonts.googleapis.com/css2?family=${e.replace(/\s/g,"+")}`).then(e=>e.text()).then(a=>{let r=[];for(let n=0;n<Dark.maxLoopSaftey;n++){let s=a.indexOf("url("),o=a.indexOf(") format");if(-1==s||-1==o)break;s+=4,r.push(a.substring(s,o)),a=a.substring(o+8)}r.forEach(t=>{let a=new FontFace(e,`url(${t})`);a.load(),document.fonts.add(a)}),i.successes++,k()&&t.begin()}).catch(()=>{console.warn(`'${e}' is not a valid font`),i.successes++}),a},get(...e){switch(e.length){default:return Dark.error("get requires 0 or 4 parameters, not "+e.length);case 0:return new r.DImage(t);case 2:return t.color(t.ctx.getImageData(e[0],e[1],1,1).data);case 3:if(o.resizeMode==a.HEIGHT)return t.get(e[0],e[1],e[2]/t.height*t.width,e[2]);return t.get(e[0],e[1],e[2],e[2]/t.width*t.height);case 4:return new r.DImage(t.ctx.getImageData(e[0],e[1],e[2],e[3]),t)}},set(e,a,...r){t.ctx.save(),t.ctx.fillStyle=T(t.color.apply(null,r)),t.ctx.fillRect(e,a,1,1),t.ctx.restore()},loadPixels(){t.imageData=t.ctx.getImageData(0,0,t.width,t.height)},updatePixels(){t.ctx.putImageData(t.imageData,0,0,t.width,t.height)},image(e,n,i,s,l){if(e.failed)return;e.checkLoad(),[s,l]=[t.abs(s),t.abs(l)],t.ctx.save(),e instanceof ImageData&&(e=new r.DImage(e,t)),e instanceof Dark&&(e=new r.DImage(e.canvas,e).copy());let c,h;switch(arguments.length){default:return t.ctx.restore(),Dark.error("image requires 1, 3, 4 or 5 parameters, not "+arguments.length);case 1:[n,i,c,h]=[0,0,t.width,t.height];break;case 3:[c,h]=[e.width,e.height];break;case 4:o.resizeMode==a.HEIGHT?[c,h]=[s/e.height*e.width,s]:[c,h]=[s,s/e.width*e.height];break;case 5:[c,h]=[s,l]}o.imageMode==a.CENTER&&t.ctx.translate(-c/2,-h/2),o.smoothing||([n,i,s,l]=[t.round(n),t.round(i),t.round(s),t.round(l)]),t.ctx.drawImage(e.getRenderable(),0,0,e.width,e.height,n,i,c,h),t.ctx.restore()},loadImage(e){if(Object.keys(n.items).includes(e)&&t.began)return n.items[e];n.items[e]=null;let a=new r.DImage(1,1,t);return a.loadComplete=!1,a.loadedFromSource=!0,a.sent=!0,Dark.khan?(a.image=new Image,a.image.src=e,a.image.crossOrigin="anonymous",a.image.onload=()=>{n.items[e]=a,n.successes++,[a.canvas.width,a.canvas.height]=[a.width,a.height]=[a.image.width,a.image.height],a.imageData=new ImageData(a.width,a.height),a.ctx.drawImage(a.image,0,0,a.width,a.height,0,0,a.width,a.height),a.updatePixels(),a.sourceURL=e,a.loadComplete=!0,k()&&t.begin()}):Promise.all([new Promise((t,r)=>{a.image=new Image,a.image.src=e,a.image.crossOrigin="anonymous",a.image.onload=()=>{a.imageLoaded=!0,t()},a.image.onerror=r}),new Promise((t,r)=>{fetch(e).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{a.bitmap=e,a.bitmapLoaded=!0,t()}).catch(()=>r(Dark.warn(`Invalid image URL '${e}'`)))})]).then(()=>{a.loaded=!0,a.sent=!1,a.loadComplete=!0,a.sourceURL=e,n.items[e]=a,n.successes++,[a.canvas.width,a.canvas.height]=[a.width,a.height]=[a.image.width,a.image.height],a.imageData=new ImageData(a.width,a.height),a.ctx.drawImage(a.getRenderable(),0,0,a.width,a.height,0,0,a.width,a.height),a.updatePixels(),k()&&t.begin()}).catch(()=>{n.successes++,a.failed=!0}),a},getImage(e){if(!Dark.khan)return t.loadImage("/"+e);{let a=`https://cdn.kastatic.org/third_party/javascript-khansrc/live-editor/build/images/${e}.png`;if(Object.keys(n.items).includes(a)&&t.began)return n.items[a].copy();let i=new r.DImage(1,1,t);return n.items[a]=null,i.image=new Image,i.image.src=a,i.image.crossOrigin="anonymous",i.image.onload=()=>{n.items[a]=i,n.successes++,[i.canvas.width,i.canvas.height]=[i.width,i.height]=[i.image.width,i.image.height],i.imageData=new ImageData(i.width,i.height),i.ctx.drawImage(i.image,0,0,i.width,i.height,0,0,i.width,i.height),i.updatePixels(),k()&&t.begin()},i}},filter(e,a){p.ctx.drawImage(t.canvas,0,0,t.width,t.height,0,0,t.width,t.height),p.filter(e,a),t.ctx.putImageData(p.imageData,0,0)},min:(e,t)=>e<t?e:t,max:(e,t)=>e>t?e:t,log10:e=>Math.log10(e),log2:e=>Math.log2(e),log:e=>Math.log(e),logBase:(e,t)=>Math.log(e)/Math.log(t),mag:(e,t)=>Math.sqrt(e*e+t*t),norm:(e,t,a)=>(e-t)/(a-t),constrain:(e,t,a)=>Math.min(Math.max(e,t),a),between:(e,t,a)=>e<=a&&e>=t,exceeds:(e,t,a)=>e>a||e<t,lerp:(e,t,a)=>(t-e)*a+e,map:(e,t,a,r,n)=>r+(n-r)/(a-t)*(e-t),sq:e=>e*e,cb:e=>e*e*e,pow:(e,t)=>e**t,root:(e,t)=>e**(1/t),sqrt:e=>Math.sqrt(e),cbrt:e=>Math.cbrt(e),exp:e=>E**e,floor:e=>Math.floor(e),round:e=>Math.round(e),ceil:e=>Math.ceil(e),trunc:e=>Math.trunc(e),deci:e=>e-Math.trunc(e),abs:e=>e<0?-e:e,sign:e=>Math.sign(e),bsign:e=>e<0?-1:1,degrees:e=>e*s.DEGREES,radians:e=>e*s.RADIANS,millennium:()=>Math.floor(new Date().getFullYear()/1e3),century:()=>Math.floor(new Date().getFullYear()/100),decade:()=>Math.floor(new Date().getFullYear()/10),year:()=>new Date().getFullYear(),month:()=>new Date().getMonth(),day:()=>new Date().getDate(),hour:()=>new Date().getHours(),minute:()=>new Date().getMinutes(),second:()=>new Date().getSeconds(),millis:()=>Math.floor(performance.now()),micro:()=>Math.floor(1e3*performance.now()%1e3),nano:()=>Math.floor(1e6*performance.now()%1e3),today:()=>DAYS[new Date().getDay()],timezone:()=>-new Date().getTimezoneOffset()/60,sin:e=>Math.sin(g(e)),cos:e=>Math.cos(g(e)),tan:e=>Math.tan(g(e)),csc:e=>1/Math.sin(g(e)),sec:e=>1/Math.cos(g(e)),cot:e=>1/Math.tan(g(e)),atan2(e,r){var n;return n=Math.atan2(e,r),t.snap(o.angleMode==a.DEGREES?180*n/a.PI:n,0,360)},asin:e=>Math.asin(g(e)),acos:e=>Math.acos(g(e)),atan:e=>Math.atan(g(e)),acsc:e=>Math.asin(1/g(e)),asec:e=>Math.acos(1/g(e)),acot:e=>Math.atan(1/g(e)),sinh:e=>Math.sinh(g(e)),cosh:e=>Math.cosh(g(e)),tanh:e=>Math.tanh(g(e)),csch:e=>1/Math.sinh(g(e)),sech:e=>1/Math.cosh(g(e)),coth:e=>1/Math.tanh(g(e)),asinh:e=>Math.asinh(g(e)),acosh:e=>Math.acosh(g(e)),atanh:e=>Math.atanh(g(e)),acsch:e=>Math.asinh(1/g(e)),asech:e=>Math.acosh(1/g(e)),acoth:e=>Math.atanh(1/g(e)),now:()=>performance.now(),reciprocal:e=>1/e,trim:e=>e.trim(),mod:(e,t)=>(e%t+t)%t,snap:(e,t,a)=>(e-t)%(a-t)+t,percent:e=>e/100,translateX:e=>t.translate(e,0),translateY:e=>t.translate(0,e),scaleX:e=>t.scale(e,1),scaleY:e=>t.scale(1,e),skewX:e=>t.skew(e,0),skewY:e=>t.skew(0,e),split:(e,t)=>e.split(t),concat:(e,t)=>e.concat(t),join:(e,t=", ")=>e.join(t),append:(e,t)=>(e.push(t),e),reverse:e=>e.reverse(),expand:(e,t)=>Array(t??2*e.length).fill().map((t,a)=>e[a]),shorten:e=>t.expand(e,e.length-1),match:(e,t)=>e.match(t),matchAll:(e,t)=>[...e.matchAll(t)].map(e=>e.index),nf:(e,t,a)=>(e+".").padStart(t+1,"0")+(String(e).split(".")[1]??"").padEnd(a<=0?1:a,"0"),mix:(e,t,a)=>e+((t-e)*a>>8),link:(e,t)=>open(e,t??"_blank"),isArray:e=>Array.isArray(e)||ArrayBuffer.isView(e),cutoff:(e,t=20)=>e.length>t?`${e.substring(0,t)}...`:e}),t.raf=function(e){if(Dark.startTime>t.info.initializationTime){Dark.warn("Deleting old Dark.js instance."),t.exit();return}let a=(e=performance.now())-l,r=e-c;c=performance.now(),null!=u&&c-u>16&&(u=null,t.mouseScroll.zero3D());let n=a>o.frameStep-r/2&&o.looping;h<e&&h>c&&(a=r=e-h),n&&(l=e,t.draw(),t.dt=a/1e3,t.fps=1e3/a,t.frameCount=++t.frameCount),Dark.globallyUpdateVariables(t),m=requestAnimationFrame(t.raf)},t.begin=function(){t.loaded&&!t.began&&(t.began=!0,t.setup(),m=requestAnimationFrame(t.raf))},D(),t.defaultSettings=Object.assign({},o),t.dummy||(document.addEventListener("keydown",function(e){Dark.focus.target===t.canvas&&(o.keyEvents&&e.preventDefault(),t.keyIsPressed=!0,t.key=(Dark.special[e.keyCode]??e.key).toLowerCase(),t.keyCode=e.keyCode,/\w/.test(String.fromCharCode(e.keyCode))&&t.keyTyped(),f[t.key]=!0,Dark.globallyUpdateVariables(t),t.keyPressed())}),document.addEventListener("keyup",function(e){Dark.focus.target===t.canvas&&(o.keyEvents&&e.preventDefault(),t.key=(Dark.special[e.keyCode]??e.key).toLowerCase(),t.keyCode=e.keyCode,f[t.key]=!1,t.keyIsPressed=!1,Dark.globallyUpdateVariables(t),t.keyReleased(),t.key=void 0,t.keyCode=void 0,Dark.globallyUpdateVariables(t))}),addEventListener("resize",function(){Dark.globallyUpdateVariables(t),t.pageResized()}),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState&&(t.keyIsPressed=!1,t.key=void 0,t.keyCode=void 0,t.mouseIsPressed=!1,t.mouseButton=void 0,t.mouseIsInside=!1,h=performance.now())}),t.mouseScroll=r.DVector.zero3D(),o.cursor="auto",o.looping=!0,Dark.externals.windowLoaded?b():addEventListener("load",b))};Dark.darkObject=!0,Dark.instances=[],Dark.version="pre-0.7.11",Dark.empties=["draw","setup","preload","keyPressed","keyReleased","keyTyped","mouseClicked","mousePressed","mouseReleased","mouseMoved","mouseScrolled","mouseIn","mouseOut","mouseDoubleClicked","mouseDragged","pageResized"],Dark.editable=Dark.empties.concat(["imageData"]),Dark.constants={DAYS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],PI:Math.PI,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4,EIGHTH_PI:Math.PI/8,E:Math.E,PHI:(1+Math.sqrt(5))/2,TAU:2*Math.PI,EPSILON:Number.EPSILON,RED_MASK:4278255615,GREEN_MASK:4294902015,BLUE_MASK:4294967040,ALPHA_MASK:16777215,ROUND:0,FLAT:1,DEGREES:2,RADIANS:3,VERTEX:4,CURVE:5,BEZIER:6,CLOSE:7,OPEN:8,CENTER:9,CORNER:10,WIDTH:11,HEIGHT:12,NORMAL:13,BOLD:14,ITALIC:15,BEVEL:16,MITER:17,SQUARE:18,LEFT:19,RIGHT:20,TOP:21,BOTTOM:22,BASELINE:23,HANGING:24,GET:25,SET:26,RADIUS:27,KEY:28,CLICK:29,SCROLL:30,LINEAR:31,RADIAL:32,CONIC:33,RGB:34,RGBA:34,ARGB:34,SRGB:34,HSB:35,HSBA:35,HSV:35,HSVA:35,HSL:36,HSLA:36,HEX:37,CMYK:38,CMY:38,HWB:39,LCH:40,PERLIN:50,SIMPLEX:51,WORLEY:52,VALUE:53,RANDOM:54,INVERT:55,OPAQUE:56,GRAY:57,ERODE:58,DILATE:59,THRESHOLD:60,POSTERIZE:61,BLUR:62,SHARPEN:63,SEPIA:64,OUTLINE:65,SWIRL:66,EDGE:67,CONTRAST:68,VIGNETTE:69,BRIGHTNESS:70,BLACK:71,WHITE:72,NORMALIZE:73,BOX:74,TRANSPARENCY:75,PIXELATE:76,FISHEYE:77,EMBOSS:78,SOBEL:79,RED:80,GREEN:81,BLUE:82,SATURATION:83,BLOOM:84},Dark.filters=[Dark.constants.INVERT,Dark.constants.OPAQUE,Dark.constants.GRAY,Dark.constants.ERODE,Dark.constants.DILATE,Dark.constants.THRESHOLD,Dark.constants.POSTERIZE,Dark.constants.BLUR,Dark.constants.SHARPEN,Dark.constants.SEPIA,Dark.constants.OUTLINE,Dark.constants.SWIRL,Dark.constants.EDGE,Dark.constants.CONTRAST,Dark.constants.VIGNETTE,Dark.constants.BRIGHTNESS,Dark.constants.BLACK,Dark.constants.WHITE,Dark.constants.NORMALIZE,Dark.constants.BOX,Dark.constants.TRANSPARENCY,Dark.constants.PIXELATE,Dark.constants.FISHEYE,Dark.constants.EMBOSS,Dark.constants.SOBEL,Dark.constants.RED,Dark.constants.GREEN,Dark.constants.BLUE,Dark.constants.SATURATION],Dark.special={16:"shift",13:"enter",8:"delete",9:"tab",27:"escape",32:"space",18:"option",17:"control",91:"left_meta",93:"right_meta",38:"up",40:"down",37:"left",39:"right",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",20:"capslock",190:"period",188:"comma",191:"slash",192:"backtick",220:"backslash",48:"zero",49:"one",50:"two",51:"three",52:"four",53:"five",54:"six",55:"seven",56:"eight",57:"nine",189:"minus",187:"equals",219:"left_bracket",221:"right_bracket",222:"single_quote",186:"semicolon"},Dark.cursors=["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out"],Dark.imageLocationsKA=["avatars/aqualine-sapling","avatars/aqualine-seed","avatars/aqualine-seedling","avatars/aqualine-tree","avatars/aqualine-ultimate","avatars/avatar-team","avatars/duskpin-sapling","avatars/duskpin-seed","avatars/duskpin-seedling","avatars/duskpin-tree","avatars/duskpin-ultimate","avatars/leaf-blue","avatars/leaf-green","avatars/leaf-grey","avatars/leaf-orange","avatars/leaf-red","avatars/leaf-yellow","avatars/leafers-sapling","avatars/leafers-seed","avatars/leafers-seedling","avatars/leafers-tree","avatars/leafers-ultimate","avatars/marcimus","avatars/marcimus-orange","avatars/marcimus-purple","avatars/marcimus-red","avatars/mr-pants","avatars/mr-pants-green","avatars/mr-pants-orange","avatars/mr-pants-pink","avatars/mr-pants-purple","avatars/mr-pants-with-hat","avatars/mr-pink","avatars/mr-pink-green","avatars/mr-pink-orange","avatars/old-spice-man","avatars/old-spice-man-blue","avatars/orange-juice-squid","avatars/piceratops-sapling","avatars/piceratops-seed","avatars/piceratops-seedling","avatars/piceratops-tree","avatars/piceratops-ultimate","avatars/primosaur-sapling","avatars/primosaur-seed","avatars/primosaur-seedling","avatars/primosaur-tree","avatars/primosaur-ultimate","avatars/purple-pi","avatars/purple-pi-pink","avatars/purple-pi-teal","avatars/questionmark","avatars/robot_female_1","avatars/robot_female_2","avatars/robot_female_3","avatars/robot_male_1","avatars/robot_male_2","avatars/robot_male_3","avatars/spunky-sam","avatars/spunky-sam-green","avatars/spunky-sam-orange","avatars/spunky-sam-red","avatars/starky-sapling","avatars/starky-seed","avatars/starky-seedling","avatars/starky-tree","avatars/starky-ultimate","creatures/Hopper-Happy","creatures/Hopper-Cool","creatures/Hopper-Jumping","creatures/OhNoes","creatures/OhNoes-Hmm","creatures/OhNoes-Happy","creatures/BabyWinston","creatures/Winston","cute/Blank","cute/BrownBlock","cute/CharacterBoy","cute/CharacterCatGirl","cute/CharacterHornGirl","cute/CharacterPinkGirl","cute/CharacterPrincessGirl","cute/ChestClosed","cute/ChestLid","cute/ChestOpen","cute/DirtBlock","cute/DoorTallClosed","cute/DoorTallOpen","cute/EnemyBug","cute/GemBlue","cute/GemGreen","cute/GemOrange","cute/GrassBlock","cute/Heart","cute/Key","cute/PlainBlock","cute/RampEast","cute/RampNorth","cute/RampSouth","cute/RampWest","cute/Rock","cute/RoofEast","cute/RoofNorth","cute/RoofNorthEast","cute/RoofNorthWest","cute/RoofSouth","cute/RoofSouthEast","cute/RoofSouthWest","cute/RoofWest","cute/Selector","cute/ShadowEast","cute/ShadowNorth","cute/ShadowNorthEast","cute/ShadowNorthWest","cute/ShadowSideWest","cute/ShadowSouth","cute/ShadowSouthEast","cute/ShadowSouthWest","cute/ShadowWest","cute/Star","cute/StoneBlock","cute/StoneBlockTall","cute/TreeShort","cute/TreeTall","cute/TreeUgly","cute/WallBlock","cute/WallBlockTall","cute/WaterBlock","cute/WindowTall","cute/WoodBlock","space/background","space/beetleship","space/collisioncircle","space/girl1","space/girl2","space/girl3","space/girl4","space/girl5","space/healthheart","space/minus","space/octopus","space/planet","space/plus","space/rocketship","space/star","space/0","space/1","space/2","space/3","space/4","space/5","space/6","space/7","space/8","space/9","animals/birds_rainbow-lorakeets","animals/butterfly","animals/butterfly_monarch","animals/cat","animals/cheetah","animals/crocodiles","animals/dog_sleeping-puppy","animals/dogs_collies","animals/fox","animals/horse","animals/kangaroos","animals/komodo-dragon","animals/penguins","animals/rabbit","animals/retriever","animals/shark","animals/snake_green-tree-boa","animals/spider","landscapes/beach-at-dusk","landscapes/beach-in-hawaii","landscapes/beach-sunset","landscapes/beach-waves-at-sunset","landscapes/beach-waves-daytime","landscapes/beach-with-palm-trees","landscapes/beach","landscapes/clouds-from-plane","landscapes/crop-circle","landscapes/fields-of-grain","landscapes/fields-of-wine","landscapes/lake","landscapes/lava","landscapes/lotus-garden","landscapes/mountain_matterhorn","landscapes/mountains-and-lake","landscapes/mountains-in-hawaii","landscapes/mountains-sunset","landscapes/sand-dunes","landscapes/waterfall_niagara-falls","food/bananas","food/berries","food/broccoli","food/brussels-sprouts","food/cake","food/chocolates","food/coffee-beans","food/croissant","food/dumplings","food/fish_grilled-snapper","food/fruits","food/grapes","food/hamburger","food/ice-cream","food/mushroom","food/oysters","food/pasta","food/potato-chips","food/potatoes","food/shish-kebab","food/strawberries","food/sushi","food/tomatoes","seasonal/father-winston","seasonal/fireworks-2015","seasonal/fireworks-in-sky","seasonal/fireworks-over-harbor","seasonal/fireworks-scattered","seasonal/gingerbread-family","seasonal/gingerbread-house","seasonal/gingerbread-houses","seasonal/gingerbread-man","seasonal/hannukah-dreidel","seasonal/hannukah-menorah","seasonal/hopper-elfer","seasonal/hopper-partying","seasonal/hopper-reindeer","seasonal/house-with-lights","seasonal/reindeer","seasonal/snow-crystal1","seasonal/snow-crystal2","seasonal/snow-crystal3","seasonal/snownoes","seasonal/snowy-slope-with-trees"],Dark.ignoreGlobal=["darkObject","info","empties","raf","begin","vertices","transforms","styles","saves","vertexCache","imageCache","settings","constants","objects","defaultSettings","isMain","canvas","ctx","dummy","loaded","began","randomGenerator","precomputed","editable"],Dark.singleDefinitions=[{path:["objects"],properties:["DVector","DFont","DImage","DMatrix","DRandom","DTimer","DIdentification","DGradient"]},{path:["constants"],properties:Object.keys(Dark.constants)}],Dark.styleIgnore=["canvas","width","height"],Dark.mouseMap=["left","middle","right","back","forward"],Dark.externals={},Dark.cache={images:{successes:0,items:{}},fonts:{successes:0,items:{}}},Dark.precomputed={BYTE:1/255,SIXTH:1/6,DEGREES:180/Math.PI,RADIANS:Math.PI/180,CIRCLE:360},Dark.externals.errorCount=0,Dark.externals.khanImagePreload=!0,Dark.maxErrorCount=50,Dark.maxStackSize=500,Dark.maxSearchDepth=10,Dark.maxLoopSaftey=100,Dark.url=new URL(location.href),Dark.khan="www.kasandbox.org"==Dark.url.host,Dark.editor="127.0.0.1:4444"==Dark.url.host,Dark.setDeep=function(e,t,a){let r=t.pop(),n=e;return t.forEach(e=>n=n[e]),n[r]=a,e},Dark.getDeep=function(e,t){let a=e;return t.forEach(e=>a=a[e]),a},Dark.isNative=function(e){return null!=e&&"function"==typeof e&&"{ [native code] }"==e.constructor.toString().slice(e.constructor.name.length+12)},Dark.objectLike=function(e){return null!=e&&("object"==typeof e||"function"==typeof e&&0!=Object.keys(e).length)},Dark.clone=function(e,t=0,a=[],r=[]){if(0==t){if(Dark.objectLike(e)&&e.constructor!==Object&&!Dark.utils.isArray(e))return Dark.clone([e])[0];Dark.clone.paths=[]}if(t>Dark.maxSearchDepth||!Dark.objectLike(e))return e;{(r=[...r]).push(e);let n={};for(let i in e){let s=e[i],o=a.concat(i);if(r.includes(s))Dark.clone.paths.push({path:o,point:r.slice(0,r.indexOf(s))});else if(Dark.utils.isArray(s)){let l=Dark.clone(s,t+1,o,r);l.length=Object.keys(l).length,n[i]=Array.from(l)}else if("object"!=typeof s||null==s||Dark.isNative)n[i]=s;else if(s.constructor===Object)n[i]=Dark.clone(s,t+1,o,r);else{let c=Object.create(s.constructor.prototype);for(let h in s)c[h]=s[h];n[i]=c}}return 0==t&&(Dark.clone.paths.sort((e,t)=>e.path.length-t.path.length),Dark.clone.paths.forEach(e=>Dark.setDeep(n,e.path,Dark.getDeep(n,e.point)))),n}},Dark.format=function(e){return"object"==typeof Dark.clone(e)?JSON.stringify(Dark.clone(e),Dark.bigintChecker,"    "):String(e)},Dark.printObject=function(e){console.log({...e})},Dark.bigintChecker=function(e,t){return"bigint"==typeof t?t.toString():t},Dark.noop=function(){},Dark.externals.windowLoaded=!1,addEventListener("load",()=>Dark.externals.windowLoaded=!0),Dark.rectRect=function(e,t,a,r,n,i,s,o){return e+a>n&&e<n+s&&t+r>i&&t<i+o},Dark.createCanvas=function(e,t){let a=document.createElement("canvas");return[a.width,a.height]=[e,t],a},Dark.doError=function(e,t){Dark.externals.errorCount==Dark.maxErrorCount?console.warn("Too many warnings and errors have been made, the rest will not display."):Dark.externals.errorCount<Dark.maxErrorCount&&console[e](t),Dark.externals.errorCount++},Dark.warn=function(e){Dark.doError("warn",e)},Dark.error=function(e){Dark.doError("error",e instanceof Error?e:Error(e))},Dark.observe=function(e,t,a){3==arguments.length&&t!=Dark.constants.GET&&t!=Dark.constants.SET&&Dark.error("Invalid type, must be either GET or SET"),e=new Proxy(e,{get:(e,r)=>(t==Dark.constants.GET&&a(r),e[r]),set(e,r,n){t==Dark.constants.SET&&a(r,n),e[r]=n}})},Dark.setMain=function(e){e instanceof Dark?(Dark.externals.main&&(Dark.externals.main.isMain=!1),Dark.externals.main=e,e.isMain=!0):Dark.error(`${e} is not an instance of Dark`)},Dark.getMain=function(){return Dark.externals.main},window.OffscreenCanvas??=Dark.createCanvas,Dark.fileCacheKA={"/filters/global.vert":"# version 300 es\nprecision lowp float;\nin vec2 vertPos;\nin vec2 vertUV;\nout vec2 uv;\nout vec2 pos;\nvoid main() {\n pos = vertPos;\n uv = vertUV;\n gl_Position = vec4(vertPos, 0.0, 1.0);\n}","/filters/invert.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(1.0 - tex.rgb, tex.a);\n}","/filters/opaque.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb, 1.0);\n}","/filters/grayscale.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Based on how human eyes precieve\n color = vec4(vec3(luminance), tex.a);\n}","/filters/threshold.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance > param) {\n color = vec4(vec3(1.0), 1.0);\n } else {\n color = vec4(vec3(0.0), 1.0);\n }\n}","/filters/posterize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nfloat posterize(float val) {\n return floor(val * param + 0.5) / param;\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float red = posterize(tex.r);\n float green = posterize(tex.g);\n float blue = posterize(tex.b);\n \n color = vec4(red, green, blue, 1.0);\n}","/filters/black.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance <= param) {\n color = vec4(vec3(0.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/white.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance >= param) {\n color = vec4(vec3(1.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/vignette.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n vec2 pos = (uv * 2.0 - 1.0) * param;\n float dist = 1.0 - sqrt(pos.x * pos.x + pos.y * pos.y);\n color = vec4(tex.rgb * dist, tex.a);\n}","/filters/box.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n vec4 total = vec4(0.0);\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n total += texture(sampler, uv + vec2(x, y) / size);\n }\n }\n color = vec4(total / count);\n}","/filters/brightness.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb + param, tex.a);\n}","/filters/transparency.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb, tex.a - param);\n}","/filters/sepia.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(\n 0.393 * tex.r + 0.769 * tex.g + 0.189 * tex.b,\n 0.349 * tex.r + 0.686 * tex.g + 0.168 * tex.b,\n 0.272 * tex.r + 0.534 * tex.g + 0.131 * tex.b,\n tex.a\n );\n}","/filters/pixelate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec2 snap(vec2 point) {\n return floor(point * size / param) * param / size;\n}\nvoid main() {\n vec4 tex = texture(sampler, snap(uv));\n \n color = tex;\n}","/filters/sharpen.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n 0.0, -1.0, 0.0,\n -1.0, 5.0, -1.0,\n 0.0, -1.0, 0.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/outline.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n -1.0, -1.0, -1.0,\n -1.0, 8.0, -1.0,\n -1.0, -1.0, -1.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/edge.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n 0.0, 1.0, 0.0,\n 1.0, -4.0, 1.0,\n 0.0, 1.0, 0.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/normalize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb / length(tex.rgb), tex.a);\n}","/filters/erode.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nfloat luminance(vec4 col) {\n return 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b; // from grayscale\n}\nvoid main() {\n vec4 middle = get(0.0, 0.0);\n vec4 top = get(0.0, 1.0);\n vec4 bottom = get(0.0, -1.0);\n vec4 right = get(1.0, 0.0);\n vec4 left = get(-1.0, 0.0);\n float lumMiddle = luminance(middle);\n float lumTop = luminance(top);\n float lumBottom = luminance(bottom);\n float lumRight = luminance(right);\n float lumLeft = luminance(left);\n if(lumBottom > lumMiddle) {\n color = bottom;\n } else if(lumTop > lumMiddle) {\n color = top;\n } else if(lumRight > lumMiddle) {\n color = right;\n } else if(lumLeft > lumMiddle) {\n color = left;\n } else {\n color = middle;\n }\n}","/filters/dilate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nfloat luminance(vec4 col) {\n return 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b; // from grayscale\n}\nvoid main() {\n vec4 middle = get(0.0, 0.0);\n vec4 top = get(0.0, 1.0);\n vec4 bottom = get(0.0, -1.0);\n vec4 right = get(1.0, 0.0);\n vec4 left = get(-1.0, 0.0);\n float lumMiddle = luminance(middle);\n float lumTop = luminance(top);\n float lumBottom = luminance(bottom);\n float lumRight = luminance(right);\n float lumLeft = luminance(left);\n if(lumBottom < lumMiddle) {\n color = bottom;\n } else if(lumTop < lumMiddle) {\n color = top;\n } else if(lumRight < lumMiddle) {\n color = right;\n } else if(lumLeft < lumMiddle) {\n color = left;\n } else {\n color = middle;\n }\n}","/filters/blur.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\n#define TAU (6.2831853071795864769252867665590057683943)\nvoid main() { \n vec4 total = vec4(0.0);\n float matrixTotal = 0.0;\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n vec4 tex = texture(sampler, uv + vec2(x, y) / size);\n float gaussian = exp(- (x * x + y * y) / (2.0 * param * param)) / (TAU * param * param);\n matrixTotal += gaussian;\n total += vec4(tex.rgb * gaussian, tex.a);\n }\n }\n color = total / matrixTotal;\n}","/filters/swirl.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define radius (0.5)\nvoid main() {\n vec2 cUV = uv - vec2(0.5); // centered UV\n float len = length(cUV);\n float theta = atan(cUV.y, cUV.x) + param * smoothstep(radius, 0.0, len);\n float dist = length(cUV);\n vec4 tex = texture(sampler, vec2(dist * cos(theta), dist * sin(theta)) + vec2(0.5));\n \n color = tex;\n}","/filters/contrast.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4((tex.rgb - 0.5) * param + 0.5, tex.a);\n}","/filters/fisheye.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nuniform vec2 size;\nin vec2 uv;\nin vec2 pos;\nout vec4 color;\n#define R2 1.414213562373095048801688\nvoid main() {\n float shifted = 2.0 - param;\n float squareness = shifted * shifted * shifted * shifted;\n vec2 c = pos * size / min(size.x, size.y) / squareness;\n float xsq = c.x * c.x;\n float ysq = c.y * c.y;\n vec2 worldMap = vec2(\n 0.5 * (sqrt(2.0 + xsq - ysq + 2.0 * c.x * R2) - sqrt(2.0 + xsq - ysq - 2.0 * c.x * R2)),\n 0.5 * (sqrt(2.0 - xsq + ysq + 2.0 * c.y * R2) - sqrt(2.0 - xsq + ysq - 2.0 * c.y * R2))\n ) * squareness;\n vec2 mapped = (worldMap + 1.0) / 2.0;\n \n if(abs(worldMap.x) <= 1.0 && abs(worldMap.y) <= 1.0) {\n color = texture(sampler, mapped);\n } else {\n color = vec4(vec3(0.0), 1.0);\n }\n}","/filters/emboss.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n -2.0, -1.0, 0.0,\n -1.0, 1.0, 1.0,\n 0.0, 1.0, 2.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/sobel.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nuniform float[9] kernel;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/red.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float inv = 1.0 - param;\n color = vec4(tex.r * param, tex.gb * inv, tex.a);\n}","/filters/green.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float inv = 1.0 - param;\n color = vec4(tex.r * inv, tex.g * param, tex.b * inv, tex.a);\n}","/filters/blue.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float inv = 1.0 - param;\n color = vec4(tex.rg * inv, tex.b * param, tex.a);\n}","/filters/saturation.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n float s = (param / 100.0 + 0.5);\n color = vec4(mix(vec3(luminance), tex.rgb, s), tex.a);\n}"},Dark.compileListKA=[],Dark.loadFile=function(e){if(Dark.khan)return Dark.fileCacheKA[e];{Dark.editor||(e=`https://cdn.jsdelivr.net/gh/99TheDark/Dark.js@${Dark.version}/filters/${e}`);let t=null,a=new XMLHttpRequest;return a.open("GET",e,!1),a.send(),200==a.status&&(t=a.responseText),Dark.editor&&Dark.compileListKA.push({location:e,contents:t.replace(/\n\n+/g,"\n").replace(/  +/g," ")}),t}},Dark.compileKA=function(){Dark.editor&&Dark.compileListKA.forEach(e=>Dark.fileCacheKA[e.location]=e.contents)},Dark.globallyUpdateVariables=function(e){if(e.isMain){for(let t in Dark.editable.forEach(t=>{window[t]&&(e[t]=window[t])}),e)if(!Dark.ignoreGlobal.includes(t)&&!Dark.editable.includes(t)){if("object"!=typeof e[t]||e[t].darkObject||"keys"==t)window[t]=e[t];else for(let a in e[t])window[a]=e[t][a]}}},Dark.defineConstants=function(){Dark.singleDefinitions.forEach(e=>{let t=Dark.getDeep(Dark,e.path);e.properties.forEach(e=>{try{Object.defineProperty(window,e,{value:t[e],writable:!1,configurable:!1})}catch{}})})},Dark.objects=(()=>{let e=Dark.constants,t=Dark.precomputed,a=function(e,t,r){if(!(this instanceof a))return new(Function.prototype.bind.apply(a,[null].concat(...arguments)));switch(this.darkObject=!0,arguments.length){default:Dark.error("DVector requires 2 or 3 parameters, not "+arguments.length);break;case 3:this.x=e,this.y=t,this.z=r,this.is2D=!1;break;case 2:this.x=e,this.y=t,this.is2D=!0}};a.create=function(e,t,r){return new a(e,t,r)},a.zero2D=function(){return new a(0,0)},a.prototype.zero2D=function(){return[this.x,this.y,this.z,this.is2D]=[0,0,void 0,!0],this},a.zero3D=function(){return new a(0,0,0)},a.prototype.zero3D=function(){return[this.x,this.y,this.z]=[0,0,0],this},a.prototype.reset=function(){this.is2D?[this.x,this.y]=[0,0]:[this.x,this.y,this.z]=[0,0,0]},a.add=function(e,t){return t instanceof a?e.is2D?new a(e.x+t.x,e.y+t.y):new a(e.x+t.x,e.y+t.y,e.z+t.z):e.is2D?new a(e.x+t,e.y+t):new a(e.x+t,e.y+t,e.z+t)},a.prototype.add=function(e){return e instanceof a?(this.x+=e.x,this.y+=e.y,this.z+=e.z):(this.x+=e,this.y+=e,this.z+=e),this},a.sub=function(e,t){return t instanceof a?e.is2D?new a(e.x-t.x,e.y-t.y):new a(e.x-t.x,e.y-t.y,e.z-t.z):e.is2D?new a(e.x-t,e.y-t):new a(e.x-t,e.y-t,e.z-t)},a.prototype.sub=function(e){return e instanceof a?(this.x-=e.x,this.y-=e.y,this.z-=e.z):(this.x-=e,this.y-=e,this.z-=e),this},a.mult=function(e,t){return t instanceof a?e.is2D?new a(e.x*t.x,e.y*t.y):new a(e.x*t.x,e.y*t.y,e.z*t.z):t instanceof i||t instanceof DOMMatrix?(t instanceof DOMMatrix&&(t=new i(t)),e.is2D)?new a(e.x*t.get(0,0)+e.y*t.get(1,0)+t.get(3,0),e.x*t.get(0,1)+e.y*t.get(1,1)+t.get(3,1)):new a(e.x*t.get(0,0)+e.y*t.get(1,0)+e.z*t.get(2,0)+t.get(3,0),e.x*t.get(0,1)+e.y*t.get(1,1)+e.z*t.get(2,1)+t.get(3,1),e.x*t.get(0,2)+e.y*t.get(1,2)+e.z*t.get(2,2)+t.get(3,2)):e.is2D?new a(e.x*t,e.y*t):new a(e.x*t,e.y*t,e.z*t)},a.prototype.mult=function(e){return e instanceof a?(this.x*=e.x,this.y*=e.y,this.z*=e.z):e instanceof i||e instanceof DOMMatrix?(e instanceof DOMMatrix&&(e=new i(e)),this.z,this.x,e.get(0,0),this.y,e.get(1,0),e.get(2,0),e.get(3,0),this.x,e.get(0,1),this.y,e.get(1,1),e.get(2,1),e.get(3,1),this.x,e.get(0,2),this.y,e.get(1,2),e.get(2,2),e.get(3,2)):(this.x*=e,this.y*=e,this.z*=e),this},a.div=function(e,t){return t instanceof a?e.is2D?new a(e.x/t.x,e.y/t.y):new a(e.x/t.x,e.y/t.y,e.z/t.z):e.is2D?new a(e.x/t,e.y/t):new a(e.x/t,e.y/t,e.z/t)},a.prototype.div=function(e){return e instanceof a?(this.x/=e.x,this.y/=e.y,this.z/=e.z):(this.x/=e,this.y/=e,this.z/=e),this},a.pow=function(e,t){return t instanceof a?new a(e.x**t.x,e.y**t.y,e.z**t.z):new a(e.x**t,e.y**t,e.z**t)},a.prototype.pow=function(e){return e instanceof a?(this.x**=e.x,this.y**=e.y,this.z**=e.z):(this.x**=e,this.y**=e,this.z**=e),this},a.angle=function(e){return Dark.utils.atan2(e.y,e.x)},a.prototype.angle=function(){return Dark.utils.atan2(this.y,this.x)},a.angleBetween=function(e,t){return Dark.utils.atan2(t.y-e.y,t.x-e.x)},a.prototype.angleBetween=function(e){return a.angleBetween(this,e)},a.mag=function(e){return e.mag()},a.prototype.mag=function(){return this.is2D?Math.sqrt(this.x*this.x+this.y*this.y):Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.magSq=function(e){return e.magSq()},a.prototype.magSq=function(){return this.is2D?this.x*this.x+this.y*this.y:this.x*this.x+this.y*this.y+this.z*this.z},a.setMag=function(e,t){e.normalize(),e.mult(t)},a.prototype.setMag=function(e){return this.normalize(),this.mult(e),this},a.getRotation=function(e){return Dark.utils.atan2(e.y,e.x)},a.prototype.getRotation=function(){return Dark.utils.atan2(this.y,this.x)},a.setRotation=function(e,t){let r=e.mag();return new a(r*Dark.utils.cos(t),r*Dark.utils.sin(t))},a.prototype.setRotation=function(e){let t=this.mag();return[this.x,this.y]=[t*Dark.utils.cos(e),t*Dark.utils.sin(e)],this},a.rotate=function(e,t){e.setRotation(e.getRotation()+t)},a.prototype.rotate=function(e){return this.setRotation(this.getRotation()+e),this},a.normalize=function(e){let t=e.mag();return 0!=t?a.div(e,t):e.get()},a.prototype.normalize=function(){let e=this.mag();return 0!=e&&this.div(e),this},a.cross=function(e,t){return new a(e.y*t.z-t.y*e.z,e.z*t.x-t.z*e.x,e.x*t.y-t.x*e.y)},a.prototype.cross=function(e){return a.cross(this,e)},a.dot=function(e,t){return"number"==typeof t?e.is2D?e.x*t+e.y*t:e.x*t+e.y*t+e.z*t:e.is2D&&t.is2D?e.x*t.x+e.y*t.y:e.is2D||t.is2D?void Dark.error("Cannot take the dot product of a 2D and 3D vector"):e.x*t.x+e.y*t.y+e.z*t.z},a.prototype.dot=function(e){return a.dot(this,e)},a.flip=function(e){return new Vector(-e.x,-e.y,-e.z)},a.prototype.flip=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.limit=function(e,t){return e.mag()>t&&e.mult(t/e.mag()),e},a.prototype.limit=function(e){return this.mag()>e&&this.mult(e/this.mag()),this},a.lerp=function(e,t,r){return new a(Dark.utils.lerp(e.x,t.x,r),Dark.utils.lerp(e.y,t.y,r),Dark.utils.lerp(e.z,t.z,r))},a.prototype.lerp=function(e,t){return this.x=Dark.utils.lerp(this.x,e.x,t),this.y=Dark.utils.lerp(this.y,e.y,t),this.z=Dark.utils.lerp(this.z,e.z,t),this},a.abs=function(e){return e.is2D?new a(Math.abs(e.x),Math.abs(e.y)):new a(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))},a.prototype.abs=function(){return[this.x,this.y,this.z]=[Math.abs(this.x),Math.abs(this.y),Math.abs(this.z)],this},a.dist=function(e,t){let a,r,n=0;return e.is2D&&t.is2D?(a=t.x-e.x,r=t.y-e.y):e.is2D||t.is2D?Dark.error("Cannot find the distance between a 2D and 3D DVector"):(a=t.x-e.x,r=t.y-e.y,n=t.z-e.z),Math.sqrt(a*a+r*r+n*n)},a.prototype.dist=function(e){return a.dist(this,e)},a.applyTransform=function(e,t){return a.mult(e,t)},a.prototype.applyTransform=function(e){return this.mult(e),this},a.get=function(e){return e.get()},a.prototype.get=function(){return this.is2D?new a(this.x,this.y):new a(this.x,this.y,this.z)},a.set=function(e,...t){e.set.apply(null,t)},a.prototype.set=function(...e){let t=e[0];return Array.isArray(t)?[this.x,this.y,this.z]=t:"object"==typeof t?[this.x,this.y,this.z]=[t.x,t.y,t.z]:[this.x,this.y,this.z]=e,this.is2D&&(this.z=void 0),this},a.toArray=function(e){return e.toArray()},a.prototype.toArray=function(){return this.is2D?[this.x,this.y]:[this.x,this.y,this.z]},a.fromArray=function(e){return a.create.apply(null,e)},a.prototype.fromArray=function(e){switch(e.length){default:Dark.error("DVector.fromArray takes in an array of length 2 or 3, not "+e.length);break;case 2:[this.x,this.y]=e,this.z=void 0,this.is2D=!0;break;case 3:[this.x,this.y,this.z]=e,this.is2D=!1}return this},a.prototype.toString=function(){return this.is2D?`[${this.x}, ${this.y}]`:`[${this.x}, ${this.y}, ${this.z}]`};let r=function(...e){if(!(this instanceof r))return new(Function.prototype.bind.apply(r,[null].concat(...arguments)));if(this.darkObject=!0,this.loadedFromSource=!1,e.length>1)this.family=e[0]??r.defaults.family,this.size=e[1]??r.defaults.size,this.weight=e[2]??r.defaults.weight,this.style=e[3]??r.defaults.style,this.variant=e[4]??r.defaults.variant;else if("string"==typeof e[0])this.parse(e[0]);else if("object"==typeof e[0]){if(Array.isArray(e)){let t=e[0];this.family=t[0]??r.defaults.family,this.size=t[1]??r.defaults.size,this.weight=t[2]??r.defaults.weight,this.style=t[3]??r.defaults.style,this.variant=t[4]??r.defaults.variant}else{let a=e[0];this.family=a.family??r.defaults.family,this.size=a.size??r.defaults.size,this.weight=a.weight??r.defaults.weight,this.style=a.style??r.defaults.style,this.variant=a.variant??r.defaults.variant}}else 0==e.length?(this.loadedFromSource=!0,this.loaded=!1,this.family=r.defaults.family,this.size=r.defaults.size,this.weight=r.defaults.weight,this.style=r.defaults.style,this.variant=r.defaults.variant):Dark.error("Invalid DFont input")};r.parse=function(e){return new r(e)},r.prototype.parse=function(e){this.style=r.defaults.style,this.variant=r.defaults.variant,this.weight=r.defaults.weight,this.size=r.defaults.size,this.family=r.defaults.family;let t=e.split(" ");for(let a in t){let n=t[a];switch(n){case"normal":break;case"italic":this.style="italic";break;case"bold":this.weight="bold"}if("italic"==n)this.style="italic";else if("small-caps"==n)this.variant="small-caps";else if(r.weights.includes(n))this.weight=n;else if("normal"!==n){let i=parseInt(n);isNaN(i)?this.family=n:this.size=i}}},r.prototype.toString=function(){return`${this.style} ${this.weight} ${this.variant} ${this.size}px ${this.family}`},r.weights=["bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],r.defaults={family:"Arial",size:16,weight:"normal",style:"normal",variant:"normal"};let n=function(...e){if(!(this instanceof n))return new(Function.prototype.bind.apply(n,[null].concat(...arguments)));this.darkObject=!0,this.filters={},this.disposable=!1,this.sent=!1,this.loaded=!1,this.imageLoaded=!1,this.bitmapLoaded=!1,this.image=null,this.bitmap=null,this.loadedFromSource=!1,this.failed=!1,e[0]instanceof ImageData?(this.imageData=e[0],this.source=e[1],this.width=e[0].width,this.height=e[0].height,this.canvas=Dark.createCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.loadPixels()):"number"==typeof e[0]&&"number"==typeof e[1]?(this.width=e[0],this.height=e[1],this.source=e[2],this.imageData=new ImageData(this.width,this.height),this.canvas=Dark.createCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d")):e[0]instanceof OffscreenCanvas||e[0]instanceof HTMLCanvasElement?(this.width=e[0].width,this.height=e[0].height,this.source=e[1],this.canvas=e[0],this.ctx=this.canvas.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)):e[0]instanceof Dark?(this.width=e[0].width,this.height=e[0].height,this.source=e[0],this.canvas=Dark.createCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(e[0].canvas,0,0,this.width,this.height,0,0,this.width,this.height),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)):(this.imageData=null,this.source=e[0],this.width=0,this.height=0)};n.prototype.get=function(...e){switch(e.length){default:return Dark.error("DImage.get requires 0 or 4 parameters, not "+e.length);case 0:return this.copy();case 4:return new n(this.ctx.getImageData(e[0],e[1],e[2],e[3]),this.source)}},n.prototype.set=function(e,t,a){let r=(e+t*this.width)*4;return this.imageData.data[r]=Dark.utils.red(a),this.imageData.data[r+1]=Dark.utils.green(a),this.imageData.data[r+2]=Dark.utils.blue(a),this.imageData.data[r+3]=Dark.utils.alpha(a),this},n.prototype.copy=function(){let e=new n;return[e.width,e.height,e.imageData,e.source,e.disposable,e.sourceURL,e.loadComplete,e.loadedFromSource]=[this.width,this.height,this.imageData,this.source,this.disposable,this.sourceURL,this.loadComplete,this.loadedFromSource],e.canvas=Dark.createCanvas(this.width,this.height),e.ctx=e.canvas.getContext("2d"),e.ctx.drawImage(this.getRenderable(),0,0,this.width,this.height,0,0,this.width,this.height),e},n.prototype.getRenderable=function(){return this.loaded?this.image??this.bitmap:this.canvas},n.prototype.checkLoad=function(){let e=!this.loadedFromSource||this.loadComplete;return e||Dark.error("Cannot draw the image until loaded, put inside the setup or draw function instead"),e},n.resize=function(e,t,a){let r=e.copy();return r.setDisposability(!0),r.resize(t,a),r},n.prototype.resize=function(e,t){if(0==e||0==t)return Dark.error("Image resize size must be greater than zero");if(this.width!=e||this.height!=t){this.source instanceof Dark&&1==arguments.length&&(this.source.settings.resizeMode==this.source.constants.HEIGHT?[e,t]=[e/img.height*img.width,e]:[e,t]=[e,e/img.width*img.height]),[e,t]=[Math.ceil(e),Math.ceil(t)];let a=Dark.createCanvas(this.width,this.height);a.getContext("2d").drawImage(this.getRenderable(),0,0,this.width,this.height,0,0,this.width,this.height),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[e,t],this.ctx.fillRect(0,0,e,t),this.ctx.drawImage(a,0,0,e,t,0,0,e,t),this.loadImage()}return this},n.crop=function(e,t,a,r,n){let i=e.copy();return i.setDisposability(!0),i.crop(t,a,r,n),i},n.prototype.crop=function(e,t,a,r){if(a<=0||r<=0)return Dark.error("The image crop area must have a size greater than zero");if(e+a>this.width||t+r>this.height||e<0||t<0)return Dark.error("The cropped area must be within the image");if(this.width!=a||this.height!=r){this.source instanceof Dark&&3==arguments.length&&(this.source.settings.resizeMode==this.source.constants.HEIGHT?[a,r]=[a/img.height*img.width,a]:[a,r]=[a,a/img.width*img.height]);let n=Dark.createCanvas(this.width,this.height);n.getContext("2d").drawImage(this.getRenderable(),0,0,this.width,this.height,0,0,this.width,this.height),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[a,r],this.ctx.drawImage(n,e,t,a,r,0,0,a,r),this.loadImage()}return this},n.prototype.loadPixels=function(){return this.ctx.putImageData(this.imageData,0,0),this},n.prototype.updatePixels=function(){return this.imageData.data.set(this.ctx.getImageData(0,0,this.width,this.height).data),this},n.prototype.setDisposability=function(e){return this.disposable=e,this},n.filter=function(e,t,a){let r=e.copy();return r.filter(t,a),r},n.prototype.filter=function(e,t){if(!Dark.filters.includes(e))return Dark.error("Invalid filter type");{let a=n.filterShaders[e],r=this.filters;r.gl_canvas=n.gl_canvas,r.gl=n.gl,r.program=a.program,(r.gl_canvas.width!=this.width||r.gl_canvas.height!=this.height)&&([r.gl_canvas.width,r.gl_canvas.height]=[this.width,this.height],r.gl.viewport(0,0,this.width,this.height)),r.gl.useProgram(r.program),r.tris=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.tris),r.gl.bufferData(r.gl.ARRAY_BUFFER,n.texData,r.gl.STATIC_DRAW),r.trisIndex=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,r.trisIndex),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,n.texIndices,r.gl.STATIC_DRAW),r.fs=Float32Array.BYTES_PER_ELEMENT,r.posAttribLocation=r.gl.getAttribLocation(r.program,"vertPos"),r.uvAttribLocation=r.gl.getAttribLocation(r.program,"vertUV"),r.gl.vertexAttribPointer(r.posAttribLocation,2,r.gl.FLOAT,r.gl.FALSE,4*r.fs,0),r.gl.vertexAttribPointer(r.uvAttribLocation,2,r.gl.FLOAT,r.gl.FALSE,4*r.fs,2*r.fs),r.gl.enableVertexAttribArray(r.posAttribLocation),r.gl.enableVertexAttribArray(r.uvAttribLocation),r.sizeUniformLocation=r.gl.getUniformLocation(r.program,"size"),r.gl.uniform2f(r.sizeUniformLocation,this.width,this.height),a.multikernel?(Object.keys(a.multikernel).includes(String(t))||(t=a.defaultShader),r.kernelUniformLocation=r.gl.getUniformLocation(r.program,"kernel"),r.gl.uniform1fv(r.kernelUniformLocation,a.multikernel[t])):a.param&&(t=void 0!=t?Dark.utils.constrain(t,a.param.min,a.param.max):a.param.default,r.paramUniformLocation=r.gl.getUniformLocation(r.program,"param"),r.gl.uniform1f(r.paramUniformLocation,t)),r.applied??=[],r.applied.push({filter:e,parameter:t}),r.texture=r.gl.createTexture(),r.gl.bindTexture(r.gl.TEXTURE_2D,r.texture),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_S,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_T,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.LINEAR),r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,r.gl.RGBA,r.gl.UNSIGNED_BYTE,this.getRenderable()),r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindTexture(r.gl.TEXTURE_2D,r.texture),r.gl.activeTexture(r.gl.TEXTURE0),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.gl.drawElements(r.gl.TRIANGLES,n.texIndices.length,r.gl.UNSIGNED_SHORT,0);let i=new Uint8ClampedArray(this.width*this.height*4);r.gl.readPixels(0,0,this.width,this.height,r.gl.RGBA,r.gl.UNSIGNED_BYTE,i),this.imageData.data.set(i),this.ctx.putImageData(this.imageData,0,0),this.loadImage()}return this},n.texData=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),n.texIndices=new Uint16Array([0,1,2,1,2,3]),n.globalVertexShader=Dark.loadFile("/filters/global.vert"),n.filterShaders=[],n.gl_canvas=Dark.createCanvas(0,0),n.gl=n.gl_canvas.getContext("webgl2",{antialias:!1}),n.initializeShaders=function(e){let t=n.gl,a=n.globalVertexShader;if(!t)return Dark.warn("Your browser does not support WebGL2.");e.forEach(function(e){let r=Dark.loadFile(`/filters/${e.shader}.frag`),i=t.createShader(t.VERTEX_SHADER),s=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,a),t.shaderSource(s,r),t.compileShader(i),t.compileShader(s),!t.getShaderParameter(i,t.COMPILE_STATUS))return Dark.error("Error compiling vertex shader.\n\n"+t.getShaderInfoLog(i));if(!t.getShaderParameter(s,t.COMPILE_STATUS))return Dark.error("Error compiling fragment shader.\n\n"+t.getShaderInfoLog(s));let o=t.createProgram();return(t.attachShader(o,i),t.attachShader(o,s),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS))?(t.validateProgram(o),t.getProgramParameter(o,t.VALIDATE_STATUS))?void(n.filterShaders[e.key]={shader:r,param:e.param,program:o,multikernel:e.multikernel,defaultShader:e.defaultShader}):Dark.error("Error validating program.\n\n"+t.getProgramInfoLog(o)):Dark.error("Error linking program.\n\n"+t.getProgramInfoLog(o))})},n.prototype.generateImage=function(e){this.image=new Image,this.image.src=URL.createObjectURL(e),this.image.crossOrigin="anonymous",this.image.addEventListener("load",()=>{this.imageLoaded=!0,this.bitmapLoaded&&(this.loaded=!0,this.sent=!1)})},n.prototype.generateBitmap=function(){createImageBitmap(this.canvas).then(e=>{this.bitmap=e,this.bitmapLoaded=!0,this.imageLoaded&&(this.loaded=!0,this.sent=!1)})},n.animationFrames=[],n.awaitAnimationFrame=function(){let e,t=new Promise(t=>{e=t});return n.animationFrames.push({promise:t,resolve:e}),t},n.raf=function(){n.animationFrames.forEach(e=>e.resolve()),requestAnimationFrame(n.raf)},n.prototype.loadImage=function(){this.image=null,this.loaded=!1,this.imageLoaded=!1,this.bitmapLoaded=!1,Dark.khan||this.disposable||this.sent||(this.sent=!0,n.awaitAnimationFrame().then(()=>{this.generateBitmap(),this.canvas instanceof HTMLCanvasElement?this.canvas.toBlob((...e)=>this.generateImage.apply(this,e),{type:"image/png"}):this.canvas.convertToBlob({type:"image/png"}).then(e=>this.generateImage(e))}))},n.prototype.toDataArray=function(){return[...(this.imageData??{data:[]}).data]},n.get=(e,...t)=>e.get.apply(null,t),n.set=(e,...t)=>e.set.apply(null,t),n.copy=e=>e.copy(),n.getRenderable=e=>e.getRenderable(),n.loadPixels=e=>e.loadPixels(),n.updatePixels=e=>e.updatePixels(),n.setDisposability=(e,t)=>e.setDisposability(t),n.toDataArray=e=>e.toDataArray(),n.shaderSettings=[{key:e.INVERT,shader:"invert"},{key:e.OPAQUE,shader:"opaque"},{key:e.GRAY,shader:"grayscale"},{key:e.ERODE,shader:"erode"},{key:e.DILATE,shader:"dilate"},{key:e.THRESHOLD,shader:"threshold",param:{min:0,max:1,default:.5}},{key:e.POSTERIZE,shader:"posterize",param:{min:2,max:255,default:255}},{key:e.BLUR,shader:"blur",param:{min:0,max:25,default:1}},{key:e.SHARPEN,shader:"sharpen"},{key:e.SEPIA,shader:"sepia"},{key:e.OUTLINE,shader:"outline"},{key:e.SWIRL,shader:"swirl",param:{min:-12,max:12,default:4}},{key:e.EDGE,shader:"edge"},{key:e.CONTRAST,shader:"contrast",param:{min:0,max:15,default:3}},{key:e.VIGNETTE,shader:"vignette",param:{min:0,max:1,default:.5}},{key:e.BRIGHTNESS,shader:"brightness",param:{min:-1,max:1,default:0}},{key:e.BLACK,shader:"black",param:{min:0,max:1,default:0}},{key:e.WHITE,shader:"white",param:{min:0,max:1,default:1}},{key:e.NORMALIZE,shader:"normalize"},{key:e.BOX,shader:"box",param:{min:0,max:25,default:1}},{key:e.TRANSPARENCY,shader:"transparency",param:{min:0,max:1,default:0}},{key:e.PIXELATE,shader:"pixelate",param:{min:1,max:5e3,default:1}},{key:e.FISHEYE,shader:"fisheye",param:{min:0,max:1,default:1}},{key:e.EMBOSS,shader:"emboss"},{key:e.SOBEL,shader:"sobel",multikernel:Object.fromEntries([[e.TOP,[1,2,1,0,0,0,-1,-2,-1]],[e.BOTTOM,[-1,-2,-1,0,0,0,1,2,1]],[e.LEFT,[1,0,-1,2,0,-2,1,0,-1]],[e.RIGHT,[-1,0,1,-2,0,2,-1,0,1]]]),defaultShader:e.TOP},{key:e.RED,shader:"red",param:{min:-1,max:1,default:1}},{key:e.GREEN,shader:"green",param:{min:-1,max:1,default:1}},{key:e.BLUE,shader:"blue",param:{min:-1,max:1,default:1}},{key:e.SATURATION,shader:"saturation",param:{min:0,max:500,default:50}}],n.initializeShaders(n.shaderSettings),requestAnimationFrame(n.raf);let i=function(...e){if(!(this instanceof i))return new(Function.prototype.bind.apply(i,[null].concat(...arguments)));if(this.darkObject=!0,e[0]instanceof i)this.width=e[0].width,this.height=e[0].height,this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),this.set(e[0]);else if(Array.isArray(e[0]))this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),Array.isArray(e[0][0])?1==arguments.length?(this.width=e[0][0].length,this.height=e[0].length,this.set(e[0])):(this.width=arguments.length,this.height=e[0][0].length,this.set([...arguments])):(this.width=e[1],this.height=e[2],this.set(e[0]));else if(e[0]instanceof DOMMatrix){let t=e[0];this.width=4,this.height=4,this.mat=[[t.m11,t.m21,t.m31,t.m41],[t.m12,t.m22,t.m32,t.m42],[t.m13,t.m23,t.m33,t.m43],[t.m14,t.m24,t.m34,t.m44]]}else this.width=e[0],this.height=e[1],this.mat=Array(e[1]).fill(null).map(()=>Array(e[0]).fill(e[2]))};i.prototype.get=function(e,t){return this.mat[t][e]},i.set=function(e,t,a,r){e.set(t,a,r)},i.prototype.set=function(e,t,a){if(e instanceof i)for(let r=0;r<e.height;r++)for(let n=0;n<e.width;n++)this.mat[r][n]=e.mat[r][n];else if(Array.isArray(e)){if(Array.isArray(e[0]))for(let s=0;s<e.length;s++)for(let o=0;o<e[0].length;o++)this.mat[s][o]=e[s][o];else for(let l=0;l<this.width*this.height;l++){let c=l%this.width,h=Math.floor(l/this.width);this.mat[h][c]=e[l]}}else this.mat[t][e]=a;return this},i.dot=function(e,t,a,r){if(e.width==t.height){let n=0;for(let i=0;i<e.width;i++)n+=e.get(i,a)*t.get(r,i);return n}Dark.error("Can only take the dot product of two DMatrices  with equal width and height")},i.prototype.dot=function(e){return i.dot(this,e)},i.identity=function(e){let t=new i(e,e);for(let a=0;a<e;a++)t.set(a,a,1);return t},i.prototype.identity=function(){return this.width==this.height?this.mat=i.identity(this.width).mat:Dark.error("Only DMatrices with square dimensions have identity DMatrices"),this},i.transpose=function(e){let t=e.copy();return t.transpose(),t},i.prototype.transpose=function(){return this.mat=Array(this.width).fill().map((e,t)=>Array(this.height).fill().map((e,a)=>this.mat[a][t])),[this.width,this.height]=[this.height,this.width],this},i.normalize=function(e){let t=e.copy();return t.normalize(),t},i.prototype.normalize=function(){let e=this.getWeight();return this.mat=this.mat.map(t=>t.map(t=>t/e)),this},i.round=function(e,t){let a=e.copy();return a.round(t),a},i.prototype.round=function(e=0){let t=10**e;return this.mat=this.mat.map(e=>e.map(e=>Math.round(e*t)/t)),this},i.translate=function(e,t,a){let r=e.copy();return r.translate(t,a),r},i.prototype.translate=function(e,t){let a=this.toDOMMatrix();return a.translateSelf(e,t),this.fromDOMMatrix(a),this},i.rotate=function(e,t){let a=e.copy();return a.rotate(t),a},i.prototype.rotate=function(e){let t=this.toDOMMatrix();return t.rotateSelf(e),this.fromDOMMatrix(t),this},i.scale=function(e,t,a){let r=e.copy();return r.scale(t,a),r},i.prototype.scale=function(e,t=e){let a=this.toDOMMatrix();return a.scaleSelf(e,t),this.fromDOMMatrix(a),this},i.skew=function(e,t,a){let r=e.copy();return r.skew(t,a),r},i.prototype.skew=function(e,t=0){let a=this.toDOMMatrix();return a.skewYSelf(.01*e),a.skewXSelf(.01*t),this.fromDOMMatrix(a),this},i.translateX=function(e,t){let a=e.copy();return a.translateX(t),a},i.prototype.translateX=function(e){return this.translate(e,0),this},i.translateY=function(e,t){let a=e.copy();return a.translateY(t),a},i.prototype.translateY=function(e){return this.translate(0,e),this},i.scaleX=function(e,t){e.scaleX(t);let a=e.copy();return a.scaleX(t),a},i.prototype.scaleX=function(e){return this.scale(e,1),this},i.scaleY=function(e,t){let a=e.copy();return a.scaleY(t),a},i.prototype.scaleY=function(e){return this.scale(e,1),this},i.skewX=function(e,t){let a=e.copy();return a.skewX(t),a},i.prototype.skewX=function(e){return this.skew(e,0),this},i.skewY=function(e,t){let a=e.copy();return a.skewY(t),a},i.prototype.skewY=function(e){return this.skew(0,e),this},i.add=function(e,t){if("number"==typeof t){let a=new i(e.width,e.height);for(let r=0;r<a.height;r++)for(let n=0;n<a.width;n++)a.set(r,n,e.get(n,r)+t);return a}if(e.width==t.width&&e.height==t.height){let s=new i(e.width,e.height);for(let o=0;o<s.height;o++)for(let l=0;l<s.width;l++)s.set(o,l,e.get(l,o)+t.get(l,o));return s}Dark.error("Cannot add two DMatrices with different dimensions")},i.prototype.add=function(e){return this.set(i.add(this,e)),this},i.sub=function(e,t){if("number"==typeof t){let a=new i(e.width,e.height);for(let r=0;r<a.height;r++)for(let n=0;n<a.width;n++)a.set(r,n,e.get(n,r)-t);return a}if(e.width==t.width&&e.height==t.height){let s=new i(e.width,e.height);for(let o=0;o<s.height;o++)for(let l=0;l<s.width;l++)s.set(o,l,e.get(l,o)-t.get(l,o));return s}Dark.error("Cannot subtract two DMatrices with different dimensions")},i.prototype.sub=function(e){return this.set(i.sub(this,e)),this},i.mult=function(e,t){if("number"==typeof t){let a=new i(e.width,e.height);for(let r=0;r<a.height;r++)for(let n=0;n<a.width;n++)a.set(r,n,e.get(n,r)*t);return a}if(e.width==t.height){let s=new i(t.width,e.height);for(let o=0;o<s.height;o++)for(let l=0;l<s.width;l++)s.set(l,o,i.dot(e,t,o,l));return s}Dark.error("Can only multiply two DMatrices with equal width and height")},i.prototype.mult=function(e){let t=i.mult(this,e);return this.width=t.width,this.height=t.height,this.mat=t.mat,this},i.getWeight=function(e){return e.getWeight()},i.prototype.getWeight=function(){return this.toArray().reduce((e,t)=>e+=t,0)},i.copy=function(e){return new i([...e.mat])},i.prototype.copy=function(){return new i([...this.mat])},i.fromDOMMatrix=function(e){if(e instanceof DOMMatrix)return new i(e);Dark.error(`${e} is not a DOMMatrix`)},i.prototype.fromDOMMatrix=function(e){return e instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=new i(e).mat):Dark.error(`${e} is not a DOMMatrix`),this},i.toDOMMatrix=function(e){return e.toDOMMatrix()},i.prototype.toDOMMatrix=function(){return new DOMMatrix([this.get(0,0),this.get(0,1),this.get(1,0),this.get(1,1),this.get(3,0),this.get(3,1)])},i.prototype.toArray2D=function(){return[...this.mat]},i.prototype.toArray=function(){return[...this.mat.flat(1)]},i.prototype.toString=function(){let e="";for(let t in this.mat){for(let a in this.mat[t])e+=this.mat[t][a].toFixed(2)+" ";e=e.replace(/ $/,"\n")}return e};let s=function(e=1e6*Math.random()){if(!(this instanceof s))return new(Function.prototype.bind.apply(s,[null].concat(...arguments)));this.darkObject=!0,this.seed=e,this.a=0x9af1b04258d,this.b=13034335,this.c=6856007898,this.d=16647635*e};s.prototype.next=function(){let e=this.b<<9,t=this.a+this.d;return t=(t<<7|t>>>25)+this.a,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=e,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},s.copy=function(e){return e.copy()},s.prototype.copy=function(){let e=new s(this.seed);return[e.a,e.b,e.c,e.d]=[this.a,this.b,this.c,this.d],e},s.create=function(e){return new s(e)};let o=function(){if(!(this instanceof o))return new(Function.prototype.bind.apply(o,[null].concat(...arguments)));this.darkObject=!0,this.reset()};o.prototype.start=function(){return null==this.begin?this.begin=performance.now():Dark.error("DTimer.reset must be called before a new timer begins"),this},o.prototype.stop=function(){return null==this.start?Dark.error("DTimer.start must be called before DTimer.error"):(this.end=performance.now(),this.time=this.end-this.begin),this},o.prototype.reset=function(){return this.begin=null,this.end=null,this.time=null,this},o.prototype.copy=function(){let e=new o;return[e.start,e.end,e.time]=[this.begin,this.end,this.time],e},o.prototype.toString=function(){return null==this.start?`From ${this.begin.toFixed(2)} to ${this.end.toFixed(2)}, taking ${this.time.toFixed(2)} milliseconds`:"The timer has yet to begin"},o.prototype.getSecond=function(){return this.time/1e3},o.prototype.getMillis=function(){return this.time},o.prototype.getMicro=function(){return 1e3*this.time},o.prototype.getNano=function(){return 1e6*this.time},o.prototype.getFPS=function(){return 1e3/this.time},o.time=function(e){let t=performance.now();return e(),performance.now()-t},o.start=e=>void e.start(),o.stop=e=>void e.stop(),o.reset=e=>void e.reset(),o.copy=e=>e.copy(),o.toString=e=>e.toString();let l=function(){if(!(this instanceof l))return new(Function.prototype.bind.apply(l,[null].concat(...arguments)));this.darkObject=!0,l.current=BigInt(Math.abs(Math.floor(3452547895345*l.random.next()+Date.now()**3+performance.now())))*BigInt(Math.floor(1e3*l.random.next()))<<BigInt(Math.floor(20*l.random.next())),this.id=l.current.toString(36).substring(0,20)};l.current=Math.round(3457892375*Date.now()/50435),l.random=new s;let c=function(...t){if(!(this instanceof c))return new(Function.prototype.bind.apply(c,[null].concat(...arguments)));this.darkObject=!0,this.stops=[],this.mode=e.LINEAR;let a=1/t.length;t.forEach((e,t)=>this.stops.push({position:a*t,value:e}))};c.prototype.setMode=function(t){switch(t){default:Dark.error("Invalid DGradient mode");break;case e.LINEAR:this.mode=e.LINEAR;break;case e.RADIAL:this.mode=e.RADIAL;break;case e.CONIC:this.mode=e.CONIC}return this},c.prototype.toCanvasGradient=function(){let e=Dark.utils.ctx.createLinearGradient(0,0,1,0),a=Dark.utils.red(stop.value)*t.BYTE,r=Dark.utils.green(stop.value)*t.BYTE,n=Dark.utils.blue(stop.value)*t.BYTE,i=Dark.utils.alpha(stop.value)*t.BYTE;return this.stops.forEach(t=>e.addColorStop(t.position,`rgba(${a}, ${r}, ${n}, ${i})`)),e};let h=function(t,a){if(!(this instanceof h))return new(Function.prototype.bind.apply(h,[null].concat(...arguments)));switch(this.space=a,a){case e.RGB:[this.red,this.green,this.blue,this.alpha]=t;break;case e.HSV:[this.hue,this.saturation,this.value,this.alpha]=t}};return h.convert=function(t,a){return t.space==a?t:t.space==e.RGB&&a==e.HSV?h.RGBtoHSV(t):void 0},h.RGBtoHSV=function(a){let r=a.red*t.BYTE,n=a.green*t.BYTE,i=a.blue*t.BYTE,s,o,l,c=Math.max(r,Math.max(n,i)),u=c-Math.min(r,Math.min(n,i));if(0==u)s=0;else switch(c){case r:s=(60*(n-i)/u+360)%360;break;case n:s=(60*(i-r)/u+120)%360;break;case i:s=(60*(r-n)/u+240)%360}return o=0==c?0:u/c*100,l=100*c,new h([s,o,l,a.alpha],e.HSV)},h.HSVtoRGB=function(a){a.hue,t.CIRCLE,a.saturation,a.value;let r,n,i;return new h([r,n,i,a.alpha],e.RGB)},{Dark:Dark,DVector:a,DFont:r,DImage:n,DMatrix:i,DRandom:s,DTimer:o,DIdentification:l,DGradient:c,DColor:h}})(),Dark.focus={},document.addEventListener("click",e=>{Dark.focus.target=e.target,Dark.focus.time=performance.now()}),Dark.startTime=performance.now(),Dark.utils=new Dark(!0),Dark.default=new Dark,Dark.setMain(Dark.default),Dark.defineConstants(),Dark.globallyUpdateVariables(Dark.externals.main),Dark.compileKA(),Object.freeze(Dark);
