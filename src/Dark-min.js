/*

  All code by @99TheDark unless noted. (See CREDITS.md)
  
  Minified with Toptal.

*/

"use strict";if(window.Dark)throw"There is more than one Dark.js import";var Dark=function(e=!1){if(!(this instanceof Dark))throw"Dark can only be called with the new operator";this.darkObject=!0;let t=performance.now(),n=performance.now(),a=-1,r=null,i=!1,o=this,s=o.constants=Dark.constants,l=o.objects=Dark.objects,c=o.settings={};Dark.instances.push(o);let u={};for(let h in o.keys=new Proxy(u,{get:(e,t)=>e[t]??!1,set(){}}),o.info={id:Math.floor(1e6*Math.random()),initializationTime:performance.now(),version:Dark.version},o.transforms=[],o.saves=[],o.styles=[],o.vertices=[],o.vertexCache=[],o.imageCache={},o.cachedImageCount=0,o.successfullyCachedImageCount=0,o.loaded=!1,o.began=!1,o.copy=Dark.copy,o.format=Dark.format,o.randomGenerator=l.DRandom.create(),o.dummy=e,Dark.variables)o[h]=Dark.variables[h];o.isMain=!1,o.canvas=new OffscreenCanvas(innerWidth,innerHeight),o.ctx=o.canvas.getContext("2d"),Dark.empties.forEach(e=>o[e]=()=>{});var m=function(e){return o.snap(c.angleMode==s.DEGREES?e*s.PI/180:e,0,s.TAU)},g=function(e){o.vertices.push(e),e.points.forEach(e=>o.vertexCache.push(l.DVector.create(e.x,e.y)))},f=function(e){let t=e=o.floor(e);for(;--e>1;)t*=e;return t},d=function(){o.frameRate(60),o.smooth(),o.ellipseMode(s.CENTER),o.rectMode(s.CORNER),o.imageMode(s.CORNER),o.resizeMode(s.WIDTH),o.angleMode(s.DEGREES),o.strokeCap(s.ROUND),o.strokeJoin(s.MITER),o.textAlign(s.LEFT,s.BASELINE),o.curveTightness(2),o.fill(255),o.stroke(0),o.strokeWeight(1),o.textFont("12px Arial"),o.textLeading(5),o.preventDefault(s.KEY),o.allowDefault(s.CLICK),o.preventDefault(s.SCROLL)},p=function(e){for(let t in o.ctx){let n=e[t];"canvas"!=t&&"function"!=typeof n&&(o.ctx[t]=n)}},$=function(){o.canvas.addEventListener("click",function(e){c.clickEvents&&e.preventDefault(),Dark.globallyUpdateVariables(o),o.mouseClicked()}),o.canvas.addEventListener("mousedown",function(e){c.clickEvents&&e.preventDefault(),o.mouseIsPressed=!0,o.mouseButton=Dark.mouseMap[e.button],Dark.globallyUpdateVariables(o),o.mousePressed()}),o.canvas.addEventListener("mouseup",function(e){c.clickEvents&&e.preventDefault(),o.mouseButton=void 0,o.mouseIsPressed=!1,Dark.globallyUpdateVariables(o),o.mouseReleased()}),o.canvas.addEventListener("mouseenter",function(e){o.mouseIsInside=!0,Dark.globallyUpdateVariables(o),o.mouseIn()}),o.canvas.addEventListener("mouseleave",function(e){o.mouseIsInside=!1,Dark.globallyUpdateVariables(o),o.mouseOut()}),o.canvas.addEventListener("mousemove",function(e){let t=e.target.getBoundingClientRect();o.pmouseX=o.pmouse.x=o.mouseX,o.pmouseY=o.pmouse.y=o.mouseY,o.mouseX=o.mouse.x=o.constrain(o.round(e.pageX-t.x),0,o.width),o.mouseY=o.mouse.y=o.constrain(o.round(e.pageY-t.y),0,o.height),Dark.globallyUpdateVariables(o),o.mouseMoved()}),o.canvas.addEventListener("wheel",function(e){c.scrollEvents&&e.preventDefault(),r=performance.now(),o.mouseScroll=l.DVector.create(e.deltaX,e.deltaY,e.deltaZ),Dark.globallyUpdateVariables(o),o.mouseScrolled()}),o.canvas.addEventListener("dblclick",function(e){c.clickEvents&&e.preventDefault(),Dark.globallyUpdateVariables(o),o.mouseDoubleClicked()})},k=function(e){return"rgba("+o.red(e)+", "+o.green(e)+", "+o.blue(e)+", "+o.alpha(e)/255+")"};!function(e){for(let t in e)o[t]=e[t]}({size:function(e=innerWidth,t=innerHeight){"number"==typeof e&&"number"==typeof t&&e>0&&t>0&&([o.width,o.height]=[o.canvas.width,o.canvas.height]=[e,t],Dark.globallyUpdateVariables(o))},setCanvas:function(e){if(e instanceof HTMLCanvasElement){o.canvas=e,o.width=e.width,o.height=e.height;let t=o.copy(o.ctx);o.ctx=e.getContext("2d"),p(t),o.canvas.style.cursor=c.cursor,o.canvas.tabIndex="1",$()}},getCanvas:function(){return o.canvas},getContext:function(){return o.ctx},setTitle:function(e){document.title=e},dist:function(...e){let t,n;return e.length=6,t=e[2]-e[0],n=e[3]-e[1],o.sqrt(t*t+n*n+0)},gamma:function(e){return o.sqrt(s.TAU/e)*((e+1/(12*e+1/(10*e)))/E)**e},factorial:function(e){return Number.isInteger(e)?f(e):gamma(e+1)},choose:function(e,t){return f(e)/(f(e-t)*f(t))},random:function(...e){switch(e.length){default:return o.randomGenerator.next()*(e[1]-e[0])+e[0];case 0:return o.randomGenerator.next();case 1:return o.randomGenerator.next()*e[0]}},randomSeed:function(e){e!=o.randomGenerator.seed&&(o.randomGenerator=l.DRandom.create(e))},cursor:function(e="default"){c.cursor=e,o.canvas.style.cursor=e},noCursor:function(){c.cursor="none",o.canvas.style.cursor="none"},loop:function(){c.looping=!0},noLoop:function(){c.looping=!1},frameRate:function(e){c.frameStep=1e3/e},enableContextMenu:function(){c.contextMenu=!0,o.canvas.oncontextmenu=!0},disableContextMenu:function(){c.contextMenu=!1,o.canvas.oncontextmenu=!1},fullscreen:function(){o.canvas.requestFullscreen()},color:function(e,t,n,a){let r=arguments.length;if(0==r)return -1;if(1==r||2==r){if(!(e<=255)||!(e>=0))return 2==r?e&s.ALPHA_MASK|t<<24:e;1==r?n=t=e:(a=t,t=e,n=e)}return a??=255,e=o.constrain(e,0,255),t=o.constrain(t,0,255),n=o.constrain(n,0,255),((a=o.constrain(a,0,255))<<24)+(e<<16)+(t<<8)+n},randomColor:function(){return color(255*o.randomGenerator.next(),255*o.randomGenerator.next(),255*o.randomGenerator.next())},red:e=>e>>16&255,green:e=>e>>8&255,blue:e=>255&e,alpha:e=>e>>24&255,lerpColor:function(e,t,n){return color(o.lerp(o.red(e),o.red(t),n),o.lerp(o.green(e),o.green(t),n),o.lerp(o.blue(e),o.blue(t),n),o.lerp(o.alpha(e),o.alpha(t),n))},fill:function(...e){let t=c.fill=o.color.apply(null,e);o.ctx.fillStyle=k(t)},noFill:function(){c.fill=0,o.ctx.fillStyle="rgba(0, 0, 0, 0)"},stroke:function(...e){let t=c.stroke=o.color.apply(null,e);o.ctx.strokeStyle=k(t)},noStroke:function(){c.stroke=0,o.ctx.strokeStyle="rgba(0, 0, 0, 0)"},background:function(...e){o.ctx.save(),o.ctx.resetTransform();let t=o.color.apply(null,e);o.ctx.fillStyle=k(t),o.ctx.clearRect(0,0,o.width,o.height),o.ctx.fillRect(0,0,o.width,o.height),o.ctx.restore()},clear:function(){o.ctx.save(),o.ctx.resetTransform(),o.ctx.clearRect(0,0,o.width,o.height),o.ctx.restore()},strokeCap:function(e){switch(e){default:Dark.error("Invalid strokeCap type");break;case s.FLAT:o.ctx.lineCap="butt",c.strokeCap=s.FLAT;break;case s.ROUND:o.ctx.lineCap="round",c.strokeCap=s.ROUND;break;case s.SQUARE:o.ctx.lineCap="square",c.strokeCap=s.SQUARE}},strokeJoin:function(e=s.MITER){switch(e){default:Dark.error("Invalid strokeJoin type");break;case s.MITER:o.ctx.lineJoin="miter",c.strokeJoin=s.MITER;break;case s.BEVEL:o.ctx.lineJoin="bevel",c.strokeJoin=s.BEVEL;break;case s.ROUND:o.ctx.lineJoin="round",c.strokeJoin=s.ROUND}},strokeWeight:function(e){c.smoothing||(e=o.round(e)),c.strokeWeight=e,o.ctx.lineWidth=e},smooth:function(){c.smoothing=!0,o.ctx.mozImageSmoothingEnabled=!0,o.ctx.webkitImageSmoothingEnabled=!0,o.ctx.msImageSmoothingEnabled=!0,o.ctx.imageSmoothingEnabled=!0,o.ctx.imageSmoothingQuality="high"},noSmooth:function(){c.smoothing=!0,o.ctx.mozImageSmoothingEnabled=!1,o.ctx.webkitImageSmoothingEnabled=!1,o.ctx.msImageSmoothingEnabled=!1,o.ctx.imageSmoothingEnabled=!1,o.ctx.imageSmoothingQuality="low"},preventDefault:function(e){switch(0==arguments.length&&Dark.error("No listener type given"),e){default:Dark.error("Invalid listener given");break;case s.KEY:c.keyEvents=!0;break;case s.CLICK:c.clickEvents=!0;break;case s.SCROLL:c.scrollEvents=!0}},allowDefault:function(e){switch(0==arguments.length&&Dark.error("No listener type given"),e){default:Dark.error("Invalid listener given");break;case s.KEY:c.keyEvents=!1;break;case s.CLICK:c.clickEvents=!1;break;case s.SCROLL:c.scrollEvents=!1}},angleMode:function(e){switch(e){default:Dark.error("Invalid angleMode");break;case s.DEGREES:c.angleMode=s.DEGREES;break;case s.RADIANS:c.angleMode=s.RADIANS}},ellipseMode:function(e=s.CENTER){switch(e){default:Dark.error("Invalid ellipseMode");break;case s.CENTER:c.ellipseMode=s.CENTER;break;case s.CORNER:c.ellipseMode=s.CORNER;break;case s.RADIUS:c.ellipseMode=s.RADIUS}},rectMode:function(e=s.CORNER){switch(e){default:Dark.error("Invalid rectMode");break;case s.CORNER:c.rectMode=s.CORNER;break;case s.CENTER:c.rectMode=s.CENTER}},imageMode:function(e=s.CORNER){switch(e){default:Dark.error("Invalid imageMode");break;case s.CORNER:c.imageMode=s.CORNER;break;case s.CENTER:c.imageMode=s.CENTER}},resizeMode:function(e=s.WIDTH){switch(e){default:Dark.error("Invalid resizeMode");break;case s.WIDTH:c.resizeMode=s.WIDTH;break;case s.HEIGHT:c.resizeMode=s.HEIGHT}},curveTightness:function(e=0){c.curveTightness=e,c.curveMatrixTightness=(e-1)/6},pushMatrix:function(){o.transforms.length>o.maxStackSize?Dark.error("Maximum matrix stack size reached, pushMatrix() called "+o.maxStackSize+" times."):o.transforms.push(o.ctx.getTransform())},popMatrix:function(){let e=o.transforms.pop();e?o.ctx.setTransform(e):Dark.error("No more transforms to restore in popMatrix()")},resetMatrix:function(){o.transforms.length=0,o.ctx.resetTransform()},getMatrixAsDOM:function(){return o.transforms[o.transforms.length-1]},getMatrix:function(){return l.DMatrix.fromDOMMatrix(o.transforms[o.transforms.length-1])},pushStyle:function(){o.styles.length>o.maxStackSize?Dark.error("Maximum style stack size reached, pushStyle() called "+o.maxStackSize+" times."):o.styles.push(o.copy(o.ctx))},popStyle:function(){let e=o.styles.pop();e?p(e):Dark.error("No more styles to restore in popStyle()")},resetStyle:function(){o.styles.length=0,d()},push:function(){o.transforms.length>o.maxStackSize?Dark.error("Maximum stack size reached, push() called "+o.maxStackSize+" times."):(o.ctx.save(),o.saves.push(Object.assign({},c)))},pop:function(){let e=o.saves.pop();e?(o.ctx.restore(),Object.assign(c,e)):Dark.error("No more saves to restore in pop()")},reset:function(){o.saves.length=0,c=Object.assign({},o.defaultSettings),o.ctx.reset()},translate:function(e,t){o.ctx.translate(e,t)},rotate:function(e){o.ctx.rotate(m(e))},scale:function(e,t){arguments.length<2?o.ctx.scale(e,e):o.ctx.scale(e,t)},skew:function(e,t=0){let n=o.ctx.getTransform();n.b=.01*t,n.c=.01*e,o.ctx.setTransform(n)},rect:function(e,t,n,a,r,i,l,u){switch(c.smoothing||([e,t,n,a]=[o.round(e),o.round(t),o.round(n),o.round(a)]),[n,a]=[o.abs(n),o.abs(a)],o.ctx.beginPath(),o.ctx.save(),c.rectMode==s.CENTER&&o.ctx.translate(-n/2,-a/2),arguments.length){default:Dark.error("rect takes in 4, 5 or 8 parameters, not "+arguments.length);break;case 4:o.ctx.rect(e,t,n,a);break;case 5:o.ctx.roundRect(e,t,n,a,r);break;case 8:o.ctx.roundRect(e,t,n,a,[r,i,l,u])}o.ctx.fill(),o.ctx.stroke(),o.ctx.restore()},ellipse:function(e,t,n,a){c.ellipseMode==s.RADIUS&&(n/=2,a/=2),c.smoothing||([e,t,n,a]=[o.round(e),o.round(t),o.round(n),o.round(a)]),[n,a]=[o.abs(n),o.abs(a)],o.ctx.beginPath(),o.ctx.save(),c.ellipseMode==s.CORNER&&o.ctx.translate(n/2,a/2),o.ctx.beginPath(),o.ctx.ellipse(e,t,n/2,a/2,0,0,s.TAU,!1),o.ctx.fill(),o.ctx.stroke(),o.ctx.restore()},arc:function(e,t,n,a,r,i){c.ellipseMode==s.RADIUS&&(n/=2,a/=2),c.smoothing||([e,t,n,a]=[o.round(e),o.round(t),o.round(n),o.round(a)]),o.ctx.save(),c.ellipseMode==s.CORNER&&o.ctx.translate(n/2,a/2),o.ctx.beginPath(),o.ctx.moveTo(e,t),o.ctx.ellipse(e,t,n/2,a/2,0,m(r),m(i),!1),o.ctx.fill(),o.ctx.beginPath(),o.ctx.ellipse(e,t,n/2,a/2,0,m(r),m(i),!1),o.ctx.stroke(),o.ctx.restore()},line:function(e,t,n,a){c.smoothing||([e,t,n,a]=[o.round(e),o.round(t),o.round(n),o.round(a)]),o.ctx.beginPath(),o.ctx.moveTo(e,t),o.ctx.lineTo(n,a),o.ctx.stroke()},point:function(e,t){c.smoothing||(e=o.round(e),t=o.round(t)),o.ctx.save(),o.ctx.beginPath(),o.ctx.fillStyle=k(c.stroke),o.ctx.arc(e,t,c.strokeWeight/2,0,s.TAU),o.ctx.fill(),o.ctx.restore()},circle:function(e,t,n){c.smoothing||([e,t,n]=[o.round(e),o.round(t),o.round(n)]),n=o.round(n),o.ctx.save(),c.ellipseMode==s.CORNER&&o.ctx.translate(n,n),o.ctx.beginPath(),o.ctx.arc(e,t,n,0,s.TAU),o.ctx.fill(),o.ctx.stroke(),o.ctx.restore()},square:function(...e){e.splice(3,0,e[2]),rect.apply(null,e)},triangle:function(e,t,n,a,r,i){c.smoothing||([e,t,n,a,r,i]=[o.round(e),o.round(t),o.round(n),o.round(a),o.round(r),o.round(i)]),o.ctx.beginPath(),o.ctx.moveTo(e,t),o.ctx.lineTo(n,a),o.ctx.lineTo(r,i),o.ctx.closePath(),o.ctx.fill(),o.ctx.stroke()},quad:function(e,t,n,a,r,i,s,l){c.smoothing||([e,t,n,a,r,i,s,l]=[o.round(e),o.round(t),o.round(n),o.round(a),o.round(r),o.round(i),o.round(s),o.round(l)]),o.ctx.beginPath(),o.ctx.moveTo(e,t),o.ctx.lineTo(n,a),o.ctx.lineTo(r,i),o.ctx.lineTo(s,l),o.ctx.closePath(),o.ctx.fill(),o.ctx.stroke()},beginShape:function(){i?Dark.error("Cannot begin a new shape before the previous shape has ended"):(o.vertices.length=0,o.vertexCache.length=0,i=!0)},endShape:function(e=s.OPEN){o.vertices.length<2||o.vertices[0].type==s.BEZIER||(o.ctx.beginPath(),o.vertices.forEach(function(e,t){if(0==t)o.ctx.moveTo(e.points[0].x,e.points[0].y);else switch(e.type){case s.VERTEX:let n=e.points[0];o.ctx.lineTo(n.x,n.y);break;case s.CURVE:let a=c.curveMatrixTightness,r=o.vertexCache[t-3],i=o.vertexCache[t-2],l=o.vertexCache[t-1],u=o.vertexCache[t];if(2==t)break;0==t?o.ctx.moveTo(u.x,u.y):t<3?o.ctx.lineTo(u.x,u.y):(3==t&&o.ctx.lineTo(i.x,i.y),o.ctx.bezierCurveTo(l.x*a+i.x-r.x*a,l.y*a+i.y-r.y*a,-(u.x*a)+l.x+i.x*a,-(u.y*a)+l.y+i.y*a,l.x,l.y));break;case s.BEZIER:let h=e.points;o.ctx.bezierCurveTo(h[0].x,h[0].y,h[1].x,h[1].y,h[2].x,h[2].y)}}),e==s.CLOSE&&o.ctx.closePath(),o.ctx.fill(),o.ctx.stroke(),i=!1)},vertex:function(e,t){c.smoothing||([e,t]=[o.round(e),o.round(t)]);g({type:s.VERTEX,points:[{x:e,y:t}]})},curveVertex:function(e,t){c.smoothing||([x,y]=[o.round(e),o.round(t)]);g({type:s.CURVE,points:[{x:e,y:t}]})},bezierVertex:function(e,t,n,a,r,i){c.smoothing||([e,t,n,a,r,i]=[o.round(e),o.round(t),o.round(n),o.round(a),o.round(r),o.round(i)]);g({type:s.BEZIER,points:[{x:e,y:t},{x:n,y:a},{x:r,y:i}]})},bezier:function(e,t,n,a,r,i,o,s){beginShape(),vertex(e,t),bezierVertex(n,a,r,i,o,s),endShape()},curve:function(e,t,n,a,r,i,o,s){beginShape(),vertex(e,t),vertex(n,a),vertex(r,i),curveVertex(o,s),endShape()},bezierPoint:function(e,t,n,a,r){let i=1-r;return i*i*i*e+3*i*i*r*t+3*i*r*r*n+r*r*r*a},curvePoint:function(e,t,n,a,r){return .5*(2*t+(n-e)*r+(2*e-5*t+4*n-a)*r*r+(3*t-3*n+a-e)*r*r*r)},curveTangent:function(e,t,n,a,r){return .5*(n-e+2*(2*e-5*t+4*n-a)*r+3*(3*t-3*n+a-e)*r*r)},bezierTangent:function(e,t,n,a,r){let i=1-r;return 3*i*i*(t-e)+6*i*r*(n-t)+3*r*r*(a-n)},reloadFont:function(){o.ctx.font=c.font.toString(),c.genericTextMeasure=o.ctx.measureText("0"),c.textHeight=c.genericTextMeasure.fontBoundingBoxAscent+c.genericTextMeasure.fontBoundingBoxDescent},textSize:function(e){c.smoothing||(e=o.round(e)),c.textSize=e,c.font.size=e,o.reloadFont()},textAlign:function(e,t){switch(0==arguments.length&&(e=s.LEFT,t=s.BASELINE),1==arguments.length&&e==s.CENTER&&(t=s.CENTER),e){default:Dark.error("Invalid x alignment type");break;case s.LEFT:o.ctx.textAlign="left",c.alignX=s.LEFT;break;case s.RIGHT:o.ctx.textAlign="right",c.alignX=s.RIGHT;break;case s.CENTER:o.ctx.textAlign="center",c.alignX=s.CENTER}switch(t){default:Dark.error("Invalid y alignment type");break;case s.BASELINE:o.ctx.textBaseline="alphabetic",c.alignY=s.BASELINE;break;case s.TOP:o.ctx.textBaseline="top",c.alignY=s.TOP;break;case s.BOTTOM:o.ctx.textBaseline="bottom",c.alignY=s.BOTTOM;break;case s.CENTER:o.ctx.textBaseline="middle",c.alignY=s.CENTER}},textFont:function(e){"string"==typeof e&&(e=new l.DFont(e)),e instanceof l.DFont?(c.font=e,c.textSize=e.size,o.reloadFont()):Dark.error(e+" is not a DFont.")},createFont:function(e){return DFont.parse(e)},textStyle:function(e){switch(e){default:c.font.weight="normal",c.font.style="normal";break;case s.BOLD:c.font.weight="bold";break;case s.ITALIC:c.font.style="italic"}o.reloadFont()},textWidth:function(e){return o.ctx.measureText(e).width},textAscent:function(){return c.genericTextMeasure.fontBoundingBoxAscent},textDescent:function(){return c.genericTextMeasure.fontBoundingBoxDescent},textLeading:function(e){c.lineGap=e},text:function(e,t,n){c.smoothing||([t,n]=[o.round(t),o.round(n)]);let a=e.split("\n"),r=0;switch(c.alignY){case s.CENTER:r=(c.textHeight+c.lineGap)/2*(a.length-1);break;case s.BOTTOM:r=(c.textHeight+c.lineGap)*(a.length-1)}a.forEach((e,a)=>{let i=a*(c.textHeight+c.lineGap)-r;o.ctx.fillText(e,t,n+i),o.ctx.strokeText(e,t,n+i)})},get:function(...e){return 0==e.length?new l.DImage(o.ctx.getImageData(0,0,o.width,o.height),o):4==e.length?new l.DImage(o.ctx.getImageData(e[0],e[1],e[2],e[3]),o):void Dark.error("get requires 0 or 4 parameters, not "+e.length)},set:function(e,t,n){o.ctx.save(),o.ctx.fillStyle=k(n),o.ctx.fillRect(e,t,1,1),o.ctx.restore()},image:function(e,t,n,a,r){[a,r]=[o.abs(a),o.abs(r)],o.ctx.save(),e instanceof ImageData&&(e=new l.DImage(e,o));let i,u;switch(arguments.length){default:return o.ctx.restore(),Dark.error("image requires 1, 3, 4 or 5 parameters, not "+arguments.length);case 1:[t,n,i,u]=[0,0,o.width,o.height];break;case 3:[i,u]=[e.width,e.height];break;case 4:c.resizeMode==s.HEIGHT?[i,u]=[a/e.height*e.width,a]:[i,u]=[a,a/e.width*e.height];break;case 5:[i,u]=[a,r]}c.imageMode==s.CENTER&&o.ctx.translate(-i/2,-u/2),c.smoothing||([t,n,a,r]=[o.round(t),o.round(n),o.round(a),o.round(r)]),o.ctx.drawImage(e.getRenderable(),t,n,i,u),o.ctx.restore()},loadImage:function(e){let t=new l.DImage(1,1,o);return Object.keys(o.imageCache).includes(e)&&o.began?o.imageCache[e]:(o.imageCache[e]=null,Dark.khan?(o.cachedImageCount++,t.image=new Image,t.image.src=e,t.image.crossOrigin="anonymous",t.image.onload=()=>{o.imageCache[e]=t,o.successfullyCachedImageCount++,[t.canvas.width,t.canvas.height]=[t.width,t.height]=[t.image.width,t.image.height],t.imageData=new ImageData(t.width,t.height),t.ctx.drawImage(t.image,0,0,t.width,t.height),t.updatePixels(),o.successfullyCachedImageCount==Object.keys(o.imageCache).length&&o.begin()}):(o.cachedImageCount++,fetch(e).then(e=>e.blob()).then(n=>{t.image=new Image,t.image.src=URL.createObjectURL(n),t.image.onload=()=>{createImageBitmap(n).then(n=>{let a=new l.DImage(n.width,n.height,o);a.ctx.drawImage(n,0,0,a.width,a.height),a.updatePixels(),o.imageCache[e]=a,o.successfullyCachedImageCount++,[t.canvas.width,t.canvas.height]=[t.width,t.height]=[a.width,a.height],t.imageData=a.imageData,t.loadPixels(),o.successfullyCachedImageCount==Object.keys(o.imageCache).length&&o.begin()})}}).catch(e=>Dark.error(e))),t)},getImage:function(e){if(!Dark.khan)return o.loadImage("/"+e);{let t="https://cdn.kastatic.org/third_party/javascript-khansrc/live-editor/build/images/"+e+".png";if(Object.keys(o.imageCache).includes(t)&&o.began)return o.imageCache[t];let n=new l.DImage(1,1,o);return o.imageCache[t]=null,o.cachedImageCount++,n.image=new Image,n.image.src=t,n.image.crossOrigin="anonymous",n.image.onload=()=>{o.imageCache[t]=n,o.successfullyCachedImageCount++,[n.canvas.width,n.canvas.height]=[n.width,n.height]=[n.image.width,n.image.height],n.imageData=new ImageData(n.width,n.height),n.ctx.drawImage(n.image,0,0,n.width,n.height),n.updatePixels(),o.successfullyCachedImageCount==Object.keys(o.imageCache).length&&o.begin()},n}},filter:function(e,t){let n=new l.DImage(o.canvas,o);n.setDisposability(!0),n.filter(e,t),o.ctx.putImageData(n.imageData,0,0)},min:(e,t)=>e<t?e:t,max:(e,t)=>e>t?e:t,log10:e=>Math.log10(e),log2:e=>Math.log2(e),log:e=>Math.log(e),logBase:(e,t)=>Math.log(e)/Math.log(t),mag:(e,t)=>Math.sqrt(e*e+t*t),norm:(e,t,n)=>(e-t)/(n-t),constrain:(e,t,n)=>Math.min(Math.max(e,t),n),between:(e,t,n)=>e<=n&&e>=t,exceeds:(e,t,n)=>e>n||e<t,lerp:(e,t,n)=>(t-e)*n+e,map:(e,t,n,a,r)=>a+(r-a)/(n-t)*(e-t),sq:e=>e*e,cb:e=>e*e*e,pow:(e,t)=>e**t,root:(e,t)=>e**(1/t),sqrt:e=>Math.sqrt(e),cbrt:e=>Math.cbrt(e),exp:e=>E**e,floor:e=>Math.floor(e),round:e=>Math.round(e),ceil:e=>Math.ceil(e),trunc:e=>Math.trunc(e),deci:e=>e-Math.trunc(e),abs:e=>e<0?-e:e,sign:e=>Math.sign(e),bsign:e=>e<0?-1:1,degrees:e=>180*e/s.PI,radians:e=>e*s.PI/180,millennium:()=>Math.floor(new Date().getFullYear()/1e3),century:()=>Math.floor(new Date().getFullYear()/100),decade:()=>Math.floor(new Date().getFullYear()/10),year:()=>new Date().getFullYear(),month:()=>new Date().getMonth(),day:()=>new Date().getDate(),hour:()=>new Date().getHours(),minute:()=>new Date().getMinutes(),second:()=>new Date().getSeconds(),millis:()=>Math.floor(performance.now()),micro:()=>Math.floor(1e3*performance.now()%1e3),nano:()=>Math.floor(1e6*performance.now()%1e3),today:()=>DAYS[new Date().getDay()],timezone:()=>-new Date().getTimezoneOffset()/60,sin:e=>Math.sin(m(e)),cos:e=>Math.cos(m(e)),tan:e=>Math.tan(m(e)),csc:e=>1/Math.sin(m(e)),sec:e=>1/Math.cos(m(e)),cot:e=>1/Math.tan(m(e)),atan2(e,t){var n;return n=Math.atan2(e,t),o.snap(c.angleMode==s.DEGREES?180*n/s.PI:n,0,360)},asin:e=>Math.asin(m(e)),acos:e=>Math.acos(m(e)),atan:e=>Math.atan(m(e)),acsc:e=>Math.asin(1/m(e)),asec:e=>Math.acos(1/m(e)),acot:e=>Math.atan(1/m(e)),sinh:e=>Math.sinh(m(e)),cosh:e=>Math.cosh(m(e)),tanh:e=>Math.tanh(m(e)),csch:e=>1/Math.sinh(m(e)),sech:e=>1/Math.cosh(m(e)),coth:e=>1/Math.tanh(m(e)),asinh:e=>Math.asinh(m(e)),acosh:e=>Math.acosh(m(e)),atanh:e=>Math.atanh(m(e)),acsch:e=>Math.asinh(1/m(e)),asech:e=>Math.acosh(1/m(e)),acoth:e=>Math.atanh(1/m(e)),now:()=>performance.now(),reciprocal:e=>1/e,trim:e=>e.trim(),mod:(e,t)=>(e%t+t)%t,snap:(e,t,n)=>(e-t)%(n-t)+t,percent:e=>e/100,translateX:e=>o.translate(e,0),translateY:e=>o.translate(0,e),scaleX:e=>o.scale(e,1),scaleY:e=>o.scale(1,e),skewX:e=>o.skew(e,0),skewY:e=>o.skew(0,e)}),o.raf=function(e){if(Dark.startTime>o.info.initializationTime){Dark.warn("Deleting old Dark.js instance."),Dark.instances.splice(Dark.instances.indexOf(o),1);return}let i=(e=performance.now())-t,s=e-n;n=performance.now(),null!=r&&n-r>16&&(r=null,o.mouseScroll.zero3D());let l=i>c.frameStep-s/2&&c.looping;a<e&&a>n&&(i=s=e-a),l&&(t=e,o.draw(),o.dt=i/1e3,o.fps=1e3/i,o.frameCount=++o.frameCount),Dark.globallyUpdateVariables(o),requestAnimationFrame(o.raf)},o.begin=function(){o.loaded&&!o.began&&(o.began=!0,o.setup(),requestAnimationFrame(o.raf))},d(),o.defaultSettings=Object.assign({},c),o.dummy||(document.addEventListener("keydown",function(e){Dark.focus.target===o.canvas&&(c.keyEvents&&e.preventDefault(),o.keyIsPressed=!0,o.key=Dark.special[e.keyCode]??e.key,o.keyCode=e.keyCode,/\w/.test(String.fromCharCode(e.keyCode))&&o.keyTyped(),u[o.key]=!0,Dark.globallyUpdateVariables(o),o.keyPressed())}),document.addEventListener("keyup",function(e){Dark.focus.target===o.canvas&&(c.keyEvents&&e.preventDefault(),o.key=Dark.special[e.keyCode]??e.key,o.keyCode=e.keyCode,u[o.key]=!1,o.keyIsPressed=!1,Dark.globallyUpdateVariables(o),o.keyReleased(),o.key=void 0,o.keyCode=void 0,Dark.globallyUpdateVariables(o))}),addEventListener("resize",function(e){Dark.globallyUpdateVariables(o),o.pageResized()}),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState&&(o.keyIsPressed=!1,o.key=void 0,o.keyCode=void 0,o.mouseIsPressed=!1,o.mouseButton=void 0,o.mouseIsInside=!1,a=performance.now())}),o.mouse=l.DVector.zero2D(),o.pmouse=l.DVector.zero2D(),o.mouseScroll=l.DVector.zero3D(),c.cursor="auto",c.looping=!0,Dark.khan&&Dark.imageLocationsKA.forEach(e=>o.getImage(e)),addEventListener("load",()=>{o.loaded=!0,Dark.globallyUpdateVariables(o),o.preload(),o.began||o.successfullyCachedImageCount!=o.cachedImageCount||o.begin()}))};Dark.instances=[],Dark.version="pre-0.7.3",Dark.empties=["draw","setup","preload","keyPressed","keyReleased","keyTyped","mouseClicked","mousePressed","mouseReleased","mouseMoved","mouseScrolled","mouseIn","mouseOut","mouseDoubleClicked","pageResized"],Dark.constants={DAYS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],PI:Math.PI,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4,E:Math.E,PHI:Math.PHI,TAU:2*Math.PI,EPSILON:Number.EPSILON,RED_MASK:4278255615,GREEN_MASK:4294902015,BLUE_MASK:4294967040,ALPHA_MASK:16777215,ROUND:0,FLAT:1,DEGREES:2,RADIANS:3,VERTEX:4,CURVE:5,BEZIER:6,CLOSE:7,OPEN:8,CENTER:9,CORNER:10,WIDTH:11,HEIGHT:12,AUTO:13,BOLD:14,ITALIC:15,NORMAL:16,BEVEL:17,MITER:18,SQUARE:19,LEFT:20,RIGHT:21,TOP:22,BOTTOM:23,BASELINE:24,GET:25,SET:26,RADIUS:27,KEY:28,CLICK:29,SCROLL:30,PERLIN:31,SIMPLEX:32,WORLEY:33,VALUE:34,RANDOM:35,INVERT:36,OPAQUE:37,GRAY:38,ERODE:39,DILATE:40,THRESHOLD:41,POSTERIZE:42,BLUR:43,SHARPEN:44,SEPIA:45,OUTLINE:46,SWIRL:47,EDGE:48,CONTRAST:49,VIGNETTE:50,BRIGHTNESS:51,BLACK:52,WHITE:53,NORMALIZE:54,BOX:55,TRANSPARENCY:56,PIXELATE:57,FISHEYE:58,EMBOSS:59,SOBEL:60},Dark.filters=[Dark.constants.INVERT,Dark.constants.OPAQUE,Dark.constants.GRAY,Dark.constants.ERODE,Dark.constants.DILATE,Dark.constants.THRESHOLD,Dark.constants.POSTERIZE,Dark.constants.BLUR,Dark.constants.SHARPEN,Dark.constants.SEPIA,Dark.constants.OUTLINE,Dark.constants.SWIRL,Dark.constants.EDGE,Dark.constants.CONTRAST,Dark.constants.VIGNETTE,Dark.constants.BRIGHTNESS,Dark.constants.BLACK,Dark.constants.WHITE,Dark.constants.NORMALIZE,Dark.constants.BOX,Dark.constants.TRANSPARENCY,Dark.constants.PIXELATE,Dark.constants.FISHEYE,Dark.constants.EMBOSS,Dark.constants.SOBEL],Dark.special={16:"shift",13:"enter",8:"delete",9:"tab",27:"escape",32:"space",18:"option",17:"control",91:"left_meta",93:"right_meta",38:"up",40:"down",37:"left",39:"right",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",20:"capslock",190:"period",188:"comma",191:"slash",192:"backtick",220:"backslash",48:"zero",49:"one",50:"two",51:"three",52:"four",53:"five",54:"six",55:"seven",56:"eight",57:"nine",189:"minus",187:"equals",219:"left_bracket",221:"right_bracket",222:"single_quote",186:"semicolon"},Dark.cursors=["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out"],Dark.imageLocationsKA=["avatars/aqualine-sapling","avatars/aqualine-seed","avatars/aqualine-seedling","avatars/aqualine-tree","avatars/aqualine-ultimate","avatars/avatar-team","avatars/duskpin-sapling","avatars/duskpin-seed","avatars/duskpin-seedling","avatars/duskpin-tree","avatars/duskpin-ultimate","avatars/leaf-blue","avatars/leaf-green","avatars/leaf-grey","avatars/leaf-orange","avatars/leaf-red","avatars/leaf-yellow","avatars/leafers-sapling","avatars/leafers-seed","avatars/leafers-seedling","avatars/leafers-tree","avatars/leafers-ultimate","avatars/marcimus","avatars/marcimus-orange","avatars/marcimus-purple","avatars/marcimus-red","avatars/mr-pants","avatars/mr-pants-green","avatars/mr-pants-orange","avatars/mr-pants-pink","avatars/mr-pants-purple","avatars/mr-pants-with-hat","avatars/mr-pink","avatars/mr-pink-green","avatars/mr-pink-orange","avatars/old-spice-man","avatars/old-spice-man-blue","avatars/orange-juice-squid","avatars/piceratops-sapling","avatars/piceratops-seed","avatars/piceratops-seedling","avatars/piceratops-tree","avatars/piceratops-ultimate","avatars/primosaur-sapling","avatars/primosaur-seed","avatars/primosaur-seedling","avatars/primosaur-tree","avatars/primosaur-ultimate","avatars/purple-pi","avatars/purple-pi-pink","avatars/purple-pi-teal","avatars/questionmark","avatars/robot_female_1","avatars/robot_female_2","avatars/robot_female_3","avatars/robot_male_1","avatars/robot_male_2","avatars/robot_male_3","avatars/spunky-sam","avatars/spunky-sam-green","avatars/spunky-sam-orange","avatars/spunky-sam-red","avatars/starky-sapling","avatars/starky-seed","avatars/starky-seedling","avatars/starky-tree","avatars/starky-ultimate","creatures/Hopper-Happy","creatures/Hopper-Cool","creatures/Hopper-Jumping","creatures/OhNoes","creatures/OhNoes-Hmm","creatures/OhNoes-Happy","creatures/BabyWinston","creatures/Winston","cute/Blank","cute/BrownBlock","cute/CharacterBoy","cute/CharacterCatGirl","cute/CharacterHornGirl","cute/CharacterPinkGirl","cute/CharacterPrincessGirl","cute/ChestClosed","cute/ChestLid","cute/ChestOpen","cute/DirtBlock","cute/DoorTallClosed","cute/DoorTallOpen","cute/EnemyBug","cute/GemBlue","cute/GemGreen","cute/GemOrange","cute/GrassBlock","cute/Heart","cute/Key","cute/PlainBlock","cute/RampEast","cute/RampNorth","cute/RampSouth","cute/RampWest","cute/Rock","cute/RoofEast","cute/RoofNorth","cute/RoofNorthEast","cute/RoofNorthWest","cute/RoofSouth","cute/RoofSouthEast","cute/RoofSouthWest","cute/RoofWest","cute/Selector","cute/ShadowEast","cute/ShadowNorth","cute/ShadowNorthEast","cute/ShadowNorthWest","cute/ShadowSideWest","cute/ShadowSouth","cute/ShadowSouthEast","cute/ShadowSouthWest","cute/ShadowWest","cute/Star","cute/StoneBlock","cute/StoneBlockTall","cute/TreeShort","cute/TreeTall","cute/TreeUgly","cute/WallBlock","cute/WallBlockTall","cute/WaterBlock","cute/WindowTall","cute/WoodBlock","space/background","space/beetleship","space/collisioncircle","space/girl1","space/girl2","space/girl3","space/girl4","space/girl5","space/healthheart","space/minus","space/octopus","space/planet","space/plus","space/rocketship","space/star","space/0","space/1","space/2","space/3","space/4","space/5","space/6","space/7","space/8","space/9","animals/birds_rainbow-lorakeets","animals/butterfly","animals/butterfly_monarch","animals/cat","animals/cheetah","animals/crocodiles","animals/dog_sleeping-puppy","animals/dogs_collies","animals/fox","animals/horse","animals/kangaroos","animals/komodo-dragon","animals/penguins","animals/rabbit","animals/retriever","animals/shark","animals/snake_green-tree-boa","animals/spider","landscapes/beach-at-dusk","landscapes/beach-in-hawaii","landscapes/beach-sunset","landscapes/beach-waves-at-sunset","landscapes/beach-waves-daytime","landscapes/beach-with-palm-trees","landscapes/beach","landscapes/clouds-from-plane","landscapes/crop-circle","landscapes/fields-of-grain","landscapes/fields-of-wine","landscapes/lake","landscapes/lava","landscapes/lotus-garden","landscapes/mountain_matterhorn","landscapes/mountains-and-lake","landscapes/mountains-in-hawaii","landscapes/mountains-sunset","landscapes/sand-dunes","landscapes/waterfall_niagara-falls","food/bananas","food/berries","food/broccoli","food/brussels-sprouts","food/cake","food/chocolates","food/coffee-beans","food/croissant","food/dumplings","food/fish_grilled-snapper","food/fruits","food/grapes","food/hamburger","food/ice-cream","food/mushroom","food/oysters","food/pasta","food/potato-chips","food/potatoes","food/shish-kebab","food/strawberries","food/sushi","food/tomatoes","seasonal/father-winston","seasonal/fireworks-2015","seasonal/fireworks-in-sky","seasonal/fireworks-over-harbor","seasonal/fireworks-scattered","seasonal/gingerbread-family","seasonal/gingerbread-house","seasonal/gingerbread-houses","seasonal/gingerbread-man","seasonal/hannukah-dreidel","seasonal/hannukah-menorah","seasonal/hopper-elfer","seasonal/hopper-partying","seasonal/hopper-reindeer","seasonal/house-with-lights","seasonal/reindeer","seasonal/snow-crystal1","seasonal/snow-crystal2","seasonal/snow-crystal3","seasonal/snownoes","seasonal/snowy-slope-with-trees"],Dark.ignoreGlobal=["darkObject","info","empties","raf","begin","vertices","transforms","styles","saves","vertexCache","imageCache","cachedImageCount","successfullyCachedImageCount","settings","defaultSettings","isMain","canvas","ctx","dummy","loaded","began","randomGenerator"],Dark.styleIgnore=["canvas","width","height"],Dark.variables={width:innerWidth,height:innerHeight,dt:0,frameCount:0,fps:60,key:void 0,keyCode:void 0,keyIsPressed:!1,mouseIsPressed:!1,mouseIsInside:!1,mouseX:0,mouseY:0,pmouseX:0,pmouseY:0,mouse:void 0,pmouse:void 0,mouseButton:void 0},Dark.mouseMap=["left","middle","right","back","forward"],Dark.changeable={},Dark.darkObject=!0,Dark.changeable.errorCount=0,Dark.maxErrorCount=50,Dark.maxStackSize=500,Dark.url=new URL(location.href),Dark.khan="www.kasandbox.org"==Dark.url.host,Dark.editor="127.0.0.1:4444"==Dark.url.host,Dark.copy=function(e){if("object"!=typeof e&&"function"!=typeof e)return Dark.warn('"'+e+'" is not an object!'),e;{let t={};for(let n in e)t[n]=e[n];return"function"==typeof e&&0==Object.keys(t).length?e:t}},Dark.format=function(e){return"object"==typeof Dark.copy(e)?JSON.stringify(Dark.copy(e),null,"    "):e+""},Dark.rectRect=function(e,t,n,a,r,i,o,s){return e+n>r&&e<r+o&&t+a>i&&t<i+s},Dark.doError=function(e,t){Dark.changeable.errorCount==Dark.maxErrorCount?console.warn("Too many warnings and errors have been made, the rest will not display."):Dark.changeable.errorCount<Dark.maxErrorCount&&console[e](t),Dark.changeable.errorCount++},Dark.warn=function(e){Dark.doError("warn",e)},Dark.error=function(e){Dark.doError("error",Error(e))},Dark.observe=function(e,t,n){3==arguments.length&&t!=Dark.constants.GET&&t!=Dark.constants.SET&&Dark.error("Invalid type, must be either GET or SET"),e=new Proxy(e,{get:function(e,a){return t==Dark.constants.GET&&n(a),e[a]},set:function(e,a,r){t==Dark.constants.SET&&n(a,r),e[a]=r}})},Dark.setMain=function(e){e instanceof Dark?(Dark.main&&(Dark.main.isMain=!1),Dark.main=e,e.isMain=!0):Dark.error(e+" is not an instance of Dark")},Dark.getMain=function(){return Dark.main},Dark.fileCacheKA={"/filters/global.vert":"# version 300 es\nprecision lowp float;\nin vec2 vertPos;\nin vec2 vertUV;\nout vec2 uv;\nout vec2 pos;\nvoid main() {\n pos = vertPos;\n uv = vertUV;\n gl_Position = vec4(vertPos, 0.0, 1.0);\n}","/filters/invert.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(1.0 - tex.rgb, tex.a);\n}","/filters/opaque.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb, 1.0);\n}","/filters/grayscale.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Based on how human eyes precieve\n color = vec4(vec3(luminance), tex.a);\n}","/filters/threshold.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance > param) {\n color = vec4(vec3(1.0), 1.0);\n } else {\n color = vec4(vec3(0.0), 1.0);\n }\n}","/filters/posterize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nfloat posterize(float val) {\n return floor(val * param + 0.5) / param;\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float red = posterize(tex.r);\n float green = posterize(tex.g);\n float blue = posterize(tex.b);\n \n color = vec4(red, green, blue, 1.0);\n}","/filters/black.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance <= param) {\n color = vec4(vec3(0.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/white.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance >= param) {\n color = vec4(vec3(1.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/vignette.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n vec2 pos = (uv * 2.0 - 1.0) * param;\n float dist = 1.0 - sqrt(pos.x * pos.x + pos.y * pos.y);\n color = vec4(tex.rgb * dist, tex.a);\n}","/filters/box.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n vec4 total = vec4(0.0);\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n total += texture(sampler, uv + vec2(x, y) / size);\n }\n }\n color = vec4(total / count);\n}","/filters/brightness.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb + param, tex.a);\n}","/filters/transparency.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb, tex.a - param);\n}","/filters/sepia.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(\n 0.393 * tex.r + 0.769 * tex.g + 0.189 * tex.b,\n 0.349 * tex.r + 0.686 * tex.g + 0.168 * tex.b,\n 0.272 * tex.r + 0.534 * tex.g + 0.131 * tex.b,\n tex.a\n );\n}","/filters/pixelate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec2 snap(vec2 point) {\n return floor(point * size / param) * param / size;\n}\nvoid main() {\n vec4 tex = texture(sampler, vec2(snap(uv)));\n \n color = tex;\n}","/filters/sharpen.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n 0.0, -1.0, 0.0,\n -1.0, 5.0, -1.0,\n 0.0, -1.0, 0.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/outline.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n -1.0, -1.0, -1.0,\n -1.0, 8.0, -1.0,\n -1.0, -1.0, -1.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/edge.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n 0.0, 1.0, 0.0,\n 1.0, -4.0, 1.0,\n 0.0, 1.0, 0.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/normalize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb / length(tex.rgb), tex.a);\n}","/filters/erode.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nfloat luminance(vec4 col) {\n return 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b; // from grayscale\n}\nvoid main() {\n vec4 middle = get(0.0, 0.0);\n vec4 top = get(0.0, 1.0);\n vec4 bottom = get(0.0, -1.0);\n vec4 right = get(1.0, 0.0);\n vec4 left = get(-1.0, 0.0);\n float lumMiddle = luminance(middle);\n float lumTop = luminance(top);\n float lumBottom = luminance(bottom);\n float lumRight = luminance(right);\n float lumLeft = luminance(left);\n if(lumBottom > lumMiddle) {\n color = bottom;\n } else if(lumTop > lumMiddle) {\n color = top;\n } else if(lumRight > lumMiddle) {\n color = right;\n } else if(lumLeft > lumMiddle) {\n color = left;\n } else {\n color = middle;\n }\n}","/filters/dilate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nfloat luminance(vec4 col) {\n return 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b; // from grayscale\n}\nvoid main() {\n vec4 middle = get(0.0, 0.0);\n vec4 top = get(0.0, 1.0);\n vec4 bottom = get(0.0, -1.0);\n vec4 right = get(1.0, 0.0);\n vec4 left = get(-1.0, 0.0);\n float lumMiddle = luminance(middle);\n float lumTop = luminance(top);\n float lumBottom = luminance(bottom);\n float lumRight = luminance(right);\n float lumLeft = luminance(left);\n if(lumBottom < lumMiddle) {\n color = bottom;\n } else if(lumTop < lumMiddle) {\n color = top;\n } else if(lumRight < lumMiddle) {\n color = right;\n } else if(lumLeft < lumMiddle) {\n color = left;\n } else {\n color = middle;\n }\n}","/filters/blur.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\n#define TAU (6.2831853071795864769252867665590057683943)\nvoid main() { \n vec4 total = vec4(0.0);\n float matrixTotal = 0.0;\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n vec4 tex = texture(sampler, uv + vec2(x, y) / size);\n float gaussian = exp(- (x * x + y * y) / (2.0 * param * param)) / (TAU * param * param);\n matrixTotal += gaussian;\n total += vec4(tex.rgb * gaussian, tex.a);\n }\n }\n color = total / matrixTotal;\n}","/filters/swirl.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define radius (0.5)\nvoid main() {\n vec2 cUV = uv - vec2(0.5); // centered UV\n float len = length(cUV);\n float theta = atan(cUV.y, cUV.x) + param * smoothstep(radius, 0.0, len);\n float dist = length(cUV);\n vec4 tex = texture(sampler, vec2(dist * cos(theta), dist * sin(theta)) + vec2(0.5));\n \n color = tex;\n}","/filters/contrast.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4((tex.rgb - 0.5) * param + 0.5, tex.a);\n}","/filters/fisheye.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nin vec2 pos;\nout vec4 color;\nvoid main() {\n vec2 mapped = (vec2(\n pos.x * sqrt(1.0 - pos.y * pos.y * param),\n pos.y * sqrt(1.0 - pos.x * pos.x * param)\n ) + 1.0) / 2.0;\n \n vec4 tex = texture(sampler, mapped);\n color = tex;\n}","/filters/emboss.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n -2.0, -1.0, 0.0,\n -1.0, 1.0, 1.0,\n 0.0, 1.0, 2.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/sobel.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nuniform float[9] kernel;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}"},Dark.compileListKA=[],Dark.loadFile=function(e){if(Dark.khan)return Dark.fileCacheKA[e];{Dark.editor||(e="https://cdn.jsdelivr.net/gh/99TheDark/Dark.js@"+Dark.version+"/filters/"+e);let t=null,n=new XMLHttpRequest;return n.open("GET",e,!1),n.send(),200==n.status&&(t=n.responseText),Dark.editor&&Dark.compileListKA.push({location:e,contents:t.replace(/\n\n+/g,"\n").replace(/  +/g," ")}),t}},Dark.compileKA=function(){Dark.editor&&Dark.compileListKA.forEach(e=>Dark.fileCacheKA[e.location]=e.contents)},Dark.globallyUpdateVariables=function(e){if(e.isMain){for(let t in Dark.empties.forEach(function(t){window[t]&&(e[t]=window[t])}),e)if(!Dark.ignoreGlobal.includes(t)&&!Dark.empties.includes(t)){if("object"!=typeof e[t]||e[t].darkObject||"keys"==t)window[t]=e[t];else for(let n in e[t])window[n]=e[t][n]}}},Dark.objects=function(){let e=function(t,n,a){if(!(this instanceof e))return new(Function.prototype.bind.apply(e,[null].concat(...arguments)));switch(this.darkObject=!0,arguments.length){default:Dark.error("DVector requires 2 or 3 parameters, not "+arguments.length);break;case 3:this.x=t,this.y=n,this.z=a,this.is2D=!1;break;case 2:this.x=t,this.y=n,this.is2D=!0}};e.create=function(t,n,a){return new e(t,n,a)},e.zero2D=function(){return new e(0,0)},e.prototype.zero2D=function(){[this.x,this.y]=[0,0],this.z=void 0,this.is2D=!0},e.zero3D=function(){return new e(0,0,0)},e.prototype.zero3D=function(){[this.x,this.y,this.z]=[0,0,0]},e.add=function(t,n){return n instanceof e?t.is2D?new e(t.x+n.x,t.y+n.y):new e(t.x+n.x,t.y+n.y,t.z+n.z):t.is2D?new e(t.x+n,t.y+n):new e(t.x+n,t.y+n,t.z+n)},e.prototype.add=function(t){t instanceof e?(this.x+=t.x,this.y+=t.y,this.z+=t.z):(this.x+=t,this.y+=t,this.z+=t)},e.sub=function(t,n){return n instanceof e?t.is2D?new e(t.x-n.x,t.y-n.y):new e(t.x-n.x,t.y-n.y,t.z-n.z):t.is2D?new e(t.x-n,t.y-n):new e(t.x-n,t.y-n,t.z-n)},e.prototype.sub=function(t){t instanceof e?(this.x-=t.x,this.y-=t.y,this.z-=t.z):(this.x-=t,this.y-=t,this.z-=t)},e.mult=function(t,n){return n instanceof e?t.is2D?new e(t.x*n.x,t.y*n.y):new e(t.x*n.x,t.y*n.y,t.z*n.z):n instanceof a||n instanceof DOMMatrix?(n instanceof DOMMatrix&&(n=new a(n)),t.is2D)?new e(t.x*n.get(0,0)+t.y*n.get(1,0)+n.get(3,0),t.x*n.get(0,1)+t.y*n.get(1,1)+n.get(3,1)):new e(t.x*n.get(0,0)+t.y*n.get(1,0)+t.z*n.get(2,0)+n.get(3,0),t.x*n.get(0,1)+t.y*n.get(1,1)+t.z*n.get(2,1)+n.get(3,1),t.x*n.get(0,2)+t.y*n.get(1,2)+t.z*n.get(2,2)+n.get(3,2)):t.is2D?new e(t.x*n,t.y*n):new e(t.x*n,t.y*n,t.z*n)},e.prototype.mult=function(t){t instanceof e?(this.x*=t.x,this.y*=t.y,this.z*=t.z):t instanceof a||t instanceof DOMMatrix?(t instanceof DOMMatrix&&(t=new a(t)),this.z,this.x,t.get(0,0),this.y,t.get(1,0),t.get(2,0),t.get(3,0),this.x,t.get(0,1),this.y,t.get(1,1),t.get(2,1),t.get(3,1),this.x,t.get(0,2),this.y,t.get(1,2),t.get(2,2),t.get(3,2)):(this.x*=t,this.y*=t,this.z*=t)},e.div=function(t,n){return n instanceof e?t.is2D?new e(t.x/n.x,t.y/n.y):new e(t.x/n.x,t.y/n.y,t.z/n.z):t.is2D?new e(t.x/n,t.y/n):new e(t.x/n,t.y/n,t.z/n)},e.prototype.div=function(t){t instanceof e?(this.x/=t.x,this.y/=t.y,this.z/=t.z):(this.x/=t,this.y/=t,this.z/=t)},e.pow=function(t,n){return n instanceof e?new e(t.x**n.x,t.y**n.y,t.z**n.z):new e(t.x**n,t.y**n,t.z**n)},e.prototype.pow=function(t){t instanceof e?(this.x**=t.x,this.y**=t.y,this.z**=t.z):(this.x**=t,this.y**=t,this.z**=t)},e.angle=function(e){return Dark.utils.atan2(e.y,e.x)},e.prototype.angle=function(){return Dark.utils.atan2(this.y,this.x)},e.angleBetween=function(e,t){return Dark.utils.atan2(t.y-e.y,t.x-e.x)},e.prototype.angleBetween=function(t){return e.angleBetween(this,t)},e.mag=function(e){return e.mag()},e.prototype.mag=function(){return this.is2D?Math.sqrt(this.x*this.x+this.y*this.y):Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.magSq=function(e){return e.magSq()},e.prototype.magSq=function(){return this.is2D?this.x*this.x+this.y*this.y:this.x*this.x+this.y*this.y+this.z*this.z},e.setMag=function(e,t){e.normalize(),e.mult(t)},e.prototype.setMag=function(e){this.normalize(),this.mult(e)},e.getRotation=function(e){return Dark.utils.atan2(e.y,e.x)},e.prototype.getRotation=function(){return Dark.utils.atan2(this.y,this.x)},e.setRotation=function(t,n){let a=t.mag();return new e(a*Dark.utils.cos(n),a*Dark.utils.sin(n))},e.prototype.setRotation=function(e){let t=this.mag();[this.x,this.y]=[t*Dark.utils.cos(e),t*Dark.utils.sin(e)]},e.rotate=function(e,t){e.setRotation(e.getRotation()+t)},e.prototype.rotate=function(e){this.setRotation(this.getRotation()+e)},e.normalize=function(t){let n=t.mag();return 0!=n?e.div(t,n):t.get()},e.prototype.normalize=function(){let e=this.mag();0!=e&&this.div(e)},e.cross=function(t,n){return new e(t.y*n.z-n.y*t.z,t.z*n.x-n.z*t.x,t.x*n.y-n.x*t.y)},e.prototype.cross=function(e){return this.cross(e)},e.dot=function(e,t){return"number"==typeof t?e.is2D?e.x*t+e.y*t:e.x*t+e.y*t+e.z*t:e.is2D&&t.is2D?e.x*t.x+e.y*t.y:e.is2D||t.is2D?void Dark.error("Cannot take the dot product of a 2D and 3D vector"):e.x*t.x+e.y*t.y+e.z*t.z},e.prototype.dot=function(t){return e.dot(this,t)},e.flip=function(e){return new Vector(-e.x,-e.y,-e.z)},e.prototype.flip=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},e.limit=function(e,t){return e.mag()>t&&e.mult(t/e.mag()),e},e.prototype.limit=function(e){this.mag()>e&&this.mult(e/this.mag())},e.lerp=function(t,n,a){return new e(Dark.utils.lerp(t.x,n.x,a),Dark.utils.lerp(t.y,n.y,a),Dark.utils.lerp(t.z,n.z,a))},e.prototype.lerp=function(e,t){this.x=Dark.utils.lerp(this.x,e.x,t),this.y=Dark.utils.lerp(this.y,e.y,t),this.z=Dark.utils.lerp(this.z,e.z,t)},e.abs=function(t){return t.is2D?new e(Math.abs(t.x),Math.abs(t.y)):new e(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))},e.prototype.abs=function(){[this.x,this.y,this.z]=[Math.abs(this.x),Math.abs(this.y),Math.abs(this.z)]},e.dist=function(e,t){let n,a,r=0;return e.is2D&&t.is2D?(n=t.x-e.x,a=t.y-e.y):e.is2D||t.is2D?Dark.error("Cannot find the distance between a 2D and 3D DVector"):(n=t.x-e.x,a=t.y-e.y,r=t.z-e.z),Math.sqrt(n*n+a*a+r*r)},e.prototype.dist=function(t){return e.dist(this,t)},e.applyTransform=function(t,n){return e.mult(t,n)},e.prototype.applyTransform=function(e){this.mult(e)},e.get=function(e){return e.get()},e.prototype.get=function(){return this.is2D?new e(this.x,this.y):new e(this.x,this.y,this.z)},e.set=function(e,...t){e.set.apply(null,t)},e.prototype.set=function(...e){let t=e[0];Array.isArray(t)?[this.x,this.y,this.z]=t:"object"==typeof t?[this.x,this.y,this.z]=[t.x,t.y,t.z]:[this.x,this.y,this.z]=e,this.is2D&&(this.z=void 0)},e.toArray=function(e){return e.toArray()},e.prototype.toArray=function(){return this.is2D?[this.x,this.y]:[this.x,this.y,this.z]},e.fromArray=function(t){return e.create.apply(null,t)},e.prototype.fromArray=function(e){switch(e.length){default:Dark.error("DVector.fromArray takes in an array of length 2 or 3, not "+e.length);break;case 2:[this.x,this.y]=e,this.z=void 0,this.is2D=!0;break;case 3:[this.x,this.y,this.z]=e,this.is2D=!1}},e.prototype.toString=function(){return this.is2D?"["+this.x+", "+this.y+"]":"["+this.x+", "+this.y+", "+this.z+"]"};let t=function(e){if(!(this instanceof t))return new(Function.prototype.bind.apply(t,[null].concat(...arguments)));this.darkObject=!0,this.style="normal",this.variant="normal",this.weight="normal",this.size=16,this.family="Arial";let n=e.split(" ");for(let a in n){let r=n[a];switch(r){case"normal":break;case"italic":this.style="italic";break;case"bold":this.weight="bold"}if("italic"==r)this.style="italic";else if("small-caps"==r)this.variant="small-caps";else if(t.weights.includes(r))this.weight=r;else if("normal"!==r){let i=parseInt(r);isNaN(i)?this.family=r:this.size=i}}};t.parse=function(e){return new t(e)},t.prototype.toString=function(){return this.style+" "+this.weight+" "+this.variant+" "+this.size+"px "+this.family},t.weights=["bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];let n=function(...e){if(!(this instanceof n))return new(Function.prototype.bind.apply(n,[null].concat(...arguments)));this.darkObject=!0,this.filters={},this.disposable=!1,this.imageSent=!1,this.imageLoaded=!1,this.image=null,e[0]instanceof ImageData?(this.imageData=e[0],this.source=e[1],this.width=e[0].width,this.height=e[0].height,this.canvas=new OffscreenCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.loadPixels()):"number"==typeof e[0]&&"number"==typeof e[1]?(this.width=e[0],this.height=e[1],this.source=e[2],this.imageData=new ImageData(this.width,this.height),this.canvas=new OffscreenCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d")):e[0]instanceof OffscreenCanvas||e[0]instanceof HTMLCanvasElement?(this.width=e[0].width,this.height=e[0].height,this.source=e[1],this.canvas=e[0],this.ctx=this.canvas.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)):(this.imageData=null,this.source=e[0],this.width=0,this.height=0)};n.prototype.get=function(...e){switch(e.length){default:return Dark.error("DImage.get requires 0 or 4 parameters, not "+e.length);case 0:return this.copy();case 4:return new n(this.ctx.getImageData(e[0],e[1],e[2],e[3]),this.source)}},n.prototype.set=function(e,t,n){let a=(e+t*this.width)*4;this.imageData.data[a]=Dark.utils.red(n),this.imageData.data[a+1]=Dark.utils.green(n),this.imageData.data[a+2]=Dark.utils.blue(n),this.imageData.data[a+3]=Dark.utils.alpha(n)},n.prototype.copy=function(){let e=new n;return[e.width,e.height,e.imageData,e.source,e.disposable]=[this.width,this.height,this.imageData,this.source,this.disposable],e.canvas=new OffscreenCanvas(this.width,this.height),e.ctx=e.canvas.getContext("2d"),e.ctx.drawImage(this.getRenderable(),0,0),e},n.prototype.getRenderable=function(){return this.imageLoaded?this.image:this.canvas},n.resize=function(e,t,n){let a=e.copy();return a.resize(t,n),a},n.prototype.resize=function(e,t){if(0==e||0==t)return Dark.error("Image resize size must be greater than zero");if(this.width!=e||this.height!=t){this.source instanceof Dark&&1==arguments.length&&(this.source.settings.resizeMode==this.source.constants.HEIGHT?[e,t]=[e/img.height*img.width,e]:[e,t]=[e,e/img.width*img.height]),[e,t]=[Math.ceil(e),Math.ceil(t)];let n=new OffscreenCanvas(this.width,this.height);n.getContext("2d").drawImage(this.getRenderable(),0,0),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[e,t],this.ctx.fillRect(0,0,e,t),this.ctx.drawImage(n,0,0,e,t),this.loadImage()}},n.crop=function(e,t,n,a,r){let i=e.copy();return i.crop(t,n,a,r),i},n.prototype.crop=function(e,t,n,a){if(n<=0||a<=0)return Dark.error("The image crop area must have a size greater than zero");if(e+n>this.width||t+a>this.height||e<0||t<0)return Dark.error("The cropped area must be within the image");if(this.width!=n||this.height!=a){this.source instanceof Dark&&3==arguments.length&&(this.source.settings.resizeMode==this.source.constants.HEIGHT?[n,a]=[n/img.height*img.width,n]:[n,a]=[n,n/img.width*img.height]);let r=new OffscreenCanvas(this.width,this.height);r.getContext("2d").drawImage(this.getRenderable(),0,0),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[n,a],this.ctx.drawImage(r,e,t,n,a,0,0,n,a),this.loadImage()}},n.prototype.loadPixels=function(){this.ctx.putImageData(this.imageData,0,0)},n.prototype.updatePixels=function(){this.imageData.data.set(this.ctx.getImageData(0,0,this.width,this.height).data)},n.prototype.setDisposability=function(e){this.disposable=e},n.filter=function(e,t,n){let a=e.copy();return a.filter(t,n),a},n.prototype.filter=function(e,t){if(!Dark.filters.includes(e))return Dark.error("Invalid filter type");{let a=n.filterShaders[e],r=this.filters;r.gl_canvas=n.gl_canvas,r.gl=n.gl,r.program=a.program,(r.gl_canvas.width!=this.width||r.gl_canvas.height!=this.height)&&([r.gl_canvas.width,r.gl_canvas.height]=[this.width,this.height],r.gl.viewport(0,0,this.width,this.height)),r.gl.useProgram(r.program),r.tris=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.tris),r.gl.bufferData(r.gl.ARRAY_BUFFER,n.texData,r.gl.STATIC_DRAW),r.trisIndex=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,r.trisIndex),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,n.texIndices,r.gl.STATIC_DRAW),r.fs=Float32Array.BYTES_PER_ELEMENT,r.posAttribLocation=r.gl.getAttribLocation(r.program,"vertPos"),r.uvAttribLocation=r.gl.getAttribLocation(r.program,"vertUV"),r.gl.vertexAttribPointer(r.posAttribLocation,2,r.gl.FLOAT,r.gl.FALSE,4*r.fs,0),r.gl.vertexAttribPointer(r.uvAttribLocation,2,r.gl.FLOAT,r.gl.FALSE,4*r.fs,2*r.fs),r.gl.enableVertexAttribArray(r.posAttribLocation),r.gl.enableVertexAttribArray(r.uvAttribLocation),r.sizeUniformLocation=r.gl.getUniformLocation(r.program,"size"),r.gl.uniform2f(r.sizeUniformLocation,this.width,this.height),a.multikernel?(Object.keys(a.multikernel).includes(String(t))||(t=a.defaultShader),r.kernelUniformLocation=r.gl.getUniformLocation(r.program,"kernel"),r.gl.uniform1fv(r.kernelUniformLocation,a.multikernel[t])):a.param&&(t=void 0!=t?Dark.utils.constrain(t,a.param.min,a.param.max):a.param.default,r.paramUniformLocation=r.gl.getUniformLocation(r.program,"param"),r.gl.uniform1f(r.paramUniformLocation,t)),r.applied??=[],r.applied.push({filter:e,parameter:t}),r.texture=r.gl.createTexture(),r.gl.bindTexture(r.gl.TEXTURE_2D,r.texture),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_S,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_T,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.LINEAR),r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,r.gl.RGBA,r.gl.UNSIGNED_BYTE,this.getRenderable()),r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindTexture(r.gl.TEXTURE_2D,r.texture),r.gl.activeTexture(r.gl.TEXTURE0),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.gl.drawElements(r.gl.TRIANGLES,n.texIndices.length,r.gl.UNSIGNED_SHORT,0);let i=new Uint8ClampedArray(this.width*this.height*4);r.gl.readPixels(0,0,this.width,this.height,r.gl.RGBA,r.gl.UNSIGNED_BYTE,i),this.imageData.data.set(i),this.ctx.putImageData(this.imageData,0,0),this.loadImage()}},n.texData=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),n.texIndices=new Uint16Array([0,1,2,1,2,3]),n.globalVertexShader=Dark.loadFile("/filters/global.vert"),n.filterShaders=[],n.gl_canvas=new OffscreenCanvas(0,0),n.gl=n.gl_canvas.getContext("webgl2",{antialias:!1}),n.initializeShaders=function(e){let t=n.gl,a=n.globalVertexShader;if(!t)return Dark.warn("Your browser does not support WebGL2.");e.forEach(function(e){let r=Dark.loadFile("/filters/"+e.shader+".frag"),i=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,a),t.shaderSource(o,r),t.compileShader(i),t.compileShader(o),!t.getShaderParameter(i,t.COMPILE_STATUS))return Dark.error("Error compiling vertex shader.\n\n"+t.getShaderInfoLog(i));if(!t.getShaderParameter(o,t.COMPILE_STATUS))return Dark.error("Error compiling fragment shader.\n\n"+t.getShaderInfoLog(o));let s=t.createProgram();return(t.attachShader(s,i),t.attachShader(s,o),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS))?(t.validateProgram(s),t.getProgramParameter(s,t.VALIDATE_STATUS))?void(n.filterShaders[e.key]={shader:r,param:e.param,program:s,multikernel:e.multikernel,defaultShader:e.defaultShader}):Dark.error("Error validating program.\n\n"+t.getProgramInfoLog(s)):Dark.error("Error linking program.\n\n"+t.getProgramInfoLog(s))})},n.prototype.generateImage=function(e){this.image=new Image,this.image.src=URL.createObjectURL(e),this.image.crossOrigin="anonymous",this.image.addEventListener("load",()=>{this.imageLoaded=!0,this.imageSent=!1})},n.prototype.loadImage=function(){if(this.image=null,this.imageLoaded=!1,!Dark.khan&&!this.disposable&&!this.imageSent){this.imageSent=!0;cancelAnimationFrame(requestAnimationFrame(()=>{this.canvas instanceof HTMLCanvasElement?this.canvas.toBlob(this.generateImage,{type:"image/png"}):this.canvas.convertToBlob({type:"image/png"}).then(e=>this.generateImage(e))}))}},n.get=(e,...t)=>e.get.apply(null,t),n.set=(e,...t)=>e.set.apply(null,t),n.copy=e=>e.copy(),n.getRenderable=e=>e.getRenderable(),n.loadPixels=e=>e.loadPixels(),n.updatePixels=e=>e.updatePixels(),n.setDisposability=(e,t)=>e.setDisposability(t),n.initializeShaders([{key:Dark.constants.INVERT,shader:"invert"},{key:Dark.constants.OPAQUE,shader:"opaque"},{key:Dark.constants.GRAY,shader:"grayscale"},{key:Dark.constants.ERODE,shader:"erode"},{key:Dark.constants.DILATE,shader:"dilate"},{key:Dark.constants.THRESHOLD,shader:"threshold",param:{min:0,max:1,default:.5}},{key:Dark.constants.POSTERIZE,shader:"posterize",param:{min:2,max:255,default:255}},{key:Dark.constants.BLUR,shader:"blur",param:{min:0,max:25,default:1}},{key:Dark.constants.SHARPEN,shader:"sharpen"},{key:Dark.constants.SEPIA,shader:"sepia"},{key:Dark.constants.OUTLINE,shader:"outline"},{key:Dark.constants.SWIRL,shader:"swirl",param:{min:0,max:12,default:4}},{key:Dark.constants.EDGE,shader:"edge"},{key:Dark.constants.CONTRAST,shader:"contrast",param:{min:0,max:15,default:3}},{key:Dark.constants.VIGNETTE,shader:"vignette",param:{min:0,max:1,default:.5}},{key:Dark.constants.BRIGHTNESS,shader:"brightness",param:{min:-1,max:1,default:0}},{key:Dark.constants.BLACK,shader:"black",param:{min:0,max:1,default:0}},{key:Dark.constants.WHITE,shader:"white",param:{min:0,max:1,default:1}},{key:Dark.constants.NORMALIZE,shader:"normalize"},{key:Dark.constants.BOX,shader:"box",param:{min:0,max:25,default:1}},{key:Dark.constants.TRANSPARENCY,shader:"transparency",param:{min:0,max:1,default:0}},{key:Dark.constants.PIXELATE,shader:"pixelate",param:{min:1,max:5e3,default:1}},{key:Dark.constants.FISHEYE,shader:"fisheye",param:{min:-1,max:1,default:-1}},{key:Dark.constants.EMBOSS,shader:"emboss"},{key:Dark.constants.SOBEL,shader:"sobel",multikernel:Object.fromEntries([[Dark.constants.TOP,[1,2,1,0,0,0,-1,-2,-1]],[Dark.constants.BOTTOM,[-1,-2,-1,0,0,0,1,2,1]],[Dark.constants.LEFT,[1,0,-1,2,0,-2,1,0,-1]],[Dark.constants.RIGHT,[-1,0,1,-2,0,2,-1,0,1]]]),defaultShader:Dark.constants.TOP}]);let a=function(e,t,n=0){if(!(this instanceof a))return new(Function.prototype.bind.apply(a,[null].concat(...arguments)));this.darkObject=!0,e instanceof a?(this.width=e.width,this.height=e.height,this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),this.set(e)):Array.isArray(e)?(Array.isArray(e[0])?(this.width=e[0].length,this.height=e.length):(this.width=t,this.height=n),this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),this.set(e)):e instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=[e.m11,e.m21,e.m31,e.m41,e.m12,e.m22,e.m32,e.m42,e.m13,e.m23,e.m33,e.m43,e.m14,e.m24,e.m34,e.m44]):(this.width=e,this.height=t,this.mat=Array(t).fill(null).map(()=>Array(e).fill(n)))};a.prototype.get=function(e,t){return this.mat[t][e]},a.set=function(e,t,n,a){e.set(t,n,a)},a.prototype.set=function(e,t,n){if(e instanceof a)for(let r=0;r<e.height;r++)for(let i=0;i<e.width;i++)this.mat[r][i]=e.mat[r][i];else if(Array.isArray(e)){if(Array.isArray(e[0]))for(let o=0;o<e.length;o++)for(let s=0;s<e[0].length;s++)this.mat[o][s]=e[o][s];else for(let l=0;l<this.width*this.height;l++){let c=l%this.width,u=Math.floor(l/this.width);this.mat[u][c]=e[l]}}else this.mat[t][e]=n},a.dot=function(e,t,n,a){if(e.width==t.height){let r=0;for(let i=0;i<e.width;i++)r+=e.get(i,n)*t.get(a,i);return r}Dark.error("Can only take the dot product of two DMatrices  with equal width and height")},a.prototype.dot=function(e){return a.dot(this,e)},a.identity=function(e){let t=new a(e,e);for(let n=0;n<e;n++)t.set(n,n,1);return t},a.prototype.identity=function(){this.width==this.height?this.mat=a.identity(this.width).mat:Dark.error("Only DMatrices with square dimensions have identity DMatrices")},a.add=function(e,t){if("number"==typeof t){let n=new a(e.width,e.height);for(let r=0;r<n.height;r++)for(let i=0;i<n.width;i++)n.set(r,i,e.get(i,r)+t);return n}if(e.width==t.width&&e.height==t.height){let o=new a(e.width,e.height);for(let s=0;s<o.height;s++)for(let l=0;l<o.width;l++)o.set(s,l,e.get(l,s)+t.get(l,s));return o}Dark.error("Cannot add two DMatrices with different dimensions")},a.prototype.add=function(e){this.set(a.add(this,e))},a.sub=function(e,t){if("number"==typeof t){let n=new a(e.width,e.height);for(let r=0;r<n.height;r++)for(let i=0;i<n.width;i++)n.set(r,i,e.get(i,r)-t);return n}if(e.width==t.width&&e.height==t.height){let o=new a(e.width,e.height);for(let s=0;s<o.height;s++)for(let l=0;l<o.width;l++)o.set(s,l,e.get(l,s)-t.get(l,s));return o}Dark.error("Cannot subtract two DMatrices with different dimensions")},a.prototype.sub=function(e){this.set(a.sub(this,e))},a.mult=function(e,t){if("number"==typeof t){let n=new a(e.width,e.height);for(let r=0;r<n.height;r++)for(let i=0;i<n.width;i++)n.set(r,i,e.get(i,r)*t);return n}if(e.width==t.height){let o=new a(t.width,e.height);for(let s=0;s<o.height;s++)for(let l=0;l<o.width;l++)o.set(l,s,a.dot(e,t,s,l));return o}Dark.error("Can only multiply two DMatrices with equal width and height")},a.prototype.mult=function(e){let t=a.mult(this,e);this.width=t.width,this.height=t.height,this.mat=t.mat},a.copy=function(e){return new a([...e.mat])},a.prototype.copy=function(){return new a([...this.mat])},a.fromDOMMatrix=function(e){if(e instanceof DOMMatrix)return new a(e);Dark.error(e+" is not a DOMMatrix")},a.prototype.fromDOMMatrix=function(e){e instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=new a(e).mat):Dark.error(e+" is not a DOMMatrix")},a.toDOMMatrix=function(e){return e.toDOMMatrix()},a.prototype.toDOMMatrix=function(){return new DOMMatrix(this.toArray())},a.prototype.toArray2D=function(){return[...this.mat]},a.prototype.toArray=function(){return[...this.mat.flat(1)]},a.prototype.toString=function(){let e="";for(let t in this.mat){for(let n in this.mat[t])e+=this.mat[t][n]+" ";e=e.replace(/ $/,"\n")}return e};let r=function(e=1e6*Math.random()){if(!(this instanceof r))return new(Function.prototype.bind.apply(r,[null].concat(...arguments)));this.darkObject=!0,this.seed=e,this.a=0x9af1b04258d,this.b=13034335,this.c=6856007898,this.d=16647635*e};r.prototype.next=function(){let e=this.b<<9,t=this.a+this.d;return t=(t<<7|t>>>25)+this.a,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=e,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},r.copy=function(e){return e.copy()},r.prototype.copy=function(){let e=new r(this.seed);return[e.a,e.b,e.c,e.d]=[this.a,this.b,this.c,this.d],e},r.create=function(e){return new r(e)};let i=function(){if(!(this instanceof i))return new(Function.prototype.bind.apply(i,[null].concat(...arguments)));this.darkObject=!0,this.reset()};i.prototype.start=function(){null==this.begin?this.begin=performance.now():Dark.error("DTimer.reset must be called before a new timer begins")},i.prototype.stop=function(){null==this.start?Dark.error("DTimer.start must be called before DTimer.error"):(this.end=performance.now(),this.time=this.end-this.begin)},i.prototype.reset=function(){this.begin=null,this.end=null,this.time=null},i.prototype.copy=function(){let e=new i;return[e.start,e.end,e.time]=[this.begin,this.end,this.time],e},i.prototype.toString=function(){return null==this.start?`From ${this.begin.toFixed(2)} to ${this.end.toFixed(2)}, taking ${this.time.toFixed(2)} milliseconds`:"The timer has yet to begin"},i.prototype.getSecond=function(){return this.time/1e3},i.prototype.getMillis=function(){return this.time},i.prototype.getMicro=function(){return 1e3*this.time},i.prototype.getNano=function(){return 1e6*this.time},i.prototype.getFPS=function(){return 1e3/this.time},i.start=e=>e.start(),i.stop=e=>e.stop(),i.reset=e=>e.reset(),i.copy=e=>e.copy(),i.toString=e=>e.toString();let o={nextID:function(){return(++this.current).toString(36)}};return o.current=BigInt(Math.abs(Math.floor((0xcfd41b9100000*Math.random()+Date.now()**3)/1e20)))<<BigInt(Math.floor(10*Math.random())),{DVector:e,DFont:t,DImage:n,DMatrix:a,DRandom:r,DTimer:i,DIdentification:o}}(),Dark.focus={},document.addEventListener("click",e=>{Dark.focus.target=e.target,Dark.focus.time=performance.now()}),Dark.startTime=performance.now(),Dark.compileKA(),Dark.utils=new Dark(!0),Dark.setMain(new Dark),Dark.globallyUpdateVariables(Dark.main),Object.freeze(Dark);
