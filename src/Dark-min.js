/*

  All code by @99TheDark unless noted. (See CREDITS.md)
  
  Minified with Toptal.

*/

if(window.Dark)throw"There is more than one Dark.js import";var Dark=function(t=!1){if(!(this instanceof Dark))throw"Dark can only be called with the new operator";this.darkObject=!0;let e=performance.now(),a=performance.now(),n=-1,r=this,s=r.constants=Dark.constants;Dark.instances.push(r);let i={};for(let o in r.keys=new Proxy(i,{get:(t,e)=>t[e]??!1,set(){}}),r.info={id:Math.floor(1e6*Math.random()),initializationTime:performance.now(),version:Dark.version},r.settings={},r.transforms=[],r.saves=[],r.styles=[],r.vertices=[],r.vertexCache=[],r.imageCache={},r.cachedImageCount=0,r.successfullyCachedImageCount=0,r.loaded=!1,r.began=!1,r.objects=Dark.objects,r.copy=Dark.copy,r.format=Dark.format,r.randomGenerator=r.objects.DRandom.create(),r.dummy=t,Dark.variables)r[o]=Dark.variables[o];r.isMain=!1,r.canvas=new OffscreenCanvas(innerWidth,innerHeight),r.ctx=r.canvas.getContext("2d",Dark.defaultContextSettings),Dark.empties.forEach(t=>r[t]=()=>{});var c=function(t){return r.snap(r.settings.angleMode==s.DEGREES?t*s.PI/180:t,0,s.TAU)},l=function(t){r.vertices.push(t),t.points.forEach(t=>r.vertexCache.push(r.objects.DVector.create(t.x,t.y)))},u=function(){r.frameRate(60),r.smooth(),r.ellipseMode(s.CENTER),r.rectMode(s.CORNER),r.imageMode(s.CORNER),r.angleMode(s.DEGREES),r.strokeCap(s.ROUND),r.strokeJoin(s.MITER),r.textAlign(s.LEFT,s.BASELINE),r.curveTightness(2),r.fill(255),r.stroke(0),r.strokeWeight(1),r.textFont("12px Arial"),r.textLeading(5)},h=function(t){for(let e in r.ctx){let a=t[e];"canvas"!=e&&"function"!=typeof a&&(r.ctx[e]=a)}},g=function(){r.canvas.addEventListener("click",function(t){t.preventDefault(),Dark.globallyUpdateVariables(r),r.mouseClicked()}),r.canvas.addEventListener("mousedown",function(t){t.preventDefault(),r.mouseIsPressed=!0,r.mouseButton=Dark.mouseMap[t.button],Dark.globallyUpdateVariables(r),r.mousePressed()}),r.canvas.addEventListener("mouseup",function(t){t.preventDefault(),r.mouseButton=void 0,r.mouseIsPressed=!1,Dark.globallyUpdateVariables(r),r.mouseReleased()}),r.canvas.addEventListener("mouseenter",function(t){t.preventDefault(),r.mouseIsInside=!0,Dark.globallyUpdateVariables(r),r.mouseIn()}),r.canvas.addEventListener("mouseleave",function(t){t.preventDefault(),r.mouseIsInside=!1,Dark.globallyUpdateVariables(r),r.mouseOut()}),r.canvas.addEventListener("mousemove",function(t){t.preventDefault();let e=t.target.getBoundingClientRect();r.pmouseX=r.pmouse.x=r.mouseX,r.pmouseY=r.pmouse.y=r.mouseY,r.mouseX=r.mouse.x=r.constrain(r.round(t.pageX-e.x),0,width),r.mouseY=r.mouse.y=r.constrain(r.round(t.pageY-e.y),0,height),Dark.globallyUpdateVariables(r),r.mouseMoved()}),r.canvas.addEventListener("wheel",function(t){t.preventDefault(),r.mouseScroll=r.objects.DVector.create(t.deltaX,t.deltaY,t.deltaZ),Dark.globallyUpdateVariables(r),r.mouseScrolled()}),r.canvas.addEventListener("dblclick",function(t){t.preventDefault(),Dark.globallyUpdateVariables(r),r.mouseDoubleClicked()})},d=function(t){return"rgba("+r.red(t)+", "+r.green(t)+", "+r.blue(t)+", "+r.alpha(t)/255+")"};!function(t){for(let e in t)r[e]=t[e]}({size:function(t=innerWidth,e=innerHeight){if("number"==typeof t&&"number"==typeof e&&t>0&&e>0){let a=r.copy(r.ctx);for(let n in[r.width,r.height]=[r.canvas.width,r.canvas.height]=[t,e],r.ctx){let s=a[n];"function"==typeof s||Dark.styleIgnore.includes(n)||(r.ctx[n]=s)}Dark.globallyUpdateVariables(r)}},setCanvas:function(t){if(t instanceof HTMLCanvasElement){r.canvas=t,r.width=t.width,r.height=t.height;let e=r.copy(r.ctx);r.ctx=t.getContext("2d",Dark.defaultContextSettings),h(e),r.canvas.style.cursor=r.settings.cursor,r.canvas.tabIndex="1",g()}},getCanvas:function(){return r.canvas},getContext:function(){return r.ctx},setTitle:function(t){document.title=t},dist:function(...t){let e,a;return t.length=6,e=t[2]-t[0],a=t[3]-t[1],r.sqrt(e*e+a*a+0)},gamma:function(t){return r.sqrt(s.TAU/t)*((t+1/(12*t+1/(10*t)))/E)**t},factorial:function(t){return Number.isInteger(t)?intFactorial(t):gamma(t+1)},intFactorial:function(t){let e=t=r.floor(t);for(;--t>1;)e*=t;return e},choose:function(t,e){return intFactorial(t)/(intFactorial(t-e)*intFactorial(e))},random:function(...t){switch(t.length){default:return r.randomGenerator.next()*(t[1]-t[0])+t[0];case 0:return r.randomGenerator.next();case 1:return r.randomGenerator.next()*t[0]}},randomSeed:function(t){t!=r.randomGenerator.seed&&(r.randomGenerator=r.objects.DRandom.create(t))},cursor:function(t="default"){r.settings.cursor=t,r.canvas.style.cursor=t},noCursor:function(){r.settings.cursor="none",r.canvas.style.cursor="none"},loop:function(){r.settings.looping=!0},noLoop:function(){r.settings.looping=!1},frameRate:function(t){r.settings.frameStep=1e3/t},enableContextMenu:function(){r.settings.contextMenu=!0,r.canvas.oncontextmenu=!0},disableContextMenu:function(){r.settings.contextMenu=!1,r.canvas.oncontextmenu=!1},color:function(t,e,a,n){let s=arguments.length;if(0==s)return -1;if(1==s||2==s){if(!(t<=255)||!(t>=0))return t;1==s?a=e=t:(n=e,e=t,a=t)}return n??=255,t=r.constrain(t,0,255),e=r.constrain(e,0,255),a=r.constrain(a,0,255),((n=r.constrain(n,0,255))<<24)+(t<<16)+(e<<8)+a},randomColor:function(){return color(255*r.randomGenerator.next(),255*r.randomGenerator.next(),255*r.randomGenerator.next())},red:t=>t>>16&255,green:t=>t>>8&255,blue:t=>255&t,alpha:t=>t>>24&255,lerpColor:function(t,e,a){return color(r.lerp(r.red(t),r.red(e),a),r.lerp(r.green(t),r.green(e),a),r.lerp(r.blue(t),r.blue(e),a),r.lerp(r.alpha(t),r.alpha(e),a))},fill:function(...t){let e=r.settings.fill=r.color.apply(null,t);r.ctx.fillStyle=d(e)},noFill:function(){r.settings.fill=0,r.ctx.fillStyle="rgba(0, 0, 0, 0)"},stroke:function(...t){let e=r.settings.stroke=r.color.apply(null,t);r.ctx.strokeStyle=d(e)},noStroke:function(){r.settings.stroke=0,r.ctx.strokeStyle="rgba(0, 0, 0, 0)"},background:function(...t){r.ctx.save(),r.ctx.resetTransform();let e=r.color.apply(null,t);r.ctx.fillStyle=d(e),r.ctx.clearRect(0,0,r.width,r.height),r.ctx.fillRect(0,0,r.width,r.height),r.ctx.restore()},clear:function(){r.ctx.save(),r.ctx.resetTransform(),r.ctx.clearRect(0,0,r.width,r.height),r.ctx.restore()},strokeCap:function(t){switch(t){default:Dark.error(Error("Invalid strokeCap type"));break;case s.FLAT:r.ctx.lineCap="butt",r.settings.strokeCap=s.FLAT;break;case s.ROUND:r.ctx.lineCap="round",r.settings.strokeCap=s.ROUND;break;case s.SQUARE:r.ctx.lineCap="square",r.settings.strokeCap=s.SQUARE}},strokeJoin:function(t=s.MITER){switch(t){default:Dark.error(Error("Invalid strokeJoin type"));break;case s.MITER:r.ctx.lineJoin="miter",r.settings.strokeJoin=s.MITER;break;case s.BEVEL:r.ctx.lineJoin="bevel",r.settings.strokeJoin=s.BEVEL;break;case s.ROUND:r.ctx.lineJoin="round",r.settings.strokeJoin=s.ROUND}},strokeWeight:function(t){r.settings.smoothing||(t=r.round(t)),r.settings.strokeWeight=t,r.ctx.lineWidth=t},smooth:function(){r.settings.smoothing=!0,r.ctx.imageSmoothingEnabled=!0,r.ctx.imageSmoothingQuality="high"},noSmooth:function(){r.settings.smoothing=!0,r.ctx.imageSmoothingEnabled=!1,r.ctx.imageSmoothingQuality="low"},angleMode:function(t){switch(t){default:Dark.error(Error("Invalid angleMode type"));break;case s.DEGREES:r.settings.angleMode=s.DEGREES;break;case s.RADIANS:r.settings.angleMode=s.RADIANS}},ellipseMode:function(t=s.CENTER){r.settings.ellipseMode=t},rectMode:function(t=s.CORNER){r.settings.rectMode=t},imageMode:function(t=s.CORNER){r.settings.imageMode=t},curveTightness:function(t=0){r.settings.curveTightness=t},pushMatrix:function(){r.transforms.length>r.maxStackSize?Dark.error(Error("Maximum matrix stack size reached, pushMatrix() called "+r.maxStackSize+" times.")):r.transforms.push(r.ctx.getTransform())},popMatrix:function(){let t=r.transforms.pop();t?r.ctx.setTransform(t):Dark.error(Error("No more transforms to restore in popMatrix()"))},resetMatrix:function(){r.transforms.length=0,r.ctx.resetTransform()},pushStyle:function(){r.styles.length>r.maxStackSize?Dark.error(Error("Maximum style stack size reached, pushStyle() called "+r.maxStackSize+" times.")):r.styles.push(r.copy(r.ctx))},popStyle:function(){let t=r.styles.pop();t?h(t):Dark.error(Error("No more styles to restore in popStyle()"))},resetStyle:function(){r.styles.length=0,u()},push:function(){r.transforms.length>r.maxStackSize?Dark.error(Error("Maximum stack size reached, push() called "+r.maxStackSize+" times.")):(r.ctx.save(),r.saves.push(Object.assign({},r.settings)))},pop:function(){let t=r.saves.pop();t?(r.ctx.restore(),Object.assign(r.settings,t)):Dark.error(Error("No more saves to restore in pop()"))},reset:function(){r.saves.length=0,r.settings=Object.assign({},r.defaultSettings),r.ctx.reset()},translate:function(t,e){r.ctx.translate(t,e)},rotate:function(t){r.ctx.rotate(c(t))},scale:function(t,e){arguments.length<2?r.ctx.scale(t,t):r.ctx.scale(t,e)},skew:function(t,e=0){let a=r.ctx.getTransform();a.b=.01*e,a.c=.01*t,r.ctx.setTransform(a)},rect:function(t,e,a,n,i,o,c,l){switch(r.settings.smoothing||([t,e,a,n]=[r.round(t),r.round(e),r.round(a),r.round(n)]),[a,n]=[r.abs(a),r.abs(n)],r.ctx.beginPath(),r.ctx.save(),r.settings.rectMode==s.CENTER&&r.ctx.translate(-a/2,-n/2),arguments.length){default:Dark.error(Error("rect takes in 4, 5 or 8 parameters, not "+arguments.length));break;case 4:r.ctx.rect(t,e,a,n);break;case 5:r.ctx.roundRect(t,e,a,n,i);break;case 8:r.ctx.roundRect(t,e,a,n,[i,o,c,l])}r.ctx.fill(),r.ctx.stroke(),r.ctx.restore()},ellipse:function(t,e,a,n){r.settings.smoothing||([t,e,a,n]=[r.round(t),r.round(e),r.round(a),r.round(n)]),[a,n]=[r.abs(a),r.abs(n)],r.ctx.beginPath(),r.ctx.save(),r.settings.ellipseMode==s.CORNER&&r.ctx.translate(a/2,n/2),r.ctx.beginPath(),r.ctx.ellipse(t,e,a/2,n/2,0,0,s.TAU,!1),r.ctx.fill(),r.ctx.stroke(),r.ctx.restore()},arc:function(t,e,a,n,i,o){r.settings.smoothing||([t,e,a,n]=[r.round(t),r.round(e),r.round(a),r.round(n)]),r.ctx.save(),r.settings.ellipseMode==s.CORNER&&r.ctx.translate(a/2,n/2),r.ctx.beginPath(),r.ctx.moveTo(t,e),r.ctx.ellipse(t,e,a/2,n/2,0,c(i),c(o),!1),r.ctx.fill(),r.ctx.beginPath(),r.ctx.ellipse(t,e,a/2,n/2,0,c(i),c(o),!1),r.ctx.stroke(),r.ctx.restore()},line:function(t,e,a,n){r.settings.smoothing||([t,e,a,n]=[r.round(t),r.round(e),r.round(a),r.round(n)]),r.ctx.beginPath(),r.ctx.moveTo(t,e),r.ctx.lineTo(a,n),r.ctx.stroke()},point:function(t,e){r.settings.smoothing||(t=r.round(t),e=r.round(e)),r.ctx.save(),r.ctx.beginPath(),r.ctx.fillStyle=d(r.settings.stroke),r.ctx.arc(t,e,r.settings.strokeWeight/2,0,s.TAU),r.ctx.fill(),r.ctx.restore()},circle:function(t,e,a){r.settings.smoothing||([t,e,a]=[r.round(t),r.round(e),r.round(a)]),a=r.round(a),r.ctx.save(),r.settings.ellipseMode==s.CORNER&&r.ctx.translate(a,a),r.ctx.beginPath(),r.ctx.arc(t,e,a,0,s.TAU),r.ctx.fill(),r.ctx.stroke(),r.ctx.restore()},square:function(...t){t.splice(3,0,t[2]),rect.apply(null,t)},triangle:function(t,e,a,n,s,i){r.settings.smoothing||([t,e,a,n,s,i]=[r.round(t),r.round(e),r.round(a),r.round(n),r.round(s),r.round(i)]),r.ctx.beginPath(),r.ctx.moveTo(t,e),r.ctx.lineTo(a,n),r.ctx.lineTo(s,i),r.ctx.closePath(),r.ctx.fill(),r.ctx.stroke()},quad:function(t,e,a,n,s,i,o,c){r.settings.smoothing||([t,e,a,n,s,i,o,c]=[r.round(t),r.round(e),r.round(a),r.round(n),r.round(s),r.round(i),r.round(o),r.round(c)]),r.ctx.beginPath(),r.ctx.moveTo(t,e),r.ctx.lineTo(a,n),r.ctx.lineTo(s,i),r.ctx.lineTo(o,c),r.ctx.closePath(),r.ctx.fill(),r.ctx.stroke()},beginShape:function(){r.vertices.length=0,r.vertexCache.length=0},endShape:function(t=s.OPEN){r.vertices.length<2||r.vertices[0].type==s.BEZIER||(r.ctx.beginPath(),r.vertices.forEach(function(t,e){if(0==e)r.ctx.moveTo(t.points[0].x,t.points[0].y);else switch(t.type){case s.VERTEX:let a=t.points[0];r.ctx.lineTo(a.x,a.y);break;case s.CURVE:let n=(r.settings.curveTightness-1)/6,i=r.vertexCache[e-3],o=r.vertexCache[e-2],c=r.vertexCache[e-1],l=r.vertexCache[e];if(2==e)break;0==e?r.ctx.moveTo(l.x,l.y):e<3?r.ctx.lineTo(l.x,l.y):(3==e&&r.ctx.lineTo(o.x,o.y),r.ctx.bezierCurveTo(c.x*n+o.x-i.x*n,c.y*n+o.y-i.y*n,-(l.x*n)+c.x+o.x*n,-(l.y*n)+c.y+o.y*n,c.x,c.y));break;case s.BEZIER:let u=t.points;r.ctx.bezierCurveTo(u[0].x,u[0].y,u[1].x,u[1].y,u[2].x,u[2].y);case s.SMOOTH:}}),t==s.CLOSE&&r.ctx.closePath(),r.ctx.fill(),r.ctx.stroke())},vertex:function(t,e){r.settings.smoothing||([t,e]=[r.round(t),r.round(e)]);l({type:s.VERTEX,points:[{x:t,y:e}]})},curveVertex:function(t,e){r.settings.smoothing||([x,y]=[r.round(t),r.round(e)]);l({type:s.CURVE,points:[{x:t,y:e}]})},bezierVertex:function(t,e,a,n,i,o){r.settings.smoothing||([t,e,a,n,i,o]=[r.round(t),r.round(e),r.round(a),r.round(n),r.round(i),r.round(o)]);l({type:s.BEZIER,points:[{x:t,y:e},{x:a,y:n},{x:i,y:o}]})},bezier:function(t,e,a,n,r,s,i,o){beginShape(),vertex(t,e),bezierVertex(a,n,r,s,i,o),endShape()},curve:function(t,e,a,n,r,s,i,o){beginShape(),vertex(t,e),vertex(a,n),vertex(r,s),curveVertex(i,o),endShape()},bezierPoint:function(t,e,a,n,r){let s=1-r;return s*s*s*t+3*s*s*r*e+3*s*r*r*a+r*r*r*n},curvePoint:function(t,e,a,n,r){return .5*(2*e+(a-t)*r+(2*t-5*e+4*a-n)*r*r+(3*e-3*a+n-t)*r*r*r)},curveTangent:function(t,e,a,n,r){return .5*(a-t+2*(2*t-5*e+4*a-n)*r+3*(3*e-3*a+n-t)*r*r)},bezierTangent:function(t,e,a,n,r){let s=1-r;return 3*s*s*(e-t)+6*s*r*(a-e)+3*r*r*(n-a)},reloadFont:function(){r.ctx.font=r.settings.font.toString(),r.settings.genericTextMeasure=r.ctx.measureText("0"),r.settings.textHeight=r.settings.genericTextMeasure.fontBoundingBoxAscent+r.settings.genericTextMeasure.fontBoundingBoxDescent},textSize:function(t){r.settings.smoothing||(t=r.round(t)),r.settings.textSize=t,r.settings.font.size=t,r.reloadFont()},textAlign:function(t,e){switch(0==arguments.length&&(t=s.LEFT,e=s.BASELINE),1==arguments.length&&t==s.CENTER&&(e=s.CENTER),t){default:Dark.error(Error("Invalid x alignment type"));break;case s.LEFT:r.ctx.textAlign="left",r.settings.alignX=s.LEFT;break;case s.RIGHT:r.ctx.textAlign="right",r.settings.alignX=s.RIGHT;break;case s.CENTER:r.ctx.textAlign="center",r.settings.alignX=s.CENTER}switch(e){default:Dark.error(Error("Invalid y alignment type"));break;case s.BASELINE:r.ctx.textBaseline="alphabetic",r.settings.alignY=s.BASELINE;break;case s.TOP:r.ctx.textBaseline="top",r.settings.alignY=s.TOP;break;case s.BOTTOM:r.ctx.textBaseline="bottom",r.settings.alignY=s.BOTTOM;break;case s.CENTER:r.ctx.textBaseline="middle",r.settings.alignY=s.CENTER}},textFont:function(t){"string"==typeof t&&(t=new r.objects.DFont(t)),t instanceof r.objects.DFont?(r.settings.font=t,r.settings.textSize=t.size,r.reloadFont()):Dark.error(t+" is not a DFont.")},createFont:function(t){return DFont.parse(t)},textStyle:function(t){switch(t){default:r.settings.font.weight="normal",r.settings.font.style="normal";break;case s.BOLD:r.settings.font.weight="bold";break;case s.ITALIC:r.settings.font.style="italic"}r.reloadFont()},textWidth:function(t){return r.ctx.measureText(t).width},textAscent:function(){return r.settings.genericTextMeasure.fontBoundingBoxAscent},textDescent:function(){return r.settings.genericTextMeasure.fontBoundingBoxDescent},textLeading:function(t){r.settings.lineGap=t},text:function(t,e,a){r.settings.smoothing||([e,a]=[r.round(e),r.round(a)]);let n=t.split("\n"),i=r.settings.alignY==s.CENTER?(r.settings.textHeight+r.settings.lineGap)*n.length/2:0;n.forEach((t,n)=>{let s=n*(r.settings.textHeight+r.settings.lineGap)-i;r.ctx.fillText(t,e,a+s),r.ctx.strokeText(t,e,a+s)})},get:function(...t){return 0==t.length?new DImage(r.ctx.getImageData(0,0,r.width,r.height),r.canvas):4==t.length?new DImage(r.ctx.getImageData(t[0],t[1],t[2],t[3]),r.canvas):void Dark.error(Error("get requires 0 or 4 parameters, not "+t.length))},set:function(t,e,a){r.ctx.save(),r.ctx.fillStyle=d(a),r.ctx.fillRect(t,e,1,1),r.ctx.restore()},image:function(t,e,a,n,i){r.settings.smoothing||([e,a,n,i]=[r.round(e),r.round(a),r.round(n),r.round(i)]),[n,i]=[r.abs(n),r.abs(i)],r.ctx.save(),t instanceof ImageData&&(t=new DImage(t));let o,c;switch(arguments.length){default:return r.ctx.restore(),Dark.error(Error("image requires 1, 3, 4 or 5 parameters, not "+arguments.length));case 1:[o,c]=[r.width,r.height];break;case 3:[o,c]=[t.width,t.height];break;case 4:[o,c]=[n,n/t.width*t.height];break;case 5:[o,c]=[n,i]}r.settings.imageMode==s.CENTER&&r.ctx.translate(-o/2,-c/2),r.ctx.drawImage(t.imageLoaded?t.image:t.canvas,e,a,o,c),r.ctx.restore()},loadImage:function(t){let e=new DImage(1,1,r);return Object.keys(r.imageCache).includes(t)&&r.began?r.imageCache[t]:(r.imageCache[t]=null,Dark.khan?(r.cachedImageCount++,e.image=new Image,e.image.src=t,e.image.crossOrigin="anonymous",e.image.onload=()=>{r.imageCache[t]=e,r.successfullyCachedImageCount++,[e.canvas.width,e.canvas.height]=[e.width,e.height]=[e.image.width,e.image.height],e.imageData=new ImageData(e.width,e.height),e.ctx.drawImage(e.image,0,0,e.width,e.height),e.updatePixels(),r.successfullyCachedImageCount==Object.keys(r.imageCache).length&&r.begin()}):(r.cachedImageCount++,fetch(t).then(t=>t.blob()).then(a=>{e.image=new Image,e.image.src=URL.createObjectURL(a),e.image.onload=()=>{createImageBitmap(a).then(a=>{let n=new DImage(a.width,a.height,r.canvas);n.ctx.drawImage(a,0,0,n.width,n.height),n.updatePixels(),r.imageCache[t]=n,r.successfullyCachedImageCount++,[e.canvas.width,e.canvas.height]=[e.width,e.height]=[n.width,n.height],e.imageData=n.imageData,e.loadPixels(),r.successfullyCachedImageCount==Object.keys(r.imageCache).length&&r.begin()})}}).catch(t=>Dark.error(t))),e)},getImage:function(t){if(!Dark.khan)return loadImage(Dark.url.host+"/"+t);{let e="https://cdn.kastatic.org/third_party/javascript-khansrc/live-editor/build/images/"+t+".png";if(Object.keys(r.imageCache).includes(e)&&r.began)return r.imageCache[e];let a=new r.objects.DImage(1,1,r);return r.imageCache[e]=null,r.cachedImageCount++,a.image=new Image,a.image.src=e,a.image.crossOrigin="anonymous",a.image.onload=()=>{r.imageCache[e]=a,r.successfullyCachedImageCount++,[a.canvas.width,a.canvas.height]=[a.width,a.height]=[a.image.width,a.image.height],a.imageData=new ImageData(a.width,a.height),a.ctx.drawImage(a.image,0,0,a.width,a.height),a.updatePixels(),r.successfullyCachedImageCount==Object.keys(r.imageCache).length&&r.begin()},a}},filter:function(t,e){let a=new DImage(r.ctx.getImageData(0,0,r.width,r.height),r.canvas);a.filter(t,e),r.ctx.putImageData(a.imageData,0,0)},min:(t,e)=>t<e?t:e,max:(t,e)=>t>e?t:e,log10:t=>Math.log10(t),log2:t=>Math.log2(t),log:t=>Math.log(t),logBase:(t,e)=>Math.log(t)/Math.log(e),mag:(t,e)=>Math.sqrt(t*t+e*e),norm:(t,e,a)=>(t-e)/(a-e),constrain:(t,e,a)=>Math.min(Math.max(t,e),a),between:(t,e,a)=>t<=a&&t>=e,exceeds:(t,e,a)=>t>a||t<e,lerp:(t,e,a)=>(e-t)*a+t,map:(t,e,a,n,r)=>n+(r-n)/(a-e)*(t-e),sq:t=>t*t,cb:t=>t*t*t,pow:(t,e)=>t**e,root:(t,e)=>t**(1/e),sqrt:t=>Math.sqrt(t),cbrt:t=>Math.cbrt(t),exp:t=>E**t,floor:t=>Math.floor(t),round:t=>Math.round(t),ceil:t=>Math.ceil(t),trunc:t=>Math.trunc(t),deci:t=>t-Math.trunc(t),abs:t=>t<0?-t:t,sign:t=>Math.sign(t),bsign:t=>t<0?-1:1,degrees:t=>180*t/s.PI,radians:t=>t*s.PI/180,millennium:()=>Math.floor(new Date().getFullYear()/1e3),century:()=>Math.floor(new Date().getFullYear()/100),decade:()=>Math.floor(new Date().getFullYear()/10),year:()=>new Date().getFullYear(),month:()=>new Date().getMonth(),day:()=>new Date().getDate(),hour:()=>new Date().getHours(),minute:()=>new Date().getMinutes(),second:()=>new Date().getSeconds(),millis:()=>Math.floor(performance.now()),micro:()=>Math.floor(1e3*performance.now()%1e3),nano:()=>Math.floor(1e6*performance.now()%1e3),today:()=>DAYS[new Date().getDay()],timezone:()=>-new Date().getTimezoneOffset()/60,sin:t=>Math.sin(c(t)),cos:t=>Math.cos(c(t)),tan:t=>Math.tan(c(t)),csc:t=>1/Math.sin(c(t)),sec:t=>1/Math.cos(c(t)),cot:t=>1/Math.tan(c(t)),atan2(t,e){var a;return a=Math.atan2(t,e),r.snap(r.settings.angleMode==s.DEGREES?180*a/s.PI:a,0,360)},asin:t=>Math.asin(c(t)),acos:t=>Math.acos(c(t)),atan:t=>Math.atan(c(t)),acsc:t=>Math.asin(1/c(t)),asec:t=>Math.acos(1/c(t)),acot:t=>Math.atan(1/c(t)),sinh:t=>Math.sinh(c(t)),cosh:t=>Math.cosh(c(t)),tanh:t=>Math.tanh(c(t)),csch:t=>1/Math.sinh(c(t)),sech:t=>1/Math.cosh(c(t)),coth:t=>1/Math.tanh(c(t)),asinh:t=>Math.asinh(c(t)),acosh:t=>Math.acosh(c(t)),atanh:t=>Math.atanh(c(t)),acsch:t=>Math.asinh(1/c(t)),asech:t=>Math.acosh(1/c(t)),acoth:t=>Math.atanh(1/c(t)),now:()=>performance.now(),reciprocal:t=>1/t,trim:t=>t.trim(),mod:(t,e)=>(t%e+e)%e,snap:(t,e,a)=>(t-e)%(a-e)+e}),r.raf=function(t){if(Dark.startTime>r.info.initializationTime){Dark.warn("Deleting old Dark.js instance."),Dark.instances.splice(Dark.instances.indexOf(r),1);return}let s=(t=performance.now())-e,i=t-a;a=performance.now();let o=s>r.settings.frameStep-i/2&&r.settings.looping;n<t&&n>a&&(s=i=t-n),o&&(e=t,r.draw(),r.dt=s/1e3,r.fps=1e3/s,r.frameCount=++r.frameCount),Dark.globallyUpdateVariables(r),requestAnimationFrame(r.raf)},r.begin=function(){r.loaded&&!r.began&&(r.began=!0,r.setup(),requestAnimationFrame(r.raf))},u(),r.defaultSettings=Object.assign({},r.settings),r.dummy||(document.addEventListener("keydown",function(t){Dark.focus.target===r.canvas&&(t.preventDefault(),r.keyIsPressed=!0,r.key=Dark.special[t.keyCode]??t.key,r.keyCode=t.keyCode,/\w/.test(String.fromCharCode(t.keyCode))&&r.keyTyped(),i[r.key]=!0,Dark.globallyUpdateVariables(r),r.keyPressed())}),document.addEventListener("keyup",function(t){Dark.focus.target===r.canvas&&(t.preventDefault(),i[r.key]=!1,r.keyIsPressed=!1,r.key=void 0,r.keyCode=void 0,Dark.globallyUpdateVariables(r),r.keyReleased())}),addEventListener("resize",function(t){t.preventDefault(),Dark.globallyUpdateVariables(r),r.pageResized()}),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState&&(r.keyIsPressed=!1,r.key=void 0,r.keyCode=void 0,r.mouseIsPressed=!1,r.mouseButton=void 0,r.mouseIsInside=!1,n=performance.now())}),r.mouse=r.objects.DVector.zero2D(),r.pmouse=r.objects.DVector.zero2D(),r.settings.cursor="auto",r.settings.looping=!0,Dark.khan&&Dark.imageLocationsKA.forEach(t=>r.getImage(t)),addEventListener("load",()=>{r.loaded=!0,Dark.globallyUpdateVariables(r),r.began||r.successfullyCachedImageCount!=r.cachedImageCount||r.begin()}))};Dark.instances=[],Dark.version="pre-0.6.10",Dark.empties=["draw","setup","keyPressed","keyReleased","keyTyped","mouseClicked","mousePressed","mouseReleased","mouseMoved","mouseScrolled","mouseIn","mouseOut","mouseDoubleClicked","pageResized"],Dark.constants={DAYS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],PI:Math.PI,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4,E:Math.E,PHI:Math.PHI,TAU:2*Math.PI,EPSILON:Number.EPSILON,ROUND:0,FLAT:1,DEGREES:2,RADIANS:3,VERTEX:4,CURVE:5,SMOOTH:6,BEZIER:7,CLOSE:8,OPEN:9,CENTER:10,CORNER:11,BOLD:12,ITALIC:13,NORMAL:14,BEVEL:15,MITER:16,SQUARE:17,LEFT:18,RIGHT:19,BASELINE:20,TOP:21,BOTTOM:22,GET:23,SET:24,PERLIN:25,SIMPLEX:26,WORLEY:27,VALUE:28,RANDOM:29,INVERT:30,OPAQUE:31,GRAY:32,ERODE:33,DILATE:34,THRESHOLD:35,POSTERIZE:36,BLUR:37,SHARPEN:38,SEPIA:39,OUTLINE:40,EMBOSS:41,EDGE:42,COTRAST:43,VIGNETTE:44,BRIGHTNESS:45,BLACK:46,WHITE:47,MEDIAN:48,BOX:49,TRANSPARENCY:50,PIXELATE:51},Dark.filters=[Dark.constants.INVERT,Dark.constants.OPAQUE,Dark.constants.GRAY,Dark.constants.THRESHOLD,Dark.constants.POSTERIZE,Dark.constants.SEPIA,Dark.constants.VIGNETTE,Dark.constants.BRIGHTNESS,Dark.constants.BLACK,Dark.constants.WHITE,Dark.constants.BOX,Dark.constants.TRANSPARENCY,Dark.constants.PIXELATE],Dark.special={16:"shift",13:"enter",8:"delete",9:"tab",27:"escape",32:"space",18:"option",17:"control",91:"left_meta",93:"right_meta",38:"up",40:"down",37:"left",39:"right",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",20:"capslock",190:"period",188:"comma",191:"slash",192:"backtick",220:"backslash",48:"zero",49:"one",50:"two",51:"three",52:"four",53:"five",54:"six",55:"seven",56:"eight",57:"nine",189:"minus",187:"equals",219:"left_bracket",221:"right_bracket",222:"single_quote",186:"semicolon"},Dark.cursors=["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out"],Dark.imageLocationsKA=["avatars/aqualine-sapling","avatars/aqualine-seed","avatars/aqualine-seedling","avatars/aqualine-tree","avatars/aqualine-ultimate","avatars/avatar-team","avatars/duskpin-sapling","avatars/duskpin-seed","avatars/duskpin-seedling","avatars/duskpin-tree","avatars/duskpin-ultimate","avatars/leaf-blue","avatars/leaf-green","avatars/leaf-grey","avatars/leaf-orange","avatars/leaf-red","avatars/leaf-yellow","avatars/leafers-sapling","avatars/leafers-seed","avatars/leafers-seedling","avatars/leafers-tree","avatars/leafers-ultimate","avatars/marcimus","avatars/marcimus-orange","avatars/marcimus-purple","avatars/marcimus-red","avatars/mr-pants","avatars/mr-pants-green","avatars/mr-pants-orange","avatars/mr-pants-pink","avatars/mr-pants-purple","avatars/mr-pants-with-hat","avatars/mr-pink","avatars/mr-pink-green","avatars/mr-pink-orange","avatars/old-spice-man","avatars/old-spice-man-blue","avatars/orange-juice-squid","avatars/piceratops-sapling","avatars/piceratops-seed","avatars/piceratops-seedling","avatars/piceratops-tree","avatars/piceratops-ultimate","avatars/primosaur-sapling","avatars/primosaur-seed","avatars/primosaur-seedling","avatars/primosaur-tree","avatars/primosaur-ultimate","avatars/purple-pi","avatars/purple-pi-pink","avatars/purple-pi-teal","avatars/questionmark","avatars/robot_female_1","avatars/robot_female_2","avatars/robot_female_3","avatars/robot_male_1","avatars/robot_male_2","avatars/robot_male_3","avatars/spunky-sam","avatars/spunky-sam","avatars/spunky-sam-orange","avatars/spunky-sam-red","avatars/starky-sapling","avatars/starky-seed","avatars/starky-seedling","avatars/starky-tree","avatars/starky-ultimate","creatures/Hopper-Happy","creatures/Hopper-Cool","creatures/Hopper-Jumping","creatures/OhNoes","creatures/OhNoes-Happy","creatures/OhNoes-Happy","creatures/BabyWinston","creatures/Winston","cute/Blank","cute/BrownBlock","cute/CharacterBoy","cute/CharacterCatGirl","cute/CharacterHornGirl","cute/CharacterPinkGirl","cute/CharacterPinkGirl","cute/ChestClosed","cute/ChestLid","cute/ChestOpen","cute/DirtBlock","cute/DoorTallClosed","cute/DoorTallOpen","cute/EnemyBug","cute/GemBlue","cute/GemGreen","cute/GemOrange","cute/GrassBlock","cute/Heart","cute/Key","cute/PlainBlock","cute/RampEast","cute/RampNorth","cute/RampSouth","cute/RampWest","cute/Rock","cute/RoofEast","cute/RoofNorth","cute/RoofNorthEast","cute/RoofNorthWest","cute/RoofSouth","cute/RoofSouthEast","cute/RoofSouthWest","cute/RoofWest","cute/Selector","cute/ShadowEast","cute/ShadowNorth","cute/ShadowNorthEast","cute/ShadowNorthWest","cute/ShadowSideWest","cute/ShadowSouth","cute/ShadowSouthEast","cute/ShadowSouthWest","cute/ShadowWest","cute/Star","cute/StoneBlock","cute/StoneBlockTall","cute/TreeShort","cute/TreeTall","cute/TreeUgly","cute/WallBlock","cute/WallBlockTall","cute/WaterBlock","cute/WindowTall","cute/WoodBlock","space/background","space/beetleship","space/collisioncircle","space/girl1","space/girl2","space/girl3","space/girl4","space/girl5","space/healthheart","space/minus","space/octopus","space/planet","space/plus","space/rocketship","space/star","space/0","space/1","space/2","space/3","space/4","space/5","space/6","space/7","space/8","space/9","animals/birds_rainbow-lorakeets","animals/butterfly","animals/butterfly_monarch","animals/cat","animals/cheetah","animals/crocodiles","animals/dog_sleeping-puppy","animals/dogs_collies","animals/fox","animals/horse","animals/kangaroos","animals/komodo-dragon","animals/penguins","animals/rabbit","animals/retriever","animals/shark","animals/snake_green-tree-boa","animals/spider","landscapes/beach-at-dusk","landscapes/beach-in-hawaii","landscapes/beach-sunset","landscapes/beach-waves-at-sunset","landscapes/beach-waves-daytime","landscapes/beach-with-palm-trees","landscapes/beach","landscapes/clouds-from-plane","landscapes/crop-circle","landscapes/fields-of-grain","landscapes/fields-of-wine","landscapes/lake","landscapes/lava","landscapes/lotus-garden","landscapes/mountain_matterhorn","landscapes/mountains-and-lake","landscapes/mountains-in-hawaii","landscapes/mountains-sunset","landscapes/sand-dunes","landscapes/waterfall_niagara-falls","food/bananas","food/berries","food/broccoli","food/brussels-sprouts","food/cake","food/chocolates","food/coffee-beans","food/croissant","food/dumplings","food/fish_grilled-snapper","food/fruits","food/grapes","food/hamburger","food/ice-cream","food/mushroom","food/oysters","food/pasta","food/potato-chips","food/potatoes","food/shish-kebab","food/strawberries","food/sushi","food/tomatoes","seasonal/father-winston","seasonal/fireworks-2015","seasonal/fireworks-in-sky","seasonal/fireworks-over-harbor","seasonal/fireworks-scattered","seasonal/gingerbread-family","seasonal/gingerbread-house","seasonal/gingerbread-houses","seasonal/gingerbread-man","seasonal/hannukah-dreidel","seasonal/hannukah-menorah","seasonal/hopper-elfer","seasonal/hopper-partying","seasonal/hopper-reindeer","seasonal/house-with-lights","seasonal/reindeer","seasonal/snow-crystal1","seasonal/snow-crystal2","seasonal/snow-crystal3","seasonal/snownoes","seasonal/snowy-slope-with-trees"],Dark.ignoreGlobal=["darkObject","info","empties","raf","begin","vertices","transforms","styles","saves","vertexCache","imageCache","cachedImageCount","successfullyCachedImageCount","settings","defaultSettings","isMain","canvas","ctx","dummy","loaded","began","randomGenerator"],Dark.styleIgnore=["canvas","width","height"],Dark.variables={width:innerWidth,height:innerHeight,dt:0,frameCount:0,fps:60,key:void 0,keyCode:void 0,keyIsPressed:!1,mouseIsPressed:!1,mouseIsInside:!1,mouseX:0,mouseY:0,pmouseX:0,pmouseY:0,mouse:void 0,pmouse:void 0,mouseButton:void 0},Dark.mouseMap=["left","middle","right","back","forward"],Dark.changeable={},Dark.darkObject=!0,Dark.changeable.errorCount=0,Dark.maxErrorCount=50,Dark.maxStackSize=500,Dark.defaultContextSettings={willReadFrequently:!0},Dark.url=new URL(location.href),Dark.khan="www.kasandbox.org"==Dark.url.host,Dark.editor="127.0.0.1:4444"==Dark.url.host,Dark.copy=function(t){if("object"!=typeof t&&"function"!=typeof t)return Dark.warn('"'+t+'" is not an object!'),t;{let e={};for(let a in t)e[a]=t[a];return"function"==typeof t&&0==Object.keys(e).length?t:e}},Dark.format=function(t){return"object"==typeof Dark.copy(t)?JSON.stringify(Dark.copy(t),null,"    "):t+""},Dark.rectRect=function(t,e,a,n,r,s,i,o){return t+a>r&&t<r+i&&e+n>s&&e<s+o},Dark.doError=function(t,e){Dark.changeable.errorCount==Dark.maxErrorCount?console.warn("Too many warnings and errors have been made, the rest will not display."):Dark.changeable.errorCount<Dark.maxErrorCount&&console[t](e),Dark.changeable.errorCount++},Dark.warn=function(t){Dark.doError("warn",t)},Dark.error=function(t){Dark.doError("error",t)},Dark.observe=function(t,e,a){3==arguments.length&&e!=Dark.constants.GET&&e!=Dark.constants.SET&&Dark.error(Error("Invalid type, must be either GET or SET")),t=new Proxy(t,{get:function(t,n){return e==Dark.constants.GET&&a(n),t[n]},set:function(t,n,r){e==Dark.constants.SET&&a(n,r),t[n]=r}})},Dark.setMain=function(t){t instanceof Dark?(Dark.main&&(Dark.main.isMain=!1),Dark.main=t,t.isMain=!0):Dark.error(t+" is not an instance of Dark")},Dark.getMain=function(){return Dark.main},Dark.fileCacheKA={"/filters/global.vert":"# version 300 es\nprecision lowp float;\nin vec2 pos;\nout vec2 uv;\nvoid main() {\n uv = (pos + 1.0) * 0.5; // Vertex position = -1 to 1, UV = 0 to 1\n gl_Position = vec4(pos, 0.0, 1.0);\n}","/filters/invert.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(1.0 - tex.rgb, tex.a);\n}","/filters/opaque.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb, 1.0);\n}","/filters/grayscale.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Based on how human eyes precieve\n color = vec4(vec3(luminance), tex.a);\n}","/filters/threshold.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance > param) {\n color = vec4(vec3(1.0), 1.0);\n } else {\n color = vec4(vec3(0.0), 1.0);\n }\n}","/filters/posterize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nfloat posterize(float val) {\n return floor(val * param + 0.5) / param;\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float red = posterize(tex.r);\n float green = posterize(tex.g);\n float blue = posterize(tex.b);\n \n color = vec4(red, green, blue, 1.0);\n}","/filters/black.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance <= param) {\n color = vec4(vec3(0.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/white.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance >= param) {\n color = vec4(vec3(1.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/vignette.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n vec2 pos = (uv * 2.0 - 1.0) * param;\n float dist = 1.0 - sqrt(pos.x * pos.x + pos.y * pos.y);\n color = vec4(tex.rgb * dist, tex.a);\n}","/filters/box.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n vec4 total = vec4(0.0);\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n total += texture(sampler, uv + vec2(x, y) / size);\n }\n }\n color = vec4(total / count);\n}","/filters/brightness.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb + param, tex.a);\n}","/filters/transparency.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb, tex.a - param);\n}","/filters/sepia.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(\n 0.393 * tex.r + 0.769 * tex.g + 0.189 * tex.b,\n 0.349 * tex.r + 0.686 * tex.g + 0.168 * tex.b,\n 0.272 * tex.r + 0.534 * tex.g + 0.131 * tex.b,\n tex.a\n );\n}","/filters/pixelate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec2 snap(vec2 point) {\n return floor(point * size / param) * param / size;\n}\nvoid main() {\n vec4 tex = texture(sampler, vec2(snap(uv)));\n \n color = tex;\n}"},Dark.compileListKA=[],Dark.loadFile=function(t){if(Dark.khan)return Dark.fileCacheKA[t];{Dark.editor||(t="https://cdn.jsdelivr.net/gh/99TheDark/Dark.js@"+Dark.version+"/filters/"+t);let e=null,a=new XMLHttpRequest;return a.open("GET",t,!1),a.send(),200==a.status&&(e=a.responseText),Dark.editor&&Dark.compileListKA.push({location:t,contents:e.replace(/\n\n+/g,"\n").replace(/  +/g," ")}),e}},Dark.compileKA=function(){Dark.editor&&(Dark.compileListKA.forEach(t=>Dark.fileCacheKA[t.location]=t.contents),console.log(Dark.format(Dark.fileCacheKA)))},Dark.globallyUpdateVariables=function(t){if(t.isMain){for(let e in Dark.empties.forEach(function(e){window[e]&&(t[e]=window[e])}),t)if(!Dark.ignoreGlobal.includes(e)&&!Dark.empties.includes(e)){if("object"!=typeof t[e]||t[e].darkObject||"keys"==e)window[e]=t[e];else for(let a in t[e])window[a]=t[e][a]}}},Dark.objects=function(){let t=function(t,e,a){switch(this.darkObject=!0,arguments.length){default:Dark.error(Error("DVector requires 2 or 3 parameters, not "+arguments.length));break;case 3:this.x=t,this.y=e,this.z=a,this.is2D=!1;break;case 2:this.x=t,this.y=e,this.is2D=!0}};t.create=function(e,a,n){return new t(e,a,n)},t.zero2D=function(){return new t(0,0)},t.prototype.zero2D=function(){[this.x,this.y]=[0,0],this.z=void 0,this.is2D=!0},t.zero3D=function(){return new t(0,0,0)},t.prototype.zero3D=function(){[this.x,this.y,this.z]=[0,0,0]},t.add=function(e,a){return a instanceof t?e.is2D?new t(e.x+a.x,e.y+a.y):new t(e.x+a.x,e.y+a.y,e.z+a.z):e.is2D?new t(e.x+a,e.y+a):new t(e.x+a,e.y+a,e.z+a)},t.prototype.add=function(e){e instanceof t?(this.x+=e.x,this.y+=e.y,this.z+=e.z):(this.x+=e,this.y+=e,this.z+=e)},t.sub=function(e,a){return a instanceof t?e.is2D?new t(e.x-a.x,e.y-a.y):new t(e.x-a.x,e.y-a.y,e.z-a.z):e.is2D?new t(e.x-a,e.y-a):new t(e.x-a,e.y-a,e.z-a)},t.prototype.sub=function(e){e instanceof t?(this.x-=e.x,this.y-=e.y,this.z-=e.z):(this.x-=e,this.y-=e,this.z-=e)},t.mult=function(e,a){return a instanceof t?e.is2D?new t(e.x*a.x,e.y*a.y):new t(e.x*a.x,e.y*a.y,e.z*a.z):e.is2D?new t(e.x*a,e.y*a):new t(e.x*a,e.y*a,e.z*a)},t.prototype.mult=function(e){e instanceof t?(this.x*=e.x,this.y*=e.y,this.z*=e.z):(this.x*=e,this.y*=e,this.z*=e)},t.div=function(e,a){return a instanceof t?e.is2D?new t(e.x/a.x,e.y/a.y):new t(e.x/a.x,e.y/a.y,e.z/a.z):e.is2D?new t(e.x/a,e.y/a):new t(e.x/a,e.y/a,e.z/a)},t.prototype.div=function(e){e instanceof t?(this.x/=e.x,this.y/=e.y,this.z/=e.z):(this.x/=e,this.y/=e,this.z/=e)},t.pow=function(e,a){return a instanceof t?new t(e.x**a.x,e.y**a.y,e.z**a.z):new t(e.x**a,e.y**a,e.z**a)},t.prototype.pow=function(e){e instanceof t?(this.x**=e.x,this.y**=e.y,this.z**=e.z):(this.x**=e,this.y**=e,this.z**=e)},t.angle=function(t){return Dark.utils.atan2(t.y,t.x)},t.prototype.angle=function(){return Dark.utils.atan2(this.y,this.x)},t.angleBetween=function(t,e){return Dark.utils.atan2(e.y-t.y,e.x-t.x)},t.prototype.angleBetween=function(e){return t.angleBetween(this,e)},t.mag=function(t){return t.mag()},t.prototype.mag=function(){return this.is2D?Math.sqrt(this.x*this.x+this.y*this.y):Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},t.magSq=function(t){return t.magSq()},t.prototype.magSq=function(){return this.is2D?this.x*this.x+this.y*this.y:this.x*this.x+this.y*this.y+this.z*this.z},t.setMag=function(t,e){t.normalize(),t.mult(e)},t.prototype.setMag=function(t){this.normalize(),this.mult(t)},t.getRotation=function(t){return Dark.utils.atan2(t.y,t.x)},t.prototype.getRotation=function(){return Dark.utils.atan2(this.y,this.x)},t.setRotation=function(e,a){let n=e.mag();return new t(n*Dark.utils.cos(a),n*Dark.utils.sin(a))},t.prototype.setRotation=function(t){let e=this.mag();[this.x,this.y]=[e*Dark.utils.cos(t),e*Dark.utils.sin(t)]},t.rotate=function(t,e){t.setRotation(t.getRotation()+e)},t.prototype.rotate=function(t){this.setRotation(this.getRotation()+t)},t.normalize=function(e){let a=e.mag();return 0!=a?t.div(e,a):e.get()},t.prototype.normalize=function(){let t=this.mag();0!=t&&this.div(t)},t.cross=function(e,a){return new t(e.y*a.z-a.y*e.z,e.z*a.x-a.z*e.x,e.x*a.y-a.x*e.y)},t.prototype.cross=function(t){return this.cross(t)},t.dot=function(t,e){return"number"==typeof e?t.is2D?t.x*e+t.y*e:t.x*e+t.y*e+t.z*e:t.is2D&&e.is2D?t.x*e.x+t.y*e.y:t.is2D||e.is2D?void Dark.error(Error("Cannot take the dot product of a 2D and 3D vector")):t.x*e.x+t.y*e.y+t.z*e.z},t.prototype.dot=function(e){return t.dot(this,e)},t.flip=function(t){return new Vector(-t.x,-t.y,-t.z)},t.prototype.flip=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},t.limit=function(t,e){return t.mag()>e&&t.mult(e/t.mag()),t},t.prototype.limit=function(){this.mag()>max&&this.mult(max/this.mag())},t.lerp=function(e,a,n){return new t(Dark.utils.lerp(e.x,a.x,n),Dark.utils.lerp(e.y,a.y,n),Dark.utils.lerp(e.z,a.z,n))},t.prototype.lerp=function(t,e){this.x=Dark.utils.lerp(this.x,t.x,e),this.y=Dark.utils.lerp(this.y,t.y,e),this.z=Dark.utils.lerp(this.z,t.z,e)},t.abs=function(e){return e.is2D?new t(Math.abs(e.x),Math.abs(e.y)):new t(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))},t.prototype.abs=function(){[this.x,this.y,this.z]=[Math.abs(this.x),Math.abs(this.y),Math.abs(this.z)]},t.dist=function(t,e){let a,n,r=0;return t.is2D&&e.is2D?(a=e.x-t.x,n=e.y-t.y):t.is2D||e.is2D?Dark.error(Error("Cannot find the distance between a 2D and 3D DVector")):(a=e.x-t.x,n=e.y-t.y,r=e.z-t.z),Math.sqrt(a*a+n*n+r*r)},t.prototype.dist=function(e){return t.dist(this,e)},t.get=function(t){return t.get()},t.prototype.get=function(){return this.is2D?new t(this.x,this.y):new t(this.x,this.y,this.z)},t.set=function(t,...e){t.set.apply(null,e)},t.prototype.set=function(...t){let e=t[0];Array.isArray(e)?[this.x,this.y,this.z]=e:"object"==typeof e?[this.x,this.y,this.z]=[e.x,e.y,e.z]:[this.x,this.y,this.z]=t,this.is2D&&(this.z=void 0)},t.toArray=function(t){return t.toArray()},t.prototype.toArray=function(){return this.is2D?[this.x,this.y]:[this.x,this.y,this.z]},t.fromArray=function(e){return t.create.apply(null,e)},t.prototype.fromArray=function(t){switch(t.length){default:Dark.error(Error("DVector.fromArray takes in an array of length 2 or 3, not "+t.length));break;case 2:[this.x,this.y]=t,this.z=void 0,this.is2D=!0;break;case 3:[this.x,this.y,this.z]=t,this.is2D=!1}},t.prototype.toString=function(){return this.is2D?"["+this.x+", "+this.y+"]":"["+this.x+", "+this.y+", "+this.z+"]"};let e=function(t){this.darkObject=!0,this.style="normal",this.variant="normal",this.weight="normal",this.size=16,this.family="Arial";let a=t.split(" ");for(let n in a){let r=a[n];switch(r){case"normal":break;case"italic":this.style="italic";break;case"bold":this.weight="bold"}if("italic"==r)this.style="italic";else if("small-caps"==r)this.variant="small-caps";else if(e.weights.includes(r))this.weight=r;else if("normal"!==r){let s=parseInt(r);isNaN(s)?this.family=r:this.size=s}}};e.parse=function(t){return new e(t)},e.prototype.toString=function(){return this.style+" "+this.weight+" "+this.variant+" "+this.size+"px "+this.family},e.weights=["bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];let a=function(...t){this.darkObject=!0,this.filters={},t[0]instanceof ImageData?(this.imageData=t[0],this.source=t[1],this.width=t[0].width,this.height=t[0].height,this.canvas=new OffscreenCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d",Dark.defaultContextSettings),this.loadPixels()):"number"==typeof t[0]&&"number"==typeof t[1]?(this.width=t[0],this.height=t[1],this.source=t[2],this.imageData=new ImageData(this.width,this.height),this.canvas=new OffscreenCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d",Dark.defaultContextSettings)):(this.imageData=null,this.source=t[0],this.width=0,this.height=0)};a.get=function(t,...e){return t.get.apply(null,e)},a.prototype.get=function(...t){return 0==t.length?this.copy():4==t.length?new a(this.ctx.getImageData(t[0],t[1],t[2],t[3]),this.source):void Dark.error(Error("DImage.get requires 0 or 4 parameters, not "+t.length))},a.set=function(t,...e){t.set.apply(null,e)},a.prototype.set=function(t,e,a){let n=(t+e*this.width)*4;this.imageData.data[n]=Dark.utils.red(a),this.imageData.data[n+1]=Dark.utils.green(a),this.imageData.data[n+2]=Dark.utils.blue(a),this.imageData.data[n+3]=Dark.utils.alpha(a)},a.copy=function(t){return t.copy()},a.prototype.copy=function(){return new a(new ImageData(new Uint8ClampedArray(this.imageData.data),this.width,this.height),this.source)},a.resize=function(t,e,a){t.resize(e,a)},a.prototype.resize=function(t,e){if(this.width!=t||this.height!=e){let a=new OffscreenCanvas(this.width,this.height);a.getContext("2d").drawImage(this.canvas,0,0),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[t,e],this.ctx.drawImage(a,0,0,this.width,this.height),this.image=void 0}},a.prototype.loadPixels=function(){this.ctx.putImageData(this.imageData,0,0)},a.prototype.updatePixels=function(){this.imageData.data.set(this.ctx.getImageData(0,0,this.width,this.height).data)},a.prototype.filter=function(t,e){if(!Dark.filters.includes(t))return Dark.error(Error("Invalid filter type"));{let n=a.filterShaders[t],r=this.filters;r.gl_canvas=a.gl_canvas,r.gl=a.gl,r.program=n.program,(r.gl_canvas.width!=this.width||r.gl_canvas.height!=this.height)&&([r.gl_canvas.width,r.gl_canvas.height]=[this.width,this.height],r.gl.viewport(0,0,this.width,this.height)),r.gl.useProgram(r.program),r.tris=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,r.tris),r.gl.bufferData(r.gl.ARRAY_BUFFER,a.texUV,r.gl.STATIC_DRAW),r.fs=Float32Array.BYTES_PER_ELEMENT,r.posAttribLocation=r.gl.getAttribLocation(r.program,"pos"),r.gl.vertexAttribPointer(r.posAttribLocation,2,r.gl.FLOAT,r.gl.FALSE,2*r.fs,0),r.gl.enableVertexAttribArray(r.posAttribLocation),r.sizeUniformLocation=r.gl.getUniformLocation(r.program,"size"),r.gl.uniform2f(r.sizeUniformLocation,this.width,this.height),n.param&&(e=void 0!=e?Dark.utils.constrain(e,n.param.min,n.param.max):n.param.default,r.paramUniformLocation=r.gl.getUniformLocation(r.program,"param"),r.gl.uniform1f(r.paramUniformLocation,e)),r.applied??=[],r.applied.push({filter:t,parameter:e}),r.texture=r.gl.createTexture(),r.gl.bindTexture(r.gl.TEXTURE_2D,r.texture),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_S,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_T,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.LINEAR),r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,r.gl.RGBA,r.gl.UNSIGNED_BYTE,this.imageData),r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindTexture(r.gl.TEXTURE_2D,r.texture),r.gl.activeTexture(r.gl.TEXTURE0),r.gl.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.gl.drawArrays(r.gl.TRIANGLES,0,6);let s=new Uint8ClampedArray(this.width*this.height*4);r.gl.readPixels(0,0,this.width,this.height,r.gl.RGBA,r.gl.UNSIGNED_BYTE,s),this.imageData.data.set(s),this.ctx.putImageData(this.imageData,0,0),this.image=null,this.imageLoaded=!1,Dark.khan||requestAnimationFrame(()=>{this.canvas.convertToBlob({type:"image/png"}).then(t=>{this.image=new Image,this.image.src=URL.createObjectURL(t),this.image.crossOrigin="anonymous",this.image.onload=()=>this.imageLoaded=!0})})}},a.texUV=new Float32Array([-1,-1,1,-1,-1,1,1,1,1,-1,-1,1]),a.globalVertexShader=Dark.loadFile("/filters/global.vert"),a.filterShaders=[],a.gl_canvas=new OffscreenCanvas(0,0),a.gl=a.gl_canvas.getContext("webgl2",{antialias:!1}),a.initializeShaders=function(t){let e=a.gl;if(!e)return Dark.warn("Your browser does not support WebGL2.");t.forEach(function(t){let n=Dark.loadFile("/filters/"+t.shader+".frag");return(vertexSource=a.globalVertexShader,fragmentSource=n,vertexShader=e.createShader(e.VERTEX_SHADER),fragmentShader=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(vertexShader,vertexSource),e.shaderSource(fragmentShader,fragmentSource),e.compileShader(vertexShader),e.compileShader(fragmentShader),e.getShaderParameter(vertexShader,e.COMPILE_STATUS))?e.getShaderParameter(fragmentShader,e.COMPILE_STATUS)?(program=e.createProgram(),e.attachShader(program,vertexShader),e.attachShader(program,fragmentShader),e.linkProgram(program),e.getProgramParameter(program,e.LINK_STATUS))?(e.validateProgram(program),e.getProgramParameter(program,e.VALIDATE_STATUS))?void(a.filterShaders[t.key]={shader:n,param:t.param,program:program}):Dark.error(Error("Error validating program.\n\n"+e.getProgramInfoLog(program))):Dark.error(Error("Error linking program.\n\n"+e.getProgramInfoLog(program))):Dark.error(Error("Error compiling fragment shader.\n\n"+e.getShaderInfoLog(fragmentShader))):Dark.error(Error("Error compiling vertex shader.\n\n"+e.getShaderInfoLog(vertexShader)))})},a.initializeShaders([{key:Dark.constants.INVERT,shader:"invert"},{key:Dark.constants.OPAQUE,shader:"opaque"},{key:Dark.constants.GRAY,shader:"grayscale"},{key:Dark.constants.THRESHOLD,shader:"threshold",param:{min:0,max:1,default:.5}},{key:Dark.constants.POSTERIZE,shader:"posterize",param:{min:2,max:255,default:255}},{key:Dark.constants.SEPIA,shader:"sepia"},{key:Dark.constants.VIGNETTE,shader:"vignette",param:{min:0,max:1,default:.5}},{key:Dark.constants.BRIGHTNESS,shader:"brightness",param:{min:-1,max:1,default:0}},{key:Dark.constants.BLACK,shader:"black",param:{min:0,max:1,default:0}},{key:Dark.constants.WHITE,shader:"white",param:{min:0,max:1,default:1}},{key:Dark.constants.BOX,shader:"box",param:{min:0,max:25,default:1}},{key:Dark.constants.TRANSPARENCY,shader:"transparency",param:{min:0,max:1,default:0}},{key:Dark.constants.PIXELATE,shader:"pixelate",param:{min:1,max:5e3,default:1}}]);let n=function(t,e,a=0){this.darkObject=!0,t instanceof n?(this.width=t.width,this.height=t.height,this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),this.set(t)):Array.isArray(t)?(Array.isArray(t[0])?(this.width=t[0].length,this.height=t.length):(this.width=e,this.height=a),this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),this.set(t)):t instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=[t.m11,t.m21,t.m31,t.m41,t.m12,t.m22,t.m32,t.m42,t.m13,t.m23,t.m33,t.m43,t.m14,t.m24,t.m34,t.m44]):(this.width=t,this.height=e,this.mat=Array(e).fill(null).map(()=>Array(t).fill(a)))};n.prototype.get=function(t,e){return this.mat[e][t]},n.set=function(t,e,a,n){t.set(e,a,n)},n.prototype.set=function(t,e,a){if(t instanceof n)for(let r=0;r<t.height;r++)for(let s=0;s<t.width;s++)this.mat[r][s]=t.mat[r][s];else if(Array.isArray(t)){if(Array.isArray(t[0]))for(let i=0;i<t.length;i++)for(let o=0;o<t[0].length;o++)this.mat[i][o]=t[i][o];else for(let c=0;c<this.width*this.height;c++){let l=c%this.width,u=Math.floor(c/this.width);this.mat[u][l]=t[c]}}else this.mat[e][t]=a},n.dot=function(t,e,a,n){if(t.width==e.height){let r=0;for(let s=0;s<t.width;s++)r+=t.get(s,a)*e.get(n,s);return r}Dark.error(Error("Can only take the dot product of two DMatrices  with equal width and height"))},n.prototype.dot=function(t){return n.dot(this,t)},n.identity=function(t){let e=new n(t,t);for(let a=0;a<t;a++)e.set(a,a,1);return e},n.prototype.identity=function(){this.width==this.height?this.mat=n.identity(this.width).mat:Dark.error(Error("Only DMatrices with square dimensions have identity DMatrices"))},n.add=function(t,e){if("number"==typeof e){let a=new n(t.width,t.height);for(let r=0;r<a.height;r++)for(let s=0;s<a.width;s++)a.set(r,s,t.get(s,r)+e);return a}if(t.width==e.width&&t.height==e.height){let i=new n(t.width,t.height);for(let o=0;o<i.height;o++)for(let c=0;c<i.width;c++)i.set(o,c,t.get(c,o)+e.get(c,o));return i}Dark.error(Error("Cannot add two DMatrices with different dimensions"))},n.prototype.add=function(t){this.set(n.add(this,t))},n.sub=function(t,e){if("number"==typeof e){let a=new n(t.width,t.height);for(let r=0;r<a.height;r++)for(let s=0;s<a.width;s++)a.set(r,s,t.get(s,r)-e);return a}if(t.width==e.width&&t.height==e.height){let i=new n(t.width,t.height);for(let o=0;o<i.height;o++)for(let c=0;c<i.width;c++)i.set(o,c,t.get(c,o)-e.get(c,o));return i}Dark.error(Error("Cannot subtract two DMatrices with different dimensions"))},n.prototype.sub=function(t){this.set(n.sub(this,t))},n.mult=function(t,e){if("number"==typeof e){let a=new n(t.width,t.height);for(let r=0;r<a.height;r++)for(let s=0;s<a.width;s++)a.set(r,s,t.get(s,r)*e);return a}if(t.width==e.height){let i=new n(e.width,t.height);for(let o=0;o<i.height;o++)for(let c=0;c<i.width;c++)i.set(c,o,n.dot(t,e,o,c));return i}Dark.error(Error("Can only multiply two DMatrices with equal width and height"))},n.prototype.mult=function(t){let e=n.mult(this,t);this.width=e.width,this.height=e.height,this.mat=e.mat},n.copy=function(t){return new n([...t.mat])},n.prototype.copy=function(){return new n([...this.mat])},n.fromDOMMatrix=function(t){if(t instanceof DOMMatrix)return new n(t);Dark.error(t+" is not a DOMMatrix")},n.prototype.fromDOMMatrix=function(t){t instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=new n(t).mat):Dark.error(t+" is not a DOMMatrix")},n.toDOMMatrix=function(t){return t.toDOMMatrix()},n.prototype.toDOMMatrix=function(){return new DOMMatrix(this.toArray())},n.prototype.toArray2D=function(){return[...this.mat]},n.prototype.toArray=function(){return[...this.mat.flat(1)]},n.prototype.toString=function(){let t="";for(let e in this.mat){for(let a in this.mat[e])t+=this.mat[e][a]+" ";t=t.replace(/ $/,"\n")}return t};let r=function(t=1e6*Math.random()){this.seed=t,this.a=0x9af1b04258d,this.b=13034335,this.c=6856007898,this.d=16647635*t};return r.prototype.next=function(){let t=this.b<<9,e=this.a+this.d;return e=(e<<7|e>>>25)+this.a,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(e>>>0)/4294967296},r.copy=function(t){return t.copy()},r.prototype.copy=function(){let t=new r(this.seed);return[t.a,t.b,t.c,t.d]=[this.a,this.b,this.c,this.d],t},r.create=function(t){return new r(t)},{DVector:t,DFont:e,DImage:a,DMatrix:n,DRandom:r}}(),Dark.focus={},document.addEventListener("click",t=>{Dark.focus.target=t.target,Dark.focus.time=performance.now()}),Dark.startTime=performance.now(),Dark.compileKA(),Dark.utils=new Dark(!0),Dark.setMain(new Dark),Dark.globallyUpdateVariables(Dark.main),Object.freeze(Dark);
