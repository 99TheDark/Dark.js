/*

  All code by @99TheDark unless noted. (See CREDITS.md)
  
  Minified with Toptal.

*/

"use strict";(()=>{if(window.Dark)return;var e=function(n=!1){if(!(this instanceof e))throw"Dark can only be called with the new operator";this.darkObject=!0;let a=this,i=a.constants=e.constants,r=a.objects=e.objects,s=a.settings={},o=performance.now(),l=performance.now(),c=-1,h=null,u=!1,f=null,d=null;e.instances.push(a);let g={};a.keys=new Proxy(g,{get:(e,t)=>e[t]??!1,set(){}}),[a.width,a.height]=[innerWidth,innerHeight],[a.dt,a.frameCount,a.fps]=[0,0,60],a.mouseX=a.mouseY=a.pmouseX=a.pmouseY=0,a.key=a.keyCode=a.mouseButton=void 0,a.mouseIsPressed=a.mouseIsInside=a.keyIsPressed=!1,a.mouse=r.DVector.zero2D(),a.pmouse=r.DVector.zero2D(),a.imageData=new ImageData(innerWidth,innerHeight),a.info={id:new r.DIdentification().id,initializationTime:performance.now(),version:e.version},a.transforms=[],a.saves=[],a.styles=[],a.vertices=[],a.vertexCache=[],a.imageCache={},a.cachedImageCount=0,a.successfullyCachedImageCount=0,a.loaded=!1,a.began=!1,a.clone=e.clone,a.format=e.format,a.noop=e.noop,a.randomGenerator=r.DRandom.create(),a.dummy=n,a.isMain=!1,a.canvas=new t(innerWidth,innerHeight),a.ctx=a.canvas.getContext("2d"),e.empties.forEach(e=>a[e]=()=>{});var m=function(e){return a.snap(s.angleMode==i.DEGREES?e*i.PI/180:e,0,i.TAU)},p=function(e){a.vertices.push(e),e.points.forEach(e=>a.vertexCache.push(r.DVector.create(e.x,e.y)))},$=function(e){if(0==e)return 1;let t=e;for(;--e>1;)t*=e;return t},v=function(){a.frameRate(60),a.smooth(),a.loop(),a.antialiasing(!0),a.disableContextMenu(),a.ellipseMode(i.CENTER),a.rectMode(i.CORNER),a.imageMode(i.CORNER),a.resizeMode(i.WIDTH),a.angleMode(i.DEGREES),a.strokeCap(i.ROUND),a.strokeJoin(i.MITER),a.textAlign(i.LEFT,i.BASELINE),a.curveTightness(2),a.fill(255),a.stroke(0),a.strokeWeight(1),a.textFont("12px Arial"),a.textLeading(5),a.preventDefault(i.KEY),a.allowDefault(i.CLICK),a.preventDefault(i.SCROLL)},_=function(e){for(let t in a.ctx){let n=e.ctx[t];if("canvas"!=t&&"function"!=typeof n)try{a.ctx[t]=n}catch{}}for(let i in s)s[i]=e.settings[i]},w=function(){a.canvas.addEventListener("click",function(t){s.clickEvents&&t.preventDefault(),e.globallyUpdateVariables(a),a.mouseClicked()}),a.canvas.addEventListener("mousedown",function(t){s.clickEvents&&t.preventDefault(),a.mouseIsPressed=!0,a.mouseButton=e.mouseMap[t.button],e.globallyUpdateVariables(a),a.mousePressed()}),a.canvas.addEventListener("mouseup",function(t){s.clickEvents&&t.preventDefault(),a.mouseButton=void 0,a.mouseIsPressed=!1,e.globallyUpdateVariables(a),a.mouseReleased()}),a.canvas.addEventListener("mouseenter",function(){a.mouseIsInside=!0,e.globallyUpdateVariables(a),a.mouseIn()}),a.canvas.addEventListener("mouseleave",function(){a.mouseIsInside=!1,e.globallyUpdateVariables(a),a.mouseOut()}),a.canvas.addEventListener("mousemove",function(t){let n=t.target.getBoundingClientRect();a.pmouseX=a.pmouse.x=a.mouseX,a.pmouseY=a.pmouse.y=a.mouseY,a.mouseX=a.mouse.x=a.constrain(a.round(t.pageX-n.x),0,a.width),a.mouseY=a.mouse.y=a.constrain(a.round(t.pageY-n.y),0,a.height),e.globallyUpdateVariables(a),a.mouseMoved(),a.mouseIsPressed&&a.mouseDragged()}),a.canvas.addEventListener("wheel",function(t){s.scrollEvents&&t.preventDefault(),h=performance.now(),a.mouseScroll=r.DVector.create(t.deltaX,t.deltaY,t.deltaZ),e.globallyUpdateVariables(a),a.mouseScrolled()}),a.canvas.addEventListener("dblclick",function(t){s.clickEvents&&t.preventDefault(),e.globallyUpdateVariables(a),a.mouseDoubleClicked()})},b=function(e){return`rgba(${a.red(e)}, ${a.green(e)}, ${a.blue(e)}, ${a.alpha(e)/255})`};!function(e){for(let t in e)Object.defineProperty(a,t,{value:e[t],writable:!1,configurable:!1,enumerable:!0})}({size:function(t=innerWidth,n=innerHeight){if("number"==typeof t&&"number"==typeof n&&t>0&&n>0){let i=a.clone(a.ctx);for(let s in[a.width,a.height]=[a.canvas.width,a.canvas.height]=[t,n],d=new r.DImage(a.width,a.height,a),a.ctx){let o=i[s];if("function"!=typeof o&&!e.styleIgnore.includes(s))try{a.ctx[s]=o}catch{}}e.globallyUpdateVariables(a)}},setCanvas:function(e){if(e instanceof HTMLCanvasElement){a.canvas=e,a.width=e.width,a.height=e.height;let t=a.clone(a.ctx);a.ctx=e.getContext("2d"),_({ctx:t,settings:{...s}}),a.canvas.style.cursor=s.cursor,a.canvas.tabIndex="1",w()}},getCanvas:function(){return a.canvas},getContext:function(){return a.ctx},exit:function(){a.isMain&&e.setMain(e.default),cancelAnimationFrame(f),e.instances.splice(e.instances.indexOf(a),1)},setTitle:function(e){document.title=e},disableKhanImagePreload:function(){e.changeable.khanImagePreload=!1},createGraphics:function(t,n,a){let i=new e(a);return i.size(t,n),i},dist:function(...e){let t,n;return e.length=6,t=e[2]-e[0],n=e[3]-e[1],a.sqrt(t*t+n*n+0)},intersect:function(e,t,n,a,i,r,s,o){if(e==i&&t==r||n==s&&a==o)return!0;let l=(a-t)/(n-e),c=(o-r)/(s-i);if(l==c)return!1;let[h,u]=e<n?[e,n]:[n,e],[f,d]=i<s?[i,s]:[s,i],g=(r-c*i-(t-l*e))/(l-c);return!!(h<g)&&!!(g<u)&&!!(g<f)&&!!(g<d)},gamma:function(e){return a.sqrt(i.TAU/e)*((e+1/(12*e+1/(10*e)))/E)**e},factorial:function(e){return Number.isInteger(e)?$(e):gamma(e+1)},choose:function(e,t){return $(e)/($(e-t)*$(t))},repeat:function(e,t){for(let n=0;n<e;n++)t(n)},random:function(...e){switch(e.length){default:return a.randomGenerator.next()*(e[1]-e[0])+e[0];case 0:return a.randomGenerator.next();case 1:return a.randomGenerator.next()*e[0]}},randomSeed:function(e){e!=a.randomGenerator.seed&&(a.randomGenerator=r.DRandom.create(e))},cursor:function(e="default"){s.cursor=e,a.canvas.style.cursor=e},noCursor:function(){s.cursor="none",a.canvas.style.cursor="none"},loop:function(){s.looping=!0},noLoop:function(){s.looping=!1},frameRate:function(e){s.frameStep=1e3/e},enableContextMenu:function(){s.contextMenu=!0,a.canvas.oncontextmenu=!0},disableContextMenu:function(){s.contextMenu=!1,a.canvas.oncontextmenu=!1},fullscreen:function(){a.canvas.requestFullscreen()},color:function(e,t,n,r){if(a.isArray(e))return color.apply(null,[...e]);let s=arguments.length;if(0==s)return -1;if(1==s||2==s){if(!(e<=255)||!(e>=0))return 2==s?e&i.ALPHA_MASK|t<<24:e;1==s?n=t=e:(r=t,t=e,n=e)}return r??=255,e=a.constrain(e,0,255),t=a.constrain(t,0,255),n=a.constrain(n,0,255),((r=a.constrain(r,0,255))<<24)+(e<<16)+(t<<8)+n},randomColor:function(){return color(255*a.randomGenerator.next(),255*a.randomGenerator.next(),255*a.randomGenerator.next())},red:e=>e>>16&255,green:e=>e>>8&255,blue:e=>255&e,alpha:e=>e>>24&255,lerpColor:function(e,t,n){return color(a.lerp(a.red(e),a.red(t),n),a.lerp(a.green(e),a.green(t),n),a.lerp(a.blue(e),a.blue(t),n),a.lerp(a.alpha(e),a.alpha(t),n))},fill:function(...e){let t=s.fill=a.color.apply(null,e);a.ctx.fillStyle=b(t)},noFill:function(){s.fill=0,a.ctx.fillStyle="rgba(0, 0, 0, 0)"},stroke:function(...e){let t=s.stroke=a.color.apply(null,e);a.ctx.strokeStyle=b(t)},noStroke:function(){s.stroke=0,a.ctx.strokeStyle="rgba(0, 0, 0, 0)"},background:function(...e){a.ctx.save(),a.ctx.resetTransform();let t=a.color.apply(null,e);a.ctx.fillStyle=b(t),a.ctx.clearRect(0,0,a.width,a.height),a.ctx.fillRect(0,0,a.width,a.height),a.ctx.restore()},clear:function(){a.ctx.save(),a.ctx.resetTransform(),a.ctx.clearRect(0,0,a.width,a.height),a.ctx.restore()},strokeCap:function(t){switch(t){default:e.error("Invalid strokeCap type");break;case i.FLAT:a.ctx.lineCap="butt",s.strokeCap=i.FLAT;break;case i.ROUND:a.ctx.lineCap="round",s.strokeCap=i.ROUND;break;case i.SQUARE:a.ctx.lineCap="square",s.strokeCap=i.SQUARE}},strokeJoin:function(t=i.MITER){switch(t){default:e.error("Invalid strokeJoin type");break;case i.MITER:a.ctx.lineJoin="miter",s.strokeJoin=i.MITER;break;case i.BEVEL:a.ctx.lineJoin="bevel",s.strokeJoin=i.BEVEL;break;case i.ROUND:a.ctx.lineJoin="round",s.strokeJoin=i.ROUND}},strokeWeight:function(e){s.smoothing||(e=a.round(e)),s.strokeWeight=e,a.ctx.lineWidth=e},smooth:function(){s.smoothing=!0,a.ctx.imageSmoothingQuality="high"},noSmooth:function(){s.smoothing=!0,a.ctx.imageSmoothingEnabled=!1,a.ctx.imageSmoothingQuality="low"},antialiasing:function(t){"boolean"==typeof t?(a.ctx.mozImageSmoothingEnabled=t,a.ctx.webkitImageSmoothingEnabled=t,a.ctx.msImageSmoothingEnabled=t,a.ctx.imageSmoothingEnabled=t):e.error("Antialiasing mode must be of boolean value")},preventDefault:function(t){switch(0==arguments.length&&e.error("No listener type given"),t){default:e.error("Invalid listener given");break;case i.KEY:s.keyEvents=!0;break;case i.CLICK:s.clickEvents=!0;break;case i.SCROLL:s.scrollEvents=!0}},allowDefault:function(t){switch(0==arguments.length&&e.error("No listener type given"),t){default:e.error("Invalid listener given");break;case i.KEY:s.keyEvents=!1;break;case i.CLICK:s.clickEvents=!1;break;case i.SCROLL:s.scrollEvents=!1}},angleMode:function(t){switch(t){default:e.error("Invalid angleMode");break;case i.DEGREES:s.angleMode=i.DEGREES;break;case i.RADIANS:s.angleMode=i.RADIANS}},ellipseMode:function(t=i.CENTER){switch(t){default:e.error("Invalid ellipseMode");break;case i.CENTER:s.ellipseMode=i.CENTER;break;case i.CORNER:s.ellipseMode=i.CORNER;break;case i.RADIUS:s.ellipseMode=i.RADIUS}},rectMode:function(t=i.CORNER){switch(t){default:e.error("Invalid rectMode");break;case i.CORNER:s.rectMode=i.CORNER;break;case i.CENTER:s.rectMode=i.CENTER}},imageMode:function(t=i.CORNER){switch(t){default:e.error("Invalid imageMode");break;case i.CORNER:s.imageMode=i.CORNER;break;case i.CENTER:s.imageMode=i.CENTER}},resizeMode:function(t=i.WIDTH){switch(t){default:e.error("Invalid resizeMode");break;case i.WIDTH:s.resizeMode=i.WIDTH;break;case i.HEIGHT:s.resizeMode=i.HEIGHT}},curveTightness:function(e=0){s.curveTightness=e,s.curveMatrixTightness=(e-1)/6},pushMatrix:function(){a.transforms.length>a.maxStackSize?e.error(`Maximum matrix stack size reached, pushMatrix() called ${a.maxStackSize} times.`):a.transforms.push(a.ctx.getTransform())},popMatrix:function(){let t=a.transforms.pop();t?a.ctx.setTransform(t):e.error("No more transforms to restore in popMatrix()")},resetMatrix:function(){a.transforms.length=0,a.ctx.resetTransform()},getDOMMatrix:function(){return a.ctx.getTransform()},getMatrix:function(){return r.DMatrix.fromDOMMatrix(a.ctx.getTransform())},setMatrix:function(e){a.ctx.setTransform(new r.DMatrix(e.toDOMMatrix()))},printMatrix:function(){console.log(a.getMatrix().toString())},pushStyle:function(){a.styles.length>a.maxStackSize?e.error(`Maximum style stack size reached, pushStyle() called ${a.maxStackSize} times.`):a.styles.push({ctx:a.clone(a.ctx),settings:a.clone(s)})},popStyle:function(){let t=a.styles.pop();t?_(t):e.error("No more styles to restore in popStyle()")},resetStyle:function(){a.styles.length=0,v()},push:function(){a.transforms.length>a.maxStackSize?e.error(`Maximum stack size reached, push() called ${a.maxStackSize} times.`):(a.ctx.save(),a.saves.push(Object.assign({},s)))},pop:function(){let t=a.saves.pop();t?(a.ctx.restore(),Object.assign(s,t)):e.error("No more saves to restore in pop()")},reset:function(){a.saves.length=0,s={...a.defaultSettings},a.setCanvas(a.canvas)},translate:function(e,t){a.ctx.translate(e,t)},rotate:function(e){a.ctx.rotate(m(e))},scale:function(e,t=e){a.ctx.scale(e,t)},skew:function(e,t=0){let n=a.ctx.getTransform();n.skewYSelf(.01*e),n.skewXSelf(.01*t),a.ctx.setTransform(n)},rect:function(t,n,r,o,l,c,h,u){switch(s.smoothing||([t,n,r,o]=[a.round(t),a.round(n),a.round(r),a.round(o)]),[r,o]=[a.abs(r),a.abs(o)],a.ctx.beginPath(),a.ctx.save(),s.rectMode==i.CENTER&&a.ctx.translate(-r/2,-o/2),arguments.length){default:e.error("rect takes in 4, 5 or 8 parameters, not "+arguments.length);break;case 4:a.ctx.rect(t,n,r,o);break;case 5:a.ctx.roundRect(t,n,r,o,l);break;case 8:a.ctx.roundRect(t,n,r,o,[l,c,h,u])}a.ctx.fill(),a.ctx.stroke(),a.ctx.restore()},ellipse:function(e,t,n,r){s.ellipseMode==i.RADIUS&&(n/=2,r/=2),s.smoothing||([e,t,n,r]=[a.round(e),a.round(t),a.round(n),a.round(r)]),[n,r]=[a.abs(n),a.abs(r)],a.ctx.beginPath(),a.ctx.save(),s.ellipseMode==i.CORNER&&a.ctx.translate(n/2,r/2),a.ctx.beginPath(),a.ctx.ellipse(e,t,n/2,r/2,0,0,i.TAU,!1),a.ctx.fill(),a.ctx.stroke(),a.ctx.restore()},arc:function(e,t,n,r,o,l){s.ellipseMode==i.RADIUS&&(n/=2,r/=2),s.smoothing||([e,t,n,r]=[a.round(e),a.round(t),a.round(n),a.round(r)]),a.ctx.save(),s.ellipseMode==i.CORNER&&a.ctx.translate(n/2,r/2),a.ctx.beginPath(),a.ctx.moveTo(e,t),a.ctx.ellipse(e,t,n/2,r/2,0,m(o),m(l),!1),a.ctx.fill(),a.ctx.beginPath(),a.ctx.ellipse(e,t,n/2,r/2,0,m(o),m(l),!1),a.ctx.stroke(),a.ctx.restore()},line:function(e,t,n,i){s.smoothing||([e,t,n,i]=[a.round(e),a.round(t),a.round(n),a.round(i)]),a.ctx.beginPath(),a.ctx.moveTo(e,t),a.ctx.lineTo(n,i),a.ctx.stroke()},point:function(e,t){s.smoothing||(e=a.round(e),t=a.round(t)),a.ctx.save(),a.ctx.beginPath(),a.ctx.fillStyle=b(s.stroke),a.ctx.arc(e,t,s.strokeWeight/2,0,i.TAU),a.ctx.fill(),a.ctx.restore()},circle:function(e,t,n){s.smoothing||([e,t,n]=[a.round(e),a.round(t),a.round(n)]),n=a.round(n),a.ctx.save(),s.ellipseMode==i.CORNER&&a.ctx.translate(n,n),a.ctx.beginPath(),a.ctx.arc(e,t,n,0,i.TAU),a.ctx.fill(),a.ctx.stroke(),a.ctx.restore()},square:function(...e){e.splice(3,0,e[2]),rect.apply(null,e)},triangle:function(e,t,n,i,r,o){s.smoothing||([e,t,n,i,r,o]=[a.round(e),a.round(t),a.round(n),a.round(i),a.round(r),a.round(o)]),a.ctx.beginPath(),a.ctx.moveTo(e,t),a.ctx.lineTo(n,i),a.ctx.lineTo(r,o),a.ctx.closePath(),a.ctx.fill(),a.ctx.stroke()},quad:function(e,t,n,i,r,o,l,c){s.smoothing||([e,t,n,i,r,o,l,c]=[a.round(e),a.round(t),a.round(n),a.round(i),a.round(r),a.round(o),a.round(l),a.round(c)]),a.ctx.beginPath(),a.ctx.moveTo(e,t),a.ctx.lineTo(n,i),a.ctx.lineTo(r,o),a.ctx.lineTo(l,c),a.ctx.closePath(),a.ctx.fill(),a.ctx.stroke()},beginShape:function(){u?e.error("Cannot begin a new shape before the previous shape has ended"):(a.vertices.length=0,a.vertexCache.length=0,u=!0)},endShape:function(e=i.OPEN){a.vertices.length<2||a.vertices[0].type==i.BEZIER||(a.ctx.beginPath(),a.vertices.forEach(function(e,t){if(0==t)a.ctx.moveTo(e.points[0].x,e.points[0].y);else switch(e.type){case i.VERTEX:let n=e.points[0];a.ctx.lineTo(n.x,n.y);break;case i.CURVE:let r=s.curveMatrixTightness,o=a.vertexCache[t-3],l=a.vertexCache[t-2],c=a.vertexCache[t-1],h=a.vertexCache[t];if(2==t)break;0==t?a.ctx.moveTo(h.x,h.y):t<3?a.ctx.lineTo(h.x,h.y):(3==t&&a.ctx.lineTo(l.x,l.y),a.ctx.bezierCurveTo(c.x*r+l.x-o.x*r,c.y*r+l.y-o.y*r,-(h.x*r)+c.x+l.x*r,-(h.y*r)+c.y+l.y*r,c.x,c.y));break;case i.BEZIER:let u=e.points;a.ctx.bezierCurveTo(u[0].x,u[0].y,u[1].x,u[1].y,u[2].x,u[2].y)}}),e==i.CLOSE&&a.ctx.closePath(),a.ctx.fill(),a.ctx.stroke(),u=!1)},vertex:function(e,t){s.smoothing||([e,t]=[a.round(e),a.round(t)]);p({type:i.VERTEX,points:[{x:e,y:t}]})},curveVertex:function(e,t){s.smoothing||([x,y]=[a.round(e),a.round(t)]);p({type:i.CURVE,points:[{x:e,y:t}]})},bezierVertex:function(e,t,n,r,o,l){s.smoothing||([e,t,n,r,o,l]=[a.round(e),a.round(t),a.round(n),a.round(r),a.round(o),a.round(l)]);p({type:i.BEZIER,points:[{x:e,y:t},{x:n,y:r},{x:o,y:l}]})},bezier:function(e,t,n,a,i,r,s,o){beginShape(),vertex(e,t),bezierVertex(n,a,i,r,s,o),endShape()},curve:function(e,t,n,a,i,r,s,o){beginShape(),vertex(e,t),vertex(n,a),vertex(i,r),curveVertex(s,o),endShape()},bezierPoint:function(e,t,n,a,i){let r=1-i;return r*r*r*e+3*r*r*i*t+3*r*i*i*n+i*i*i*a},curvePoint:function(e,t,n,a,i){return .5*(2*t+(n-e)*i+(2*e-5*t+4*n-a)*i*i+(3*t-3*n+a-e)*i*i*i)},curveTangent:function(e,t,n,a,i){return .5*(n-e+2*(2*e-5*t+4*n-a)*i+3*(3*t-3*n+a-e)*i*i)},bezierTangent:function(e,t,n,a,i){let r=1-i;return 3*r*r*(t-e)+6*r*i*(n-t)+3*i*i*(a-n)},reloadFont:function(){a.ctx.font=s.font.toString(),s.genericTextMeasure=a.ctx.measureText("0"),s.textHeight=s.genericTextMeasure.fontBoundingBoxAscent+s.genericTextMeasure.fontBoundingBoxDescent},textSize:function(e){s.smoothing||(e=a.round(e)),s.textSize=e,s.font.size=e,a.reloadFont()},textAlign:function(t,n){switch(0==arguments.length&&(t=i.LEFT,n=i.BASELINE),1==arguments.length&&t==i.CENTER&&(n=i.CENTER),t){default:e.error("Invalid x alignment type");break;case i.LEFT:a.ctx.textAlign="left",s.alignX=i.LEFT;break;case i.RIGHT:a.ctx.textAlign="right",s.alignX=i.RIGHT;break;case i.CENTER:a.ctx.textAlign="center",s.alignX=i.CENTER}switch(n){default:e.error("Invalid y alignment type");break;case i.BASELINE:a.ctx.textBaseline="alphabetic",s.alignY=i.BASELINE;break;case i.TOP:a.ctx.textBaseline="top",s.alignY=i.TOP;break;case i.BOTTOM:a.ctx.textBaseline="bottom",s.alignY=i.BOTTOM;break;case i.CENTER:a.ctx.textBaseline="middle",s.alignY=i.CENTER}},textFont:function(t){"string"==typeof t&&(t=new r.DFont(t)),t instanceof r.DFont?(s.font=t,s.textSize=t.size,a.reloadFont()):e.error(`${t} is not a DFont.`)},createFont:function(e){return r.DFont.parse(e)},textStyle:function(e){switch(e){default:s.font.weight="normal",s.font.style="normal";break;case i.BOLD:s.font.weight="bold";break;case i.ITALIC:s.font.style="italic"}a.reloadFont()},textWidth:function(e){return a.ctx.measureText(e).width},textAscent:function(){return s.genericTextMeasure.fontBoundingBoxAscent},textDescent:function(){return s.genericTextMeasure.fontBoundingBoxDescent},textLeading:function(e){s.lineGap=e},text:function(e,t,n,r=1/0,o=1/0){s.smoothing||([t,n]=[a.round(t),a.round(n)]);let l=[],c=e.replaceAll("\n"," \n ").split(" "),h=0,u="",f=a.ctx.measureText(" ").width;c.every(e=>{if("\n"==e)return l.push(u),h=0,u="",!0;let t=a.ctx.measureText(e).width;if(t>r){let n=e.split(""),i=h,s=[0];n.forEach((e,t)=>{let n=a.ctx.measureText(e).width;(i+=n)>r&&(s.push(t),i=n)}),s.push(e.length);let o=[];for(let c=1;c<s.length;c++)o.push(e.substring(s[c-1],s[c]));return u=o.pop()+" ",h=a.ctx.measureText(u).width,o.forEach(e=>l.push(e)),!0}return(h+=t)>r&&(l.push(u.slice(0,-1)),u="",h=t),u+=e+" ",h+=f,!0}),l.push(u),0==l[0].length&&l.shift();let d=0;switch(s.alignY){case i.CENTER:d=(s.textHeight+s.lineGap)/2*(l.length-1);break;case i.BOTTOM:d=(s.textHeight+s.lineGap)*(l.length-1)}let g=0;l.every(e=>{if(g+s.textHeight>o)return!1;let i=g-d;return a.ctx.fillText(e,t,n+i),a.ctx.strokeText(e,t,n+i),g+=s.textHeight+s.lineGap,!0})},get:function(...t){switch(t.length){default:return e.error("get requires 0 or 4 parameters, not "+t.length);case 0:return new r.DImage(a.canvas,a);case 2:return a.color(a.ctx.getImageData(t[0],t[1],1,1).data);case 3:if(s.resizeMode==i.HEIGHT)return a.get(t[0],t[1],t[2]/a.height*a.width,t[2]);return a.get(t[0],t[1],t[2],t[2]/a.width*a.height);case 4:return new r.DImage(a.ctx.getImageData(t[0],t[1],t[2],t[3]),a)}},set:function(e,t,...n){a.ctx.save(),a.ctx.fillStyle=b(a.color.apply(null,n)),a.ctx.fillRect(e,t,1,1),a.ctx.restore()},loadPixels:function(){a.imageData=a.ctx.getImageData(0,0,a.width,a.height)},updatePixels:function(){a.ctx.putImageData(a.imageData,0,0,a.width,a.height)},image:function(t,n,o,l,c){t.checkLoad(),[l,c]=[a.abs(l),a.abs(c)],a.ctx.save(),t instanceof ImageData&&(t=new r.DImage(t,a)),t instanceof e&&(t=new r.DImage(t.canvas,t).copy());let h,u;switch(arguments.length){default:return a.ctx.restore(),e.error("image requires 1, 3, 4 or 5 parameters, not "+arguments.length);case 1:[n,o,h,u]=[0,0,a.width,a.height];break;case 3:[h,u]=[t.width,t.height];break;case 4:s.resizeMode==i.HEIGHT?[h,u]=[l/t.height*t.width,l]:[h,u]=[l,l/t.width*t.height];break;case 5:[h,u]=[l,c]}s.imageMode==i.CENTER&&a.ctx.translate(-h/2,-u/2),s.smoothing||([n,o,l,c]=[a.round(n),a.round(o),a.round(l),a.round(c)]),a.ctx.drawImage(t.getRenderable(),0,0,t.width,t.height,n,o,h,u),a.ctx.restore()},loadImage:function(t){if(Object.keys(a.imageCache).includes(t)&&a.began)return a.imageCache[t];a.imageCache[t]=null,a.cachedImageCount++;let n=new r.DImage(1,1,a);return n.loadComplete=!1,n.loadedFromSource=!0,n.sent=!0,e.khan?(n.image=new Image,n.image.src=t,n.image.crossOrigin="anonymous",n.image.onload=()=>{a.imageCache[t]=n,a.successfullyCachedImageCount++,[n.canvas.width,n.canvas.height]=[n.width,n.height]=[n.image.width,n.image.height],n.imageData=new ImageData(n.width,n.height),n.ctx.drawImage(n.image,0,0,n.width,n.height,0,0,n.width,n.height),n.updatePixels(),n.sourceURL=t,n.loadComplete=!0,a.successfullyCachedImageCount==Object.keys(a.imageCache).length&&a.begin()}):Promise.all([new Promise((e,a)=>{n.image=new Image,n.image.src=t,n.image.crossOrigin="anonymous",n.image.onload=()=>{n.imageLoaded=!0,e()},n.image.onerror=a}),new Promise((e,a)=>{fetch(t).then(e=>e.blob()).then(t=>createImageBitmap(t).then(t=>{n.bitmap=t,n.bitmapLoaded=!0,e()})).catch(e=>a(e))})]).then(()=>{n.loaded=!0,n.sent=!1,n.loadComplete=!0,n.sourceURL=t,a.imageCache[t]=n,a.successfullyCachedImageCount++,[n.canvas.width,n.canvas.height]=[n.width,n.height]=[n.image.width,n.image.height],n.imageData=new ImageData(n.width,n.height),n.ctx.drawImage(n.getRenderable(),0,0,n.width,n.height,0,0,n.width,n.height),n.updatePixels(),a.successfullyCachedImageCount==Object.keys(a.imageCache).length&&a.begin()}).catch(t=>e.error(t)),n},getImage:function(t){if(!e.khan)return a.loadImage("/"+t);{let n=`https://cdn.kastatic.org/third_party/javascript-khansrc/live-editor/build/images/${t}.png`;if(Object.keys(a.imageCache).includes(n)&&a.began)return a.imageCache[n].copy();let i=new r.DImage(1,1,a);return a.imageCache[n]=null,a.cachedImageCount++,i.image=new Image,i.image.src=n,i.image.crossOrigin="anonymous",i.image.onload=()=>{a.imageCache[n]=i,a.successfullyCachedImageCount++,[i.canvas.width,i.canvas.height]=[i.width,i.height]=[i.image.width,i.image.height],i.imageData=new ImageData(i.width,i.height),i.ctx.drawImage(i.image,0,0,i.width,i.height,0,0,i.width,i.height),i.updatePixels(),a.successfullyCachedImageCount==Object.keys(a.imageCache).length&&a.begin()},i}},filter:function(e,t){d.ctx.drawImage(a.canvas,0,0,a.width,a.height,0,0,a.width,a.height),d.filter(e,t),a.ctx.putImageData(d.imageData,0,0)},min:(e,t)=>e<t?e:t,max:(e,t)=>e>t?e:t,log10:e=>Math.log10(e),log2:e=>Math.log2(e),log:e=>Math.log(e),logBase:(e,t)=>Math.log(e)/Math.log(t),mag:(e,t)=>Math.sqrt(e*e+t*t),norm:(e,t,n)=>(e-t)/(n-t),constrain:(e,t,n)=>Math.min(Math.max(e,t),n),between:(e,t,n)=>e<=n&&e>=t,exceeds:(e,t,n)=>e>n||e<t,lerp:(e,t,n)=>(t-e)*n+e,map:(e,t,n,a,i)=>a+(i-a)/(n-t)*(e-t),sq:e=>e*e,cb:e=>e*e*e,pow:(e,t)=>e**t,root:(e,t)=>e**(1/t),sqrt:e=>Math.sqrt(e),cbrt:e=>Math.cbrt(e),exp:e=>E**e,floor:e=>Math.floor(e),round:e=>Math.round(e),ceil:e=>Math.ceil(e),trunc:e=>Math.trunc(e),deci:e=>e-Math.trunc(e),abs:e=>e<0?-e:e,sign:e=>Math.sign(e),bsign:e=>e<0?-1:1,degrees:e=>180*e/i.PI,radians:e=>e*i.PI/180,millennium:()=>Math.floor(new Date().getFullYear()/1e3),century:()=>Math.floor(new Date().getFullYear()/100),decade:()=>Math.floor(new Date().getFullYear()/10),year:()=>new Date().getFullYear(),month:()=>new Date().getMonth(),day:()=>new Date().getDate(),hour:()=>new Date().getHours(),minute:()=>new Date().getMinutes(),second:()=>new Date().getSeconds(),millis:()=>Math.floor(performance.now()),micro:()=>Math.floor(1e3*performance.now()%1e3),nano:()=>Math.floor(1e6*performance.now()%1e3),today:()=>DAYS[new Date().getDay()],timezone:()=>-new Date().getTimezoneOffset()/60,sin:e=>Math.sin(m(e)),cos:e=>Math.cos(m(e)),tan:e=>Math.tan(m(e)),csc:e=>1/Math.sin(m(e)),sec:e=>1/Math.cos(m(e)),cot:e=>1/Math.tan(m(e)),atan2(e,t){var n;return n=Math.atan2(e,t),a.snap(s.angleMode==i.DEGREES?180*n/i.PI:n,0,360)},asin:e=>Math.asin(m(e)),acos:e=>Math.acos(m(e)),atan:e=>Math.atan(m(e)),acsc:e=>Math.asin(1/m(e)),asec:e=>Math.acos(1/m(e)),acot:e=>Math.atan(1/m(e)),sinh:e=>Math.sinh(m(e)),cosh:e=>Math.cosh(m(e)),tanh:e=>Math.tanh(m(e)),csch:e=>1/Math.sinh(m(e)),sech:e=>1/Math.cosh(m(e)),coth:e=>1/Math.tanh(m(e)),asinh:e=>Math.asinh(m(e)),acosh:e=>Math.acosh(m(e)),atanh:e=>Math.atanh(m(e)),acsch:e=>Math.asinh(1/m(e)),asech:e=>Math.acosh(1/m(e)),acoth:e=>Math.atanh(1/m(e)),now:()=>performance.now(),reciprocal:e=>1/e,trim:e=>e.trim(),mod:(e,t)=>(e%t+t)%t,snap:(e,t,n)=>(e-t)%(n-t)+t,percent:e=>e/100,translateX:e=>a.translate(e,0),translateY:e=>a.translate(0,e),scaleX:e=>a.scale(e,1),scaleY:e=>a.scale(1,e),skewX:e=>a.skew(e,0),skewY:e=>a.skew(0,e),split:(e,t)=>e.split(t),concat:(e,t)=>e.concat(t),join:(e,t=", ")=>e.join(t),append:(e,t)=>(e.push(t),e),reverse:e=>e.reverse(),expand:(e,t)=>Array(t??2*e.length).fill().map((t,n)=>e[n]),shorten:e=>a.expand(e,e.length-1),match:(e,t)=>e.match(t),matchAll:(e,t)=>[...e.matchAll(t)].map(e=>e.index),nf:(e,t,n)=>(e+".").padStart(t+1,"0")+(String(e).split(".")[1]??"").padEnd(n<=0?1:n,"0"),mix:(e,t,n)=>e+((t-e)*n>>8),link:(e,t)=>open(e,t??"_blank"),isArray:e=>Array.isArray(e)||ArrayBuffer.isView(e),cutoff:(e,t=20)=>e.length>t?`${e.substring(0,t)}...`:e}),a.raf=function(t){if(e.startTime>a.info.initializationTime){e.warn("Deleting old Dark.js instance."),a.exit();return}let n=(t=performance.now())-o,i=t-l;l=performance.now(),null!=h&&l-h>16&&(h=null,a.mouseScroll.zero3D());let r=n>s.frameStep-i/2&&s.looping;c<t&&c>l&&(n=i=t-c),r&&(o=t,a.draw(),a.dt=n/1e3,a.fps=1e3/n,a.frameCount=++a.frameCount),e.globallyUpdateVariables(a),f=requestAnimationFrame(a.raf)},a.begin=function(){a.loaded&&!a.began&&(a.began=!0,a.setup(),f=requestAnimationFrame(a.raf))},v(),a.defaultSettings=Object.assign({},s),a.dummy||(document.addEventListener("keydown",function(t){e.focus.target===a.canvas&&(s.keyEvents&&t.preventDefault(),a.keyIsPressed=!0,a.key=(e.special[t.keyCode]??t.key).toLowerCase(),a.keyCode=t.keyCode,/\w/.test(String.fromCharCode(t.keyCode))&&a.keyTyped(),g[a.key]=!0,e.globallyUpdateVariables(a),a.keyPressed())}),document.addEventListener("keyup",function(t){e.focus.target===a.canvas&&(s.keyEvents&&t.preventDefault(),a.key=(e.special[t.keyCode]??t.key).toLowerCase(),a.keyCode=t.keyCode,g[a.key]=!1,a.keyIsPressed=!1,e.globallyUpdateVariables(a),a.keyReleased(),a.key=void 0,a.keyCode=void 0,e.globallyUpdateVariables(a))}),addEventListener("resize",function(){e.globallyUpdateVariables(a),a.pageResized()}),document.addEventListener("visibilitychange",function(){"hidden"==document.visibilityState&&(a.keyIsPressed=!1,a.key=void 0,a.keyCode=void 0,a.mouseIsPressed=!1,a.mouseButton=void 0,a.mouseIsInside=!1,c=performance.now())}),a.mouseScroll=r.DVector.zero3D(),s.cursor="auto",s.looping=!0,e.khan&&e.changeable.khanImagePreload&&e.imageLocationsKA.forEach(e=>a.getImage(e)),addEventListener("load",()=>{a.loaded=!0,e.globallyUpdateVariables(a),a.preload(),a.began||a.successfullyCachedImageCount!=a.cachedImageCount||a.begin()}))};e.darkObject=!0,e.instances=[],e.version="pre-0.7.8.6",e.empties=["draw","setup","preload","keyPressed","keyReleased","keyTyped","mouseClicked","mousePressed","mouseReleased","mouseMoved","mouseScrolled","mouseIn","mouseOut","mouseDoubleClicked","mouseDragged","pageResized"],e.editable=e.empties.concat(["imageData"]),e.constants={DAYS:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],PI:Math.PI,HALF_PI:Math.PI/2,QUARTER_PI:Math.PI/4,E:Math.E,PHI:(1+Math.sqrt(5))/2,TAU:2*Math.PI,EPSILON:Number.EPSILON,RED_MASK:4278255615,GREEN_MASK:4294902015,BLUE_MASK:4294967040,ALPHA_MASK:16777215,ROUND:0,FLAT:1,DEGREES:2,RADIANS:3,VERTEX:4,CURVE:5,BEZIER:6,CLOSE:7,OPEN:8,CENTER:9,CORNER:10,WIDTH:11,HEIGHT:12,NORMAL:13,BOLD:14,ITALIC:15,BEVEL:16,MITER:17,SQUARE:18,LEFT:19,RIGHT:20,TOP:21,BOTTOM:22,BASELINE:23,GET:24,SET:25,RADIUS:26,KEY:27,CLICK:28,SCROLL:29,LINEAR:30,RADIAL:31,CONIC:32,RGB:33,RGBA:33,SRGB:33,HSB:34,HSV:34,HSL:35,HEX:36,CMYK:37,CMY:37,PERLIN:50,SIMPLEX:51,WORLEY:52,VALUE:53,RANDOM:54,INVERT:55,OPAQUE:56,GRAY:57,ERODE:58,DILATE:59,THRESHOLD:60,POSTERIZE:61,BLUR:62,SHARPEN:63,SEPIA:64,OUTLINE:65,SWIRL:66,EDGE:67,CONTRAST:68,VIGNETTE:69,BRIGHTNESS:70,BLACK:71,WHITE:72,NORMALIZE:73,BOX:74,TRANSPARENCY:75,PIXELATE:76,FISHEYE:77,EMBOSS:78,SOBEL:79},e.filters=[e.constants.INVERT,e.constants.OPAQUE,e.constants.GRAY,e.constants.ERODE,e.constants.DILATE,e.constants.THRESHOLD,e.constants.POSTERIZE,e.constants.BLUR,e.constants.SHARPEN,e.constants.SEPIA,e.constants.OUTLINE,e.constants.SWIRL,e.constants.EDGE,e.constants.CONTRAST,e.constants.VIGNETTE,e.constants.BRIGHTNESS,e.constants.BLACK,e.constants.WHITE,e.constants.NORMALIZE,e.constants.BOX,e.constants.TRANSPARENCY,e.constants.PIXELATE,e.constants.FISHEYE,e.constants.EMBOSS,e.constants.SOBEL],e.special={16:"shift",13:"enter",8:"delete",9:"tab",27:"escape",32:"space",18:"option",17:"control",91:"left_meta",93:"right_meta",38:"up",40:"down",37:"left",39:"right",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",20:"capslock",190:"period",188:"comma",191:"slash",192:"backtick",220:"backslash",48:"zero",49:"one",50:"two",51:"three",52:"four",53:"five",54:"six",55:"seven",56:"eight",57:"nine",189:"minus",187:"equals",219:"left_bracket",221:"right_bracket",222:"single_quote",186:"semicolon"},e.cursors=["auto","default","none","context-menu","help","pointer","progress","wait","cell","crosshair","text","vertical-text","alias","copy","move","no-drop","not-allowed","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out"],e.imageLocationsKA=["avatars/aqualine-sapling","avatars/aqualine-seed","avatars/aqualine-seedling","avatars/aqualine-tree","avatars/aqualine-ultimate","avatars/avatar-team","avatars/duskpin-sapling","avatars/duskpin-seed","avatars/duskpin-seedling","avatars/duskpin-tree","avatars/duskpin-ultimate","avatars/leaf-blue","avatars/leaf-green","avatars/leaf-grey","avatars/leaf-orange","avatars/leaf-red","avatars/leaf-yellow","avatars/leafers-sapling","avatars/leafers-seed","avatars/leafers-seedling","avatars/leafers-tree","avatars/leafers-ultimate","avatars/marcimus","avatars/marcimus-orange","avatars/marcimus-purple","avatars/marcimus-red","avatars/mr-pants","avatars/mr-pants-green","avatars/mr-pants-orange","avatars/mr-pants-pink","avatars/mr-pants-purple","avatars/mr-pants-with-hat","avatars/mr-pink","avatars/mr-pink-green","avatars/mr-pink-orange","avatars/old-spice-man","avatars/old-spice-man-blue","avatars/orange-juice-squid","avatars/piceratops-sapling","avatars/piceratops-seed","avatars/piceratops-seedling","avatars/piceratops-tree","avatars/piceratops-ultimate","avatars/primosaur-sapling","avatars/primosaur-seed","avatars/primosaur-seedling","avatars/primosaur-tree","avatars/primosaur-ultimate","avatars/purple-pi","avatars/purple-pi-pink","avatars/purple-pi-teal","avatars/questionmark","avatars/robot_female_1","avatars/robot_female_2","avatars/robot_female_3","avatars/robot_male_1","avatars/robot_male_2","avatars/robot_male_3","avatars/spunky-sam","avatars/spunky-sam-green","avatars/spunky-sam-orange","avatars/spunky-sam-red","avatars/starky-sapling","avatars/starky-seed","avatars/starky-seedling","avatars/starky-tree","avatars/starky-ultimate","creatures/Hopper-Happy","creatures/Hopper-Cool","creatures/Hopper-Jumping","creatures/OhNoes","creatures/OhNoes-Hmm","creatures/OhNoes-Happy","creatures/BabyWinston","creatures/Winston","cute/Blank","cute/BrownBlock","cute/CharacterBoy","cute/CharacterCatGirl","cute/CharacterHornGirl","cute/CharacterPinkGirl","cute/CharacterPrincessGirl","cute/ChestClosed","cute/ChestLid","cute/ChestOpen","cute/DirtBlock","cute/DoorTallClosed","cute/DoorTallOpen","cute/EnemyBug","cute/GemBlue","cute/GemGreen","cute/GemOrange","cute/GrassBlock","cute/Heart","cute/Key","cute/PlainBlock","cute/RampEast","cute/RampNorth","cute/RampSouth","cute/RampWest","cute/Rock","cute/RoofEast","cute/RoofNorth","cute/RoofNorthEast","cute/RoofNorthWest","cute/RoofSouth","cute/RoofSouthEast","cute/RoofSouthWest","cute/RoofWest","cute/Selector","cute/ShadowEast","cute/ShadowNorth","cute/ShadowNorthEast","cute/ShadowNorthWest","cute/ShadowSideWest","cute/ShadowSouth","cute/ShadowSouthEast","cute/ShadowSouthWest","cute/ShadowWest","cute/Star","cute/StoneBlock","cute/StoneBlockTall","cute/TreeShort","cute/TreeTall","cute/TreeUgly","cute/WallBlock","cute/WallBlockTall","cute/WaterBlock","cute/WindowTall","cute/WoodBlock","space/background","space/beetleship","space/collisioncircle","space/girl1","space/girl2","space/girl3","space/girl4","space/girl5","space/healthheart","space/minus","space/octopus","space/planet","space/plus","space/rocketship","space/star","space/0","space/1","space/2","space/3","space/4","space/5","space/6","space/7","space/8","space/9","animals/birds_rainbow-lorakeets","animals/butterfly","animals/butterfly_monarch","animals/cat","animals/cheetah","animals/crocodiles","animals/dog_sleeping-puppy","animals/dogs_collies","animals/fox","animals/horse","animals/kangaroos","animals/komodo-dragon","animals/penguins","animals/rabbit","animals/retriever","animals/shark","animals/snake_green-tree-boa","animals/spider","landscapes/beach-at-dusk","landscapes/beach-in-hawaii","landscapes/beach-sunset","landscapes/beach-waves-at-sunset","landscapes/beach-waves-daytime","landscapes/beach-with-palm-trees","landscapes/beach","landscapes/clouds-from-plane","landscapes/crop-circle","landscapes/fields-of-grain","landscapes/fields-of-wine","landscapes/lake","landscapes/lava","landscapes/lotus-garden","landscapes/mountain_matterhorn","landscapes/mountains-and-lake","landscapes/mountains-in-hawaii","landscapes/mountains-sunset","landscapes/sand-dunes","landscapes/waterfall_niagara-falls","food/bananas","food/berries","food/broccoli","food/brussels-sprouts","food/cake","food/chocolates","food/coffee-beans","food/croissant","food/dumplings","food/fish_grilled-snapper","food/fruits","food/grapes","food/hamburger","food/ice-cream","food/mushroom","food/oysters","food/pasta","food/potato-chips","food/potatoes","food/shish-kebab","food/strawberries","food/sushi","food/tomatoes","seasonal/father-winston","seasonal/fireworks-2015","seasonal/fireworks-in-sky","seasonal/fireworks-over-harbor","seasonal/fireworks-scattered","seasonal/gingerbread-family","seasonal/gingerbread-house","seasonal/gingerbread-houses","seasonal/gingerbread-man","seasonal/hannukah-dreidel","seasonal/hannukah-menorah","seasonal/hopper-elfer","seasonal/hopper-partying","seasonal/hopper-reindeer","seasonal/house-with-lights","seasonal/reindeer","seasonal/snow-crystal1","seasonal/snow-crystal2","seasonal/snow-crystal3","seasonal/snownoes","seasonal/snowy-slope-with-trees"],e.ignoreGlobal=["darkObject","info","empties","raf","begin","vertices","transforms","styles","saves","vertexCache","imageCache","cachedImageCount","successfullyCachedImageCount","settings","constants","objects","defaultSettings","isMain","canvas","ctx","dummy","loaded","began","randomGenerator","name"],e.singleDefinitions=["constants","objects"],e.styleIgnore=["canvas","width","height"],e.mouseMap=["left","middle","right","back","forward"],e.changeable={},e.cache={},e.changeable.errorCount=0,e.changeable.khanImagePreload=!0,e.maxErrorCount=50,e.maxStackSize=500,e.maxSearchDepth=10,e.url=new URL(location.href),e.khan="www.kasandbox.org"==e.url.host,e.editor="127.0.0.1:4444"==e.url.host,e.setDeep=function(e,t,n){let a=t.pop(),i=e;return t.forEach(e=>i=i[e]),i[a]=n,e},e.getDeep=function(e,t){let n=e;return t.forEach(e=>n=n[e]),n},e.clone=function(t,a=0,i=[],r=[]){if(0==a&&(e.clone.paths=[]),a>e.maxSearchDepth||"object"!=typeof t&&"function"!=typeof t)return t;{(r=[...r]).push(t);let s={};for(let o in t){let l=t[o],c=i.concat(o);if(r.includes(l))e.clone.paths.push({path:c,point:r.slice(0,r.indexOf(l))});else if(n.isArray(l)){let h=e.clone(l,a+1,c,r);h.length=Object.keys(h).length,s[o]=Array.from(h)}else if("object"==typeof l&&null!=l&&"{ [native code] }"!=l.constructor.toString().slice(l.constructor.name.length+12)){if(l.constructor===Object)s[o]=e.clone(l,a+1,c,r);else{let u=Object.create(l.constructor.prototype);for(let f in l)u[f]=l[f];s[o]=u}}else s[o]=l}return 0==a&&(e.clone.paths.sort((e,t)=>e.path.length-t.path.length),e.clone.paths.forEach(t=>e.setDeep(s,t.path,e.getDeep(s,t.point)))),s}},e.format=function(t){return"object"==typeof e.clone(t)?JSON.stringify(e.clone(t),e.bigintChecker,"    "):String(t)},e.tree=function(t,a=0,i=[]){if(!i.includes(t)){if(i=i.concat([t]),a>e.maxSearchDepth)return t;if(null!=t&&Object.keys(t).length&&("object"==typeof t||"function"==typeof t)){if(n.isArray(t)){let r=[];return t.forEach(t=>{void 0!=e.tree(t,a+1,i)&&r.push(t)}),r}{let s={};for(let o in t){let l=e.tree(t[o],a+1,i);void 0!=l&&(s[o]=l)}return s}}}},e.formatTree=function(t){return e.tree(t)},e.bigintChecker=function(e,t){return"bigint"==typeof t?t.toString():t},e.noop=function(){},e.rectRect=function(e,t,n,a,i,r,s,o){return e+n>i&&e<i+s&&t+a>r&&t<r+o},e.createCanvas=function(e,t){let n=document.createElement("canvas");return[n.width,n.height]=[e,t],n},e.doError=function(t,n){e.changeable.errorCount==e.maxErrorCount?console.warn("Too many warnings and errors have been made, the rest will not display."):e.changeable.errorCount<e.maxErrorCount&&console[t](n),e.changeable.errorCount++},e.warn=function(t){e.doError("warn",t)},e.error=function(t){e.doError("error",t instanceof Error?t:Error(t))},e.observe=function(t,n,a){3==arguments.length&&n!=e.constants.GET&&n!=e.constants.SET&&e.error("Invalid type, must be either GET or SET"),t=new Proxy(t,{get:function(t,i){return n==e.constants.GET&&a(i),t[i]},set:function(t,i,r){n==e.constants.SET&&a(i,r),t[i]=r}})},e.setMain=function(t){t instanceof e?(e.main&&(e.main.isMain=!1),e.main=t,t.isMain=!0):e.error(`${t} is not an instance of Dark`)},e.getMain=function(){return e.main};let t=window.OffscreenCanvas??e.createCanvas;e.fileCacheKA={"/filters/global.vert":"# version 300 es\nprecision lowp float;\nin vec2 vertPos;\nin vec2 vertUV;\nout vec2 uv;\nout vec2 pos;\nvoid main() {\n pos = vertPos;\n uv = vertUV;\n gl_Position = vec4(vertPos, 0.0, 1.0);\n}","/filters/invert.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(1.0 - tex.rgb, tex.a);\n}","/filters/opaque.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb, 1.0);\n}","/filters/grayscale.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Based on how human eyes precieve\n color = vec4(vec3(luminance), tex.a);\n}","/filters/threshold.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance > param) {\n color = vec4(vec3(1.0), 1.0);\n } else {\n color = vec4(vec3(0.0), 1.0);\n }\n}","/filters/posterize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nfloat posterize(float val) {\n return floor(val * param + 0.5) / param;\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float red = posterize(tex.r);\n float green = posterize(tex.g);\n float blue = posterize(tex.b);\n \n color = vec4(red, green, blue, 1.0);\n}","/filters/black.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance <= param) {\n color = vec4(vec3(0.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/white.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n float luminance = 0.2126 * tex.r + 0.7152 * tex.g + 0.0722 * tex.b; // Same as grayscale\n if(luminance >= param) {\n color = vec4(vec3(1.0), tex.a);\n } else {\n color = tex;\n }\n}","/filters/vignette.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n vec2 pos = (uv * 2.0 - 1.0) * param;\n float dist = 1.0 - sqrt(pos.x * pos.x + pos.y * pos.y);\n color = vec4(tex.rgb * dist, tex.a);\n}","/filters/box.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n vec4 total = vec4(0.0);\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n total += texture(sampler, uv + vec2(x, y) / size);\n }\n }\n color = vec4(total / count);\n}","/filters/brightness.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb + param, tex.a);\n}","/filters/transparency.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(tex.rgb, tex.a - param);\n}","/filters/sepia.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n \n color = vec4(\n 0.393 * tex.r + 0.769 * tex.g + 0.189 * tex.b,\n 0.349 * tex.r + 0.686 * tex.g + 0.168 * tex.b,\n 0.272 * tex.r + 0.534 * tex.g + 0.131 * tex.b,\n tex.a\n );\n}","/filters/pixelate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec2 snap(vec2 point) {\n return floor(point * size / param) * param / size;\n}\nvoid main() {\n vec4 tex = texture(sampler, snap(uv));\n \n color = tex;\n}","/filters/sharpen.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n 0.0, -1.0, 0.0,\n -1.0, 5.0, -1.0,\n 0.0, -1.0, 0.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/outline.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n -1.0, -1.0, -1.0,\n -1.0, 8.0, -1.0,\n -1.0, -1.0, -1.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/edge.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n 0.0, 1.0, 0.0,\n 1.0, -4.0, 1.0,\n 0.0, 1.0, 0.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/normalize.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4(tex.rgb / length(tex.rgb), tex.a);\n}","/filters/erode.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nfloat luminance(vec4 col) {\n return 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b; // from grayscale\n}\nvoid main() {\n vec4 middle = get(0.0, 0.0);\n vec4 top = get(0.0, 1.0);\n vec4 bottom = get(0.0, -1.0);\n vec4 right = get(1.0, 0.0);\n vec4 left = get(-1.0, 0.0);\n float lumMiddle = luminance(middle);\n float lumTop = luminance(top);\n float lumBottom = luminance(bottom);\n float lumRight = luminance(right);\n float lumLeft = luminance(left);\n if(lumBottom > lumMiddle) {\n color = bottom;\n } else if(lumTop > lumMiddle) {\n color = top;\n } else if(lumRight > lumMiddle) {\n color = right;\n } else if(lumLeft > lumMiddle) {\n color = left;\n } else {\n color = middle;\n }\n}","/filters/dilate.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nfloat luminance(vec4 col) {\n return 0.2126 * col.r + 0.7152 * col.g + 0.0722 * col.b; // from grayscale\n}\nvoid main() {\n vec4 middle = get(0.0, 0.0);\n vec4 top = get(0.0, 1.0);\n vec4 bottom = get(0.0, -1.0);\n vec4 right = get(1.0, 0.0);\n vec4 left = get(-1.0, 0.0);\n float lumMiddle = luminance(middle);\n float lumTop = luminance(top);\n float lumBottom = luminance(bottom);\n float lumRight = luminance(right);\n float lumLeft = luminance(left);\n if(lumBottom < lumMiddle) {\n color = bottom;\n } else if(lumTop < lumMiddle) {\n color = top;\n } else if(lumRight < lumMiddle) {\n color = right;\n } else if(lumLeft < lumMiddle) {\n color = left;\n } else {\n color = middle;\n }\n}","/filters/blur.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define len (param * 2.0 + 1.0)\n#define count (len * len)\n#define TAU (6.2831853071795864769252867665590057683943)\nvoid main() { \n vec4 total = vec4(0.0);\n float matrixTotal = 0.0;\n for(float y = -param; y <= param; y++) {\n for(float x = -param; x <= param; x++) {\n vec4 tex = texture(sampler, uv + vec2(x, y) / size);\n float gaussian = exp(- (x * x + y * y) / (2.0 * param * param)) / (TAU * param * param);\n matrixTotal += gaussian;\n total += vec4(tex.rgb * gaussian, tex.a);\n }\n }\n color = total / matrixTotal;\n}","/filters/swirl.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nin vec2 uv;\nout vec4 color;\n#define radius (0.5)\nvoid main() {\n vec2 cUV = uv - vec2(0.5); // centered UV\n float len = length(cUV);\n float theta = atan(cUV.y, cUV.x) + param * smoothstep(radius, 0.0, len);\n float dist = length(cUV);\n vec4 tex = texture(sampler, vec2(dist * cos(theta), dist * sin(theta)) + vec2(0.5));\n \n color = tex;\n}","/filters/contrast.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nin vec2 uv;\nout vec4 color;\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4((tex.rgb - 0.5) * param + 0.5, tex.a);\n}","/filters/fisheye.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform float param;\nuniform vec2 size;\nin vec2 uv;\nin vec2 pos;\nout vec4 color;\n#define R2 1.414213562373095048801688\nvoid main() {\n float shifted = 2.0 - param;\n float squareness = shifted * shifted * shifted * shifted;\n vec2 c = pos * size / min(size.x, size.y) / squareness;\n float xsq = c.x * c.x;\n float ysq = c.y * c.y;\n vec2 worldMap = vec2(\n 0.5 * (sqrt(2.0 + xsq - ysq + 2.0 * c.x * R2) - sqrt(2.0 + xsq - ysq - 2.0 * c.x * R2)),\n 0.5 * (sqrt(2.0 - xsq + ysq + 2.0 * c.y * R2) - sqrt(2.0 - xsq + ysq - 2.0 * c.y * R2))\n ) * squareness;\n vec2 mapped = (worldMap + 1.0) / 2.0;\n \n if(abs(worldMap.x) <= 1.0 && abs(worldMap.y) <= 1.0) {\n color = texture(sampler, mapped);\n } else {\n color = vec4(vec3(0.0), 1.0);\n }\n}","/filters/emboss.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n const float kernel[9] = float[](\n -2.0, -1.0, 0.0,\n -1.0, 1.0, 1.0,\n 0.0, 1.0, 2.0\n ); \n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}","/filters/sobel.frag":"# version 300 es\nprecision lowp float;\nuniform sampler2D sampler;\nuniform vec2 size;\nuniform float param;\nuniform float[9] kernel;\nin vec2 uv;\nout vec4 color;\nvec4 get(float x, float y) {\n return texture(sampler, uv + vec2(x, y) / size);\n}\nvoid main() {\n vec4 tex = texture(sampler, uv);\n color = vec4((\n get(-1.0, -1.0) * kernel[0] +\n get(0.0, -1.0) * kernel[1] +\n get(1.0, -1.0) * kernel[2] +\n get(-1.0, 0.0) * kernel[3] +\n get(0.0, 0.0) * kernel[4] +\n get(1.0, 0.0) * kernel[5] +\n get(-1.0, 1.0) * kernel[6] +\n get(0.0, 1.0) * kernel[7] +\n get(1.0, 1.0) * kernel[8]\n ).rgb, tex.a);\n}"},e.compileListKA=[],e.loadFile=function(t){if(e.khan)return e.fileCacheKA[t];{e.editor||(t=`https://cdn.jsdelivr.net/gh/99TheDark/Dark.js@${e.version}/filters/${t}`);let n=null,a=new XMLHttpRequest;return a.open("GET",t,!1),a.send(),200==a.status&&(n=a.responseText),e.editor&&e.compileListKA.push({location:t,contents:n.replace(/\n\n+/g,"\n").replace(/  +/g," ")}),n}},e.compileKA=function(){e.editor&&e.compileListKA.forEach(t=>e.fileCacheKA[t.location]=t.contents)},e.globallyUpdateVariables=function(t){if(t.isMain){for(let n in e.editable.forEach(e=>{window[e]&&(t[e]=window[e])}),t)if(!e.ignoreGlobal.includes(n)&&!e.editable.includes(n)){if("object"!=typeof t[n]||t[n].darkObject||"keys"==n)window[n]=t[n];else for(let a in t[n])window[a]=t[n][a]}}},e.defineConstants=function(){e.singleDefinitions.forEach(t=>{for(key in e[t])Object.defineProperty(window,key,{value:e[t][key],writable:!1,configurable:!1})})},e.objects=function(){let a=function(t,n,i){if(!(this instanceof a))return new(Function.prototype.bind.apply(a,[null].concat(...arguments)));switch(this.darkObject=!0,arguments.length){default:e.error("DVector requires 2 or 3 parameters, not "+arguments.length);break;case 3:this.x=t,this.y=n,this.z=i,this.is2D=!1;break;case 2:this.x=t,this.y=n,this.is2D=!0}};a.create=function(e,t,n){return new a(e,t,n)},a.zero2D=function(){return new a(0,0)},a.prototype.zero2D=function(){return[this.x,this.y,this.z,this.is2D]=[0,0,void 0,!0],this},a.zero3D=function(){return new a(0,0,0)},a.prototype.zero3D=function(){return[this.x,this.y,this.z]=[0,0,0],this},a.add=function(e,t){return t instanceof a?e.is2D?new a(e.x+t.x,e.y+t.y):new a(e.x+t.x,e.y+t.y,e.z+t.z):e.is2D?new a(e.x+t,e.y+t):new a(e.x+t,e.y+t,e.z+t)},a.prototype.add=function(e){return e instanceof a?(this.x+=e.x,this.y+=e.y,this.z+=e.z):(this.x+=e,this.y+=e,this.z+=e),this},a.sub=function(e,t){return t instanceof a?e.is2D?new a(e.x-t.x,e.y-t.y):new a(e.x-t.x,e.y-t.y,e.z-t.z):e.is2D?new a(e.x-t,e.y-t):new a(e.x-t,e.y-t,e.z-t)},a.prototype.sub=function(e){return e instanceof a?(this.x-=e.x,this.y-=e.y,this.z-=e.z):(this.x-=e,this.y-=e,this.z-=e),this},a.mult=function(e,t){return t instanceof a?e.is2D?new a(e.x*t.x,e.y*t.y):new a(e.x*t.x,e.y*t.y,e.z*t.z):t instanceof s||t instanceof DOMMatrix?(t instanceof DOMMatrix&&(t=new s(t)),e.is2D)?new a(e.x*t.get(0,0)+e.y*t.get(1,0)+t.get(3,0),e.x*t.get(0,1)+e.y*t.get(1,1)+t.get(3,1)):new a(e.x*t.get(0,0)+e.y*t.get(1,0)+e.z*t.get(2,0)+t.get(3,0),e.x*t.get(0,1)+e.y*t.get(1,1)+e.z*t.get(2,1)+t.get(3,1),e.x*t.get(0,2)+e.y*t.get(1,2)+e.z*t.get(2,2)+t.get(3,2)):e.is2D?new a(e.x*t,e.y*t):new a(e.x*t,e.y*t,e.z*t)},a.prototype.mult=function(e){return e instanceof a?(this.x*=e.x,this.y*=e.y,this.z*=e.z):e instanceof s||e instanceof DOMMatrix?(e instanceof DOMMatrix&&(e=new s(e)),this.z,this.x,e.get(0,0),this.y,e.get(1,0),e.get(2,0),e.get(3,0),this.x,e.get(0,1),this.y,e.get(1,1),e.get(2,1),e.get(3,1),this.x,e.get(0,2),this.y,e.get(1,2),e.get(2,2),e.get(3,2)):(this.x*=e,this.y*=e,this.z*=e),this},a.div=function(e,t){return t instanceof a?e.is2D?new a(e.x/t.x,e.y/t.y):new a(e.x/t.x,e.y/t.y,e.z/t.z):e.is2D?new a(e.x/t,e.y/t):new a(e.x/t,e.y/t,e.z/t)},a.prototype.div=function(e){return e instanceof a?(this.x/=e.x,this.y/=e.y,this.z/=e.z):(this.x/=e,this.y/=e,this.z/=e),this},a.pow=function(e,t){return t instanceof a?new a(e.x**t.x,e.y**t.y,e.z**t.z):new a(e.x**t,e.y**t,e.z**t)},a.prototype.pow=function(e){return e instanceof a?(this.x**=e.x,this.y**=e.y,this.z**=e.z):(this.x**=e,this.y**=e,this.z**=e),this},a.angle=function(e){return n.atan2(e.y,e.x)},a.prototype.angle=function(){return n.atan2(this.y,this.x)},a.angleBetween=function(e,t){return n.atan2(t.y-e.y,t.x-e.x)},a.prototype.angleBetween=function(e){return a.angleBetween(this,e)},a.mag=function(e){return e.mag()},a.prototype.mag=function(){return this.is2D?Math.sqrt(this.x*this.x+this.y*this.y):Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.magSq=function(e){return e.magSq()},a.prototype.magSq=function(){return this.is2D?this.x*this.x+this.y*this.y:this.x*this.x+this.y*this.y+this.z*this.z},a.setMag=function(e,t){e.normalize(),e.mult(t)},a.prototype.setMag=function(e){return this.normalize(),this.mult(e),this},a.getRotation=function(e){return n.atan2(e.y,e.x)},a.prototype.getRotation=function(){return n.atan2(this.y,this.x)},a.setRotation=function(e,t){let i=e.mag();return new a(i*n.cos(t),i*n.sin(t))},a.prototype.setRotation=function(e){let t=this.mag();return[this.x,this.y]=[t*n.cos(e),t*n.sin(e)],this},a.rotate=function(e,t){e.setRotation(e.getRotation()+t)},a.prototype.rotate=function(e){return this.setRotation(this.getRotation()+e),this},a.normalize=function(e){let t=e.mag();return 0!=t?a.div(e,t):e.get()},a.prototype.normalize=function(){let e=this.mag();return 0!=e&&this.div(e),this},a.cross=function(e,t){return new a(e.y*t.z-t.y*e.z,e.z*t.x-t.z*e.x,e.x*t.y-t.x*e.y)},a.prototype.cross=function(e){return a.cross(this,e)},a.dot=function(t,n){return"number"==typeof n?t.is2D?t.x*n+t.y*n:t.x*n+t.y*n+t.z*n:t.is2D&&n.is2D?t.x*n.x+t.y*n.y:t.is2D||n.is2D?void e.error("Cannot take the dot product of a 2D and 3D vector"):t.x*n.x+t.y*n.y+t.z*n.z},a.prototype.dot=function(e){return a.dot(this,e)},a.flip=function(e){return new Vector(-e.x,-e.y,-e.z)},a.prototype.flip=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.limit=function(e,t){return e.mag()>t&&e.mult(t/e.mag()),e},a.prototype.limit=function(e){return this.mag()>e&&this.mult(e/this.mag()),this},a.lerp=function(e,t,i){return new a(n.lerp(e.x,t.x,i),n.lerp(e.y,t.y,i),n.lerp(e.z,t.z,i))},a.prototype.lerp=function(e,t){return this.x=n.lerp(this.x,e.x,t),this.y=n.lerp(this.y,e.y,t),this.z=n.lerp(this.z,e.z,t),this},a.abs=function(e){return e.is2D?new a(Math.abs(e.x),Math.abs(e.y)):new a(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z))},a.prototype.abs=function(){return[this.x,this.y,this.z]=[Math.abs(this.x),Math.abs(this.y),Math.abs(this.z)],this},a.dist=function(t,n){let a,i,r=0;return t.is2D&&n.is2D?(a=n.x-t.x,i=n.y-t.y):t.is2D||n.is2D?e.error("Cannot find the distance between a 2D and 3D DVector"):(a=n.x-t.x,i=n.y-t.y,r=n.z-t.z),Math.sqrt(a*a+i*i+r*r)},a.prototype.dist=function(e){return a.dist(this,e)},a.applyTransform=function(e,t){return a.mult(e,t)},a.prototype.applyTransform=function(e){return this.mult(e),this},a.get=function(e){return e.get()},a.prototype.get=function(){return this.is2D?new a(this.x,this.y):new a(this.x,this.y,this.z)},a.set=function(e,...t){e.set.apply(null,t)},a.prototype.set=function(...e){let t=e[0];return Array.isArray(t)?[this.x,this.y,this.z]=t:"object"==typeof t?[this.x,this.y,this.z]=[t.x,t.y,t.z]:[this.x,this.y,this.z]=e,this.is2D&&(this.z=void 0),this},a.toArray=function(e){return e.toArray()},a.prototype.toArray=function(){return this.is2D?[this.x,this.y]:[this.x,this.y,this.z]},a.fromArray=function(e){return a.create.apply(null,e)},a.prototype.fromArray=function(t){switch(t.length){default:e.error("DVector.fromArray takes in an array of length 2 or 3, not "+t.length);break;case 2:[this.x,this.y]=t,this.z=void 0,this.is2D=!0;break;case 3:[this.x,this.y,this.z]=t,this.is2D=!1}return this},a.prototype.toString=function(){return this.is2D?`[${this.x}, ${this.y}]`:`[${this.x}, ${this.y}, ${this.z}]`};let i=function(...t){if(!(this instanceof i))return new(Function.prototype.bind.apply(i,[null].concat(...arguments)));if(this.darkObject=!0,t.length>1)this.family=t[0]??i.defaults.family,this.size=t[1]??i.defaults.size,this.weight=t[2]??i.defaults.weight,this.style=t[3]??i.defaults.style,this.variant=t[4]??i.defaults.variant;else if("string"==typeof t[0])this.parse(t[0]);else if("object"==typeof t[0]){if(Array.isArray(t)){let n=t[0];this.family=n[0]??i.defaults.family,this.size=n[1]??i.defaults.size,this.weight=n[2]??i.defaults.weight,this.style=n[3]??i.defaults.style,this.variant=n[4]??i.defaults.variant}else{let a=t[0];this.family=a.family??i.defaults.family,this.size=a.size??i.defaults.size,this.weight=a.weight??i.defaults.weight,this.style=a.style??i.defaults.style,this.variant=a.variant??i.defaults.variant}}else e.error("Invalid input to DFont")};i.parse=function(e){return new i(e)},i.prototype.parse=function(e){this.style=i.defaults.style,this.variant=i.defaults.variant,this.weight=i.defaults.weight,this.size=i.defaults.size,this.family=i.defaults.family;let t=e.split(" ");for(let n in t){let a=t[n];switch(a){case"normal":break;case"italic":this.style="italic";break;case"bold":this.weight="bold"}if("italic"==a)this.style="italic";else if("small-caps"==a)this.variant="small-caps";else if(i.weights.includes(a))this.weight=a;else if("normal"!==a){let r=parseInt(a);isNaN(r)?this.family=a:this.size=r}}},i.prototype.toString=function(){return`${this.style} ${this.weight} ${this.variant} ${this.size}px ${this.family}`},i.weights=["bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],i.defaults={family:"Arial",size:16,weight:"normal",style:"normal",variant:"normal"};let r=function(...n){if(!(this instanceof r))return new(Function.prototype.bind.apply(r,[null].concat(...arguments)));this.darkObject=!0,this.filters={},this.disposable=!1,this.sent=!1,this.loaded=!1,this.imageLoaded=!1,this.bitmapLoaded=!1,this.image=null,this.bitmap=null,this.loadedFromSource=!1,n[0]instanceof ImageData?(this.imageData=n[0],this.source=n[1],this.width=n[0].width,this.height=n[0].height,this.canvas=e.createCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.loadPixels()):"number"==typeof n[0]&&"number"==typeof n[1]?(this.width=n[0],this.height=n[1],this.source=n[2],this.imageData=new ImageData(this.width,this.height),this.canvas=e.createCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d")):n[0]instanceof t||n[0]instanceof HTMLCanvasElement?(this.width=n[0].width,this.height=n[0].height,this.source=n[1],this.canvas=n[0],this.ctx=this.canvas.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)):n[0]instanceof e?(this.width=n[0].width,this.height=n[0].height,this.source=n[0],this.canvas=e.createCanvas(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.drawImage(n[0].canvas,0,0,this.width,this.height,0,0,this.width,this.height),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)):(this.imageData=null,this.source=n[0],this.width=0,this.height=0)};r.prototype.get=function(...t){switch(t.length){default:return e.error("DImage.get requires 0 or 4 parameters, not "+t.length);case 0:return this.copy();case 4:return new r(this.ctx.getImageData(t[0],t[1],t[2],t[3]),this.source)}},r.prototype.set=function(e,t,a){let i=(e+t*this.width)*4;return this.imageData.data[i]=n.red(a),this.imageData.data[i+1]=n.green(a),this.imageData.data[i+2]=n.blue(a),this.imageData.data[i+3]=n.alpha(a),this},r.prototype.copy=function(){let t=new r;return[t.width,t.height,t.imageData,t.source,t.disposable,t.sourceURL,t.loadComplete,t.loadedFromSource]=[this.width,this.height,this.imageData,this.source,this.disposable,this.sourceURL,this.loadComplete,this.loadedFromSource],t.canvas=e.createCanvas(this.width,this.height),t.ctx=t.canvas.getContext("2d"),t.ctx.drawImage(this.getRenderable(),0,0,this.width,this.height,0,0,this.width,this.height),t},r.prototype.getRenderable=function(){return this.loaded?this.image??this.bitmap:this.canvas},r.prototype.checkLoad=function(){let t=!this.loadedFromSource||this.loadComplete;return t||e.error("Cannot draw the image until loaded, put inside the setup or draw function instead"),t},r.resize=function(e,t,n){let a=e.copy();return a.setDisposability(!0),a.resize(t,n),a},r.prototype.resize=function(t,n){if(0==t||0==n)return e.error("Image resize size must be greater than zero");if(this.width!=t||this.height!=n){this.source instanceof e&&1==arguments.length&&(this.source.settings.resizeMode==this.source.constants.HEIGHT?[t,n]=[t/img.height*img.width,t]:[t,n]=[t,t/img.width*img.height]),[t,n]=[Math.ceil(t),Math.ceil(n)];let a=e.createCanvas(this.width,this.height);a.getContext("2d").drawImage(this.getRenderable(),0,0,this.width,this.height,0,0,this.width,this.height),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[t,n],this.ctx.fillRect(0,0,t,n),this.ctx.drawImage(a,0,0,t,n,0,0,t,n),this.loadImage()}return this},r.crop=function(e,t,n,a,i){let r=e.copy();return r.setDisposability(!0),r.crop(t,n,a,i),r},r.prototype.crop=function(t,n,a,i){if(a<=0||i<=0)return e.error("The image crop area must have a size greater than zero");if(t+a>this.width||n+i>this.height||t<0||n<0)return e.error("The cropped area must be within the image");if(this.width!=a||this.height!=i){this.source instanceof e&&3==arguments.length&&(this.source.settings.resizeMode==this.source.constants.HEIGHT?[a,i]=[a/img.height*img.width,a]:[a,i]=[a,a/img.width*img.height]);let r=e.createCanvas(this.width,this.height);r.getContext("2d").drawImage(this.getRenderable(),0,0,this.width,this.height,0,0,this.width,this.height),[this.canvas.width,this.canvas.height]=[this.width,this.height]=[a,i],this.ctx.drawImage(r,t,n,a,i,0,0,a,i),this.loadImage()}return this},r.prototype.loadPixels=function(){return this.ctx.putImageData(this.imageData,0,0),this},r.prototype.updatePixels=function(){return this.imageData.data.set(this.ctx.getImageData(0,0,this.width,this.height).data),this},r.prototype.setDisposability=function(e){return this.disposable=e,this},r.filter=function(e,t,n){let a=e.copy();return a.filter(t,n),a},r.prototype.filter=function(t,a){if(!e.filters.includes(t))return e.error("Invalid filter type");{let i=r.filterShaders[t],s=this.filters;s.gl_canvas=r.gl_canvas,s.gl=r.gl,s.program=i.program,(s.gl_canvas.width!=this.width||s.gl_canvas.height!=this.height)&&([s.gl_canvas.width,s.gl_canvas.height]=[this.width,this.height],s.gl.viewport(0,0,this.width,this.height)),s.gl.useProgram(s.program),s.tris=s.gl.createBuffer(),s.gl.bindBuffer(s.gl.ARRAY_BUFFER,s.tris),s.gl.bufferData(s.gl.ARRAY_BUFFER,r.texData,s.gl.STATIC_DRAW),s.trisIndex=s.gl.createBuffer(),s.gl.bindBuffer(s.gl.ELEMENT_ARRAY_BUFFER,s.trisIndex),s.gl.bufferData(s.gl.ELEMENT_ARRAY_BUFFER,r.texIndices,s.gl.STATIC_DRAW),s.fs=Float32Array.BYTES_PER_ELEMENT,s.posAttribLocation=s.gl.getAttribLocation(s.program,"vertPos"),s.uvAttribLocation=s.gl.getAttribLocation(s.program,"vertUV"),s.gl.vertexAttribPointer(s.posAttribLocation,2,s.gl.FLOAT,s.gl.FALSE,4*s.fs,0),s.gl.vertexAttribPointer(s.uvAttribLocation,2,s.gl.FLOAT,s.gl.FALSE,4*s.fs,2*s.fs),s.gl.enableVertexAttribArray(s.posAttribLocation),s.gl.enableVertexAttribArray(s.uvAttribLocation),s.sizeUniformLocation=s.gl.getUniformLocation(s.program,"size"),s.gl.uniform2f(s.sizeUniformLocation,this.width,this.height),i.multikernel?(Object.keys(i.multikernel).includes(String(a))||(a=i.defaultShader),s.kernelUniformLocation=s.gl.getUniformLocation(s.program,"kernel"),s.gl.uniform1fv(s.kernelUniformLocation,i.multikernel[a])):i.param&&(a=void 0!=a?n.constrain(a,i.param.min,i.param.max):i.param.default,s.paramUniformLocation=s.gl.getUniformLocation(s.program,"param"),s.gl.uniform1f(s.paramUniformLocation,a)),s.applied??=[],s.applied.push({filter:t,parameter:a}),s.texture=s.gl.createTexture(),s.gl.bindTexture(s.gl.TEXTURE_2D,s.texture),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_WRAP_S,s.gl.CLAMP_TO_EDGE),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_WRAP_T,s.gl.CLAMP_TO_EDGE),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MIN_FILTER,s.gl.LINEAR),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MAG_FILTER,s.gl.LINEAR),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,s.gl.RGBA,s.gl.UNSIGNED_BYTE,this.getRenderable()),s.gl.bindTexture(s.gl.TEXTURE_2D,null),s.gl.bindTexture(s.gl.TEXTURE_2D,s.texture),s.gl.activeTexture(s.gl.TEXTURE0),s.gl.clear(s.gl.COLOR_BUFFER_BIT|s.gl.DEPTH_BUFFER_BIT),s.gl.drawElements(s.gl.TRIANGLES,r.texIndices.length,s.gl.UNSIGNED_SHORT,0);let o=new Uint8ClampedArray(this.width*this.height*4);s.gl.readPixels(0,0,this.width,this.height,s.gl.RGBA,s.gl.UNSIGNED_BYTE,o),this.imageData.data.set(o),this.ctx.putImageData(this.imageData,0,0),this.loadImage()}return this},r.texData=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]),r.texIndices=new Uint16Array([0,1,2,1,2,3]),r.globalVertexShader=e.loadFile("/filters/global.vert"),r.filterShaders=[],r.gl_canvas=e.createCanvas(0,0),r.gl=r.gl_canvas.getContext("webgl2",{antialias:!1}),r.initializeShaders=function(t){let n=r.gl,a=r.globalVertexShader;if(!n)return e.warn("Your browser does not support WebGL2.");t.forEach(function(t){let i=e.loadFile(`/filters/${t.shader}.frag`),s=n.createShader(n.VERTEX_SHADER),o=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(s,a),n.shaderSource(o,i),n.compileShader(s),n.compileShader(o),!n.getShaderParameter(s,n.COMPILE_STATUS))return e.error("Error compiling vertex shader.\n\n"+n.getShaderInfoLog(s));if(!n.getShaderParameter(o,n.COMPILE_STATUS))return e.error("Error compiling fragment shader.\n\n"+n.getShaderInfoLog(o));let l=n.createProgram();return(n.attachShader(l,s),n.attachShader(l,o),n.linkProgram(l),n.getProgramParameter(l,n.LINK_STATUS))?(n.validateProgram(l),n.getProgramParameter(l,n.VALIDATE_STATUS))?void(r.filterShaders[t.key]={shader:i,param:t.param,program:l,multikernel:t.multikernel,defaultShader:t.defaultShader}):e.error("Error validating program.\n\n"+n.getProgramInfoLog(l)):e.error("Error linking program.\n\n"+n.getProgramInfoLog(l))})},r.prototype.generateImage=function(e){this.image=new Image,this.image.src=URL.createObjectURL(e),this.image.crossOrigin="anonymous",this.image.addEventListener("load",()=>{this.imageLoaded=!0,this.bitmapLoaded&&(this.loaded=!0,this.sent=!1)})},r.prototype.generateBitmap=function(){createImageBitmap(this.canvas).then(e=>{this.bitmap=e,this.bitmapLoaded=!0,this.imageLoaded&&(this.loaded=!0,this.sent=!1)})},r.animationFrames=[],r.awaitAnimationFrame=function(){let e,t=new Promise(t=>{e=t});return r.animationFrames.push({promise:t,resolve:e}),t},r.raf=function(){r.animationFrames.forEach(e=>e.resolve()),requestAnimationFrame(r.raf)},r.prototype.loadImage=function(){this.image=null,this.loaded=!1,this.imageLoaded=!1,this.bitmapLoaded=!1,e.khan||this.disposable||this.sent||(this.sent=!0,r.awaitAnimationFrame().then(()=>{this.generateBitmap(),this.canvas instanceof HTMLCanvasElement?this.canvas.toBlob((...e)=>this.generateImage.apply(this,e),{type:"image/png"}):this.canvas.convertToBlob({type:"image/png"}).then(e=>this.generateImage(e))}))},r.prototype.toDataArray=function(){return[...(this.imageData??{data:[]}).data]},r.get=(e,...t)=>e.get.apply(null,t),r.set=(e,...t)=>e.set.apply(null,t),r.copy=e=>e.copy(),r.getRenderable=e=>e.getRenderable(),r.loadPixels=e=>e.loadPixels(),r.updatePixels=e=>e.updatePixels(),r.setDisposability=(e,t)=>e.setDisposability(t),r.toDataArray=e=>e.toDataArray(),r.initializeShaders([{key:e.constants.INVERT,shader:"invert"},{key:e.constants.OPAQUE,shader:"opaque"},{key:e.constants.GRAY,shader:"grayscale"},{key:e.constants.ERODE,shader:"erode"},{key:e.constants.DILATE,shader:"dilate"},{key:e.constants.THRESHOLD,shader:"threshold",param:{min:0,max:1,default:.5}},{key:e.constants.POSTERIZE,shader:"posterize",param:{min:2,max:255,default:255}},{key:e.constants.BLUR,shader:"blur",param:{min:0,max:25,default:1}},{key:e.constants.SHARPEN,shader:"sharpen"},{key:e.constants.SEPIA,shader:"sepia"},{key:e.constants.OUTLINE,shader:"outline"},{key:e.constants.SWIRL,shader:"swirl",param:{min:0,max:12,default:4}},{key:e.constants.EDGE,shader:"edge"},{key:e.constants.CONTRAST,shader:"contrast",param:{min:0,max:15,default:3}},{key:e.constants.VIGNETTE,shader:"vignette",param:{min:0,max:1,default:.5}},{key:e.constants.BRIGHTNESS,shader:"brightness",param:{min:-1,max:1,default:0}},{key:e.constants.BLACK,shader:"black",param:{min:0,max:1,default:0}},{key:e.constants.WHITE,shader:"white",param:{min:0,max:1,default:1}},{key:e.constants.NORMALIZE,shader:"normalize"},{key:e.constants.BOX,shader:"box",param:{min:0,max:25,default:1}},{key:e.constants.TRANSPARENCY,shader:"transparency",param:{min:0,max:1,default:0}},{key:e.constants.PIXELATE,shader:"pixelate",param:{min:1,max:5e3,default:1}},{key:e.constants.FISHEYE,shader:"fisheye",param:{min:0,max:1,default:1}},{key:e.constants.EMBOSS,shader:"emboss"},{key:e.constants.SOBEL,shader:"sobel",multikernel:Object.fromEntries([[e.constants.TOP,[1,2,1,0,0,0,-1,-2,-1]],[e.constants.BOTTOM,[-1,-2,-1,0,0,0,1,2,1]],[e.constants.LEFT,[1,0,-1,2,0,-2,1,0,-1]],[e.constants.RIGHT,[-1,0,1,-2,0,2,-1,0,1]]]),defaultShader:e.constants.TOP}]),requestAnimationFrame(r.raf);let s=function(e,t,n=0){if(!(this instanceof s))return new(Function.prototype.bind.apply(s,[null].concat(...arguments)));this.darkObject=!0,e instanceof s?(this.width=e.width,this.height=e.height,this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),this.set(e)):Array.isArray(e)?(this.mat=Array(this.height).fill(null).map(()=>Array(this.width).fill(0)),Array.isArray(e[0])?1==arguments.length?(this.width=e[0].length,this.height=e.length,this.set(e)):(this.width=arguments.length,this.height=e[0].length,this.set([...arguments])):(this.width=t,this.height=n,this.set(e))):e instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=[[e.m11,e.m21,e.m31,e.m41],[e.m12,e.m22,e.m32,e.m42],[e.m13,e.m23,e.m33,e.m43],[e.m14,e.m24,e.m34,e.m44]]):(this.width=e,this.height=t,this.mat=Array(t).fill(null).map(()=>Array(e).fill(n)))};s.prototype.get=function(e,t){return this.mat[t][e]},s.set=function(e,t,n,a){e.set(t,n,a)},s.prototype.set=function(e,t,n){if(e instanceof s)for(let a=0;a<e.height;a++)for(let i=0;i<e.width;i++)this.mat[a][i]=e.mat[a][i];else if(Array.isArray(e)){if(Array.isArray(e[0]))for(let r=0;r<e.length;r++)for(let o=0;o<e[0].length;o++)this.mat[r][o]=e[r][o];else for(let l=0;l<this.width*this.height;l++){let c=l%this.width,h=Math.floor(l/this.width);this.mat[h][c]=e[l]}}else this.mat[t][e]=n;return this},s.dot=function(t,n,a,i){if(t.width==n.height){let r=0;for(let s=0;s<t.width;s++)r+=t.get(s,a)*n.get(i,s);return r}e.error("Can only take the dot product of two DMatrices  with equal width and height")},s.prototype.dot=function(e){return s.dot(this,e)},s.identity=function(e){let t=new s(e,e);for(let n=0;n<e;n++)t.set(n,n,1);return t},s.prototype.identity=function(){return this.width==this.height?this.mat=s.identity(this.width).mat:e.error("Only DMatrices with square dimensions have identity DMatrices"),this},s.transpose=function(e){let t=e.copy();return t.transpose(),t},s.prototype.transpose=function(){return this.mat=Array(this.width).fill().map((e,t)=>Array(this.height).fill().map((e,n)=>this.mat[n][t])),[this.width,this.height]=[this.height,this.width],this},s.normalize=function(e){let t=e.copy();return t.normalize(),t},s.prototype.normalize=function(){let e=this.getWeight();return this.mat=this.mat.map(t=>t.map(t=>t/e)),this},s.round=function(e,t){let n=e.copy();return n.round(t),n},s.prototype.round=function(e=0){let t=10**e;return this.mat=this.mat.map(e=>e.map(e=>Math.round(e*t)/t)),this},s.translate=function(e,t,n){let a=e.copy();return a.translate(t,n),a},s.prototype.translate=function(e,t){let n=this.toDOMMatrix();return n.translateSelf(e,t),this.fromDOMMatrix(n),this},s.rotate=function(e,t){let n=e.copy();return n.rotate(t),n},s.prototype.rotate=function(e){let t=this.toDOMMatrix();return t.rotateSelf(e),this.fromDOMMatrix(t),this},s.scale=function(e,t,n){let a=e.copy();return a.scale(t,n),a},s.prototype.scale=function(e,t=e){let n=this.toDOMMatrix();return n.scaleSelf(e,t),this.fromDOMMatrix(n),this},s.skew=function(e,t,n){let a=e.copy();return a.skew(t,n),a},s.prototype.skew=function(e,t=0){let n=this.toDOMMatrix();return n.skewYSelf(.01*e),n.skewXSelf(.01*t),this.fromDOMMatrix(n),this},s.translateX=function(e,t){let n=e.copy();return n.translateX(t),n},s.prototype.translateX=function(e){return this.translate(e,0),this},s.translateY=function(e,t){let n=e.copy();return n.translateY(t),n},s.prototype.translateY=function(e){return this.translate(0,e),this},s.scaleX=function(e,t){e.scaleX(t);let n=e.copy();return n.scaleX(t),n},s.prototype.scaleX=function(e){return this.scale(e,1),this},s.scaleY=function(e,t){let n=e.copy();return n.scaleY(t),n},s.prototype.scaleY=function(e){return this.scale(e,1),this},s.skewX=function(e,t){let n=e.copy();return n.skewX(t),n},s.prototype.skewX=function(e){return this.skew(e,0),this},s.skewY=function(e,t){let n=e.copy();return n.skewY(t),n},s.prototype.skewY=function(e){return this.skew(0,e),this},s.add=function(t,n){if("number"==typeof n){let a=new s(t.width,t.height);for(let i=0;i<a.height;i++)for(let r=0;r<a.width;r++)a.set(i,r,t.get(r,i)+n);return a}if(t.width==n.width&&t.height==n.height){let o=new s(t.width,t.height);for(let l=0;l<o.height;l++)for(let c=0;c<o.width;c++)o.set(l,c,t.get(c,l)+n.get(c,l));return o}e.error("Cannot add two DMatrices with different dimensions")},s.prototype.add=function(e){return this.set(s.add(this,e)),this},s.sub=function(t,n){if("number"==typeof n){let a=new s(t.width,t.height);for(let i=0;i<a.height;i++)for(let r=0;r<a.width;r++)a.set(i,r,t.get(r,i)-n);return a}if(t.width==n.width&&t.height==n.height){let o=new s(t.width,t.height);for(let l=0;l<o.height;l++)for(let c=0;c<o.width;c++)o.set(l,c,t.get(c,l)-n.get(c,l));return o}e.error("Cannot subtract two DMatrices with different dimensions")},s.prototype.sub=function(e){return this.set(s.sub(this,e)),this},s.mult=function(t,n){if("number"==typeof n){let a=new s(t.width,t.height);for(let i=0;i<a.height;i++)for(let r=0;r<a.width;r++)a.set(i,r,t.get(r,i)*n);return a}if(t.width==n.height){let o=new s(n.width,t.height);for(let l=0;l<o.height;l++)for(let c=0;c<o.width;c++)o.set(c,l,s.dot(t,n,l,c));return o}e.error("Can only multiply two DMatrices with equal width and height")},s.prototype.mult=function(e){let t=s.mult(this,e);return this.width=t.width,this.height=t.height,this.mat=t.mat,this},s.getWeight=function(e){return e.getWeight()},s.prototype.getWeight=function(){return this.toArray().reduce((e,t)=>e+=t,0)},s.copy=function(e){return new s([...e.mat])},s.prototype.copy=function(){return new s([...this.mat])},s.fromDOMMatrix=function(t){if(t instanceof DOMMatrix)return new s(t);e.error(`${t} is not a DOMMatrix`)},s.prototype.fromDOMMatrix=function(t){return t instanceof DOMMatrix?(this.width=4,this.height=4,this.mat=new s(t).mat):e.error(`${t} is not a DOMMatrix`),this},s.toDOMMatrix=function(e){return e.toDOMMatrix()},s.prototype.toDOMMatrix=function(){return new DOMMatrix([this.get(0,0),this.get(0,1),this.get(1,0),this.get(1,1),this.get(3,0),this.get(3,1)])},s.prototype.toArray2D=function(){return[...this.mat]},s.prototype.toArray=function(){return[...this.mat.flat(1)]},s.prototype.toString=function(){let e="";for(let t in this.mat){for(let n in this.mat[t])e+=this.mat[t][n].toFixed(2)+" ";e=e.replace(/ $/,"\n")}return e};let o=function(e=1e6*Math.random()){if(!(this instanceof o))return new(Function.prototype.bind.apply(o,[null].concat(...arguments)));this.darkObject=!0,this.seed=e,this.a=0x9af1b04258d,this.b=13034335,this.c=6856007898,this.d=16647635*e};o.prototype.next=function(){let e=this.b<<9,t=this.a+this.d;return t=(t<<7|t>>>25)+this.a,this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=e,this.d=this.d<<11|this.d>>>21,(t>>>0)/4294967296},o.copy=function(e){return e.copy()},o.prototype.copy=function(){let e=new o(this.seed);return[e.a,e.b,e.c,e.d]=[this.a,this.b,this.c,this.d],e},o.create=function(e){return new o(e)};let l=function(){if(!(this instanceof l))return new(Function.prototype.bind.apply(l,[null].concat(...arguments)));this.darkObject=!0,this.reset()};l.prototype.start=function(){return null==this.begin?this.begin=performance.now():e.error("DTimer.reset must be called before a new timer begins"),this},l.prototype.stop=function(){return null==this.start?e.error("DTimer.start must be called before DTimer.error"):(this.end=performance.now(),this.time=this.end-this.begin),this},l.prototype.reset=function(){return this.begin=null,this.end=null,this.time=null,this},l.prototype.copy=function(){let e=new l;return[e.start,e.end,e.time]=[this.begin,this.end,this.time],e},l.prototype.toString=function(){return null==this.start?`From ${this.begin.toFixed(2)} to ${this.end.toFixed(2)}, taking ${this.time.toFixed(2)} milliseconds`:"The timer has yet to begin"},l.prototype.getSecond=function(){return this.time/1e3},l.prototype.getMillis=function(){return this.time},l.prototype.getMicro=function(){return 1e3*this.time},l.prototype.getNano=function(){return 1e6*this.time},l.prototype.getFPS=function(){return 1e3/this.time},l.time=function(e){let t=performance.now();return e(),performance.now()-t},l.start=e=>void e.start(),l.stop=e=>void e.stop(),l.reset=e=>void e.reset(),l.copy=e=>e.copy(),l.toString=e=>e.toString();let c=function(){if(!(this instanceof c))return new(Function.prototype.bind.apply(c,[null].concat(...arguments)));this.darkObject=!0,this.id=(++c.current).toString(36)};c.current=BigInt(Math.abs(Math.floor((0xcfd41b9100000*Math.random()+Date.now()**3)/1e20)))<<BigInt(Math.floor(10*Math.random()));let h=function(...t){if(!(this instanceof h))return new(Function.prototype.bind.apply(h,[null].concat(...arguments)));this.darkObject=!0,this.stops=[],this.mode=e.constants.LINEAR;let n=1/t.length;t.forEach((e,t)=>this.stops.push({position:n*t,value:e}))};return h.prototype.setMode=function(t){switch(t){default:e.error("Invalid DGradient mode");break;case e.constants.LINEAR:this.mode=e.constants.LINEAR;break;case e.constants.RADIAL:this.mode=e.constants.RADIAL;break;case e.constants.CONIC:this.mode=e.constants.CONIC}return this},h.prototype.toCanvasGradient=function(){let e=n.ctx.createLinearGradient(0,0,1,0);return this.stops.forEach(t=>e.addColorStop(t.position,`rgba(${n.red(t.value)}, ${n.green(t.value)}, ${n.blue(t.value)}, ${n.alpha(t.value)/255})`)),e},{Dark:e,DVector:a,DFont:i,DImage:r,DMatrix:s,DRandom:o,DTimer:l,DIdentification:c,DGradient:h}}(),e.focus={},document.addEventListener("click",t=>{e.focus.target=t.target,e.focus.time=performance.now()}),e.startTime=performance.now(),e.default=new e;let n=e.utils=new e(!0);e.setMain(e.default),e.globallyUpdateVariables(e.main),e.defineConstants(),e.compileKA(),Object.freeze(e)})();
